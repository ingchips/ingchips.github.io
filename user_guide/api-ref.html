<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Platform API Reference | INGCHIPS SDK User Guide</title>
  <meta name="description" content="This is the user guide of INGCHIPS SDK." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Platform API Reference | INGCHIPS SDK User Guide" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/./img/sdk_overview.png" />
  <meta property="og:description" content="This is the user guide of INGCHIPS SDK." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Platform API Reference | INGCHIPS SDK User Guide" />
  
  <meta name="twitter:description" content="This is the user guide of INGCHIPS SDK." />
  <meta name="twitter:image" content="/./img/sdk_overview.png" />

<meta name="author" content="Ingchips Technology Co., Ltd." />


<meta name="date" content="2025-11-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dive-into-sdk.html"/>
<link rel="next" href="revision-history.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">User Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#scope"><i class="fa fa-check"></i><b>2.1</b> Scope</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#architecture"><i class="fa fa-check"></i><b>2.2</b> Architecture</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#rtos-bundles"><i class="fa fa-check"></i><b>2.2.1</b> RTOS Bundles</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#noos_bundles"><i class="fa fa-check"></i><b>2.2.2</b> “NoOS” Bundles</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#abbreviations-terminology"><i class="fa fa-check"></i><b>2.3</b> Abbreviations &amp; Terminology</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#references"><i class="fa fa-check"></i><b>2.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tutorial.html"><a href="tutorial.html"><i class="fa fa-check"></i><b>3</b> Tutorials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tutorial.html"><a href="tutorial.html#ch1-hello-world"><i class="fa fa-check"></i><b>3.1</b> Hello World</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="tutorial.html"><a href="tutorial.html#development-tool-page"><i class="fa fa-check"></i><b>3.1.1</b> <code>Development Tool</code> Page</a></li>
<li class="chapter" data-level="3.1.2" data-path="tutorial.html"><a href="tutorial.html#choose-chip-series-page"><i class="fa fa-check"></i><b>3.1.2</b> <code>Choose Chip Series</code> Page</a></li>
<li class="chapter" data-level="3.1.3" data-path="tutorial.html"><a href="tutorial.html#choose-project-type-page"><i class="fa fa-check"></i><b>3.1.3</b> <code>Choose Project Type</code> Page</a></li>
<li class="chapter" data-level="3.1.4" data-path="tutorial.html"><a href="tutorial.html#role-of-your-device-page"><i class="fa fa-check"></i><b>3.1.4</b> <code>Role of Your Device</code> Page</a></li>
<li class="chapter" data-level="3.1.5" data-path="tutorial.html"><a href="tutorial.html#peripheral-setup-page"><i class="fa fa-check"></i><b>3.1.5</b> <code>Peripheral Setup</code> Page</a></li>
<li class="chapter" data-level="3.1.6" data-path="tutorial.html"><a href="tutorial.html#security-privacy-page"><i class="fa fa-check"></i><b>3.1.6</b> <code>Security &amp; Privacy</code> Page</a></li>
<li class="chapter" data-level="3.1.7" data-path="tutorial.html"><a href="tutorial.html#firmare-over-the-air-page"><i class="fa fa-check"></i><b>3.1.7</b> <code>Firmare Over-The-Air</code> Page</a></li>
<li class="chapter" data-level="3.1.8" data-path="tutorial.html"><a href="tutorial.html#common-functions-page"><i class="fa fa-check"></i><b>3.1.8</b> <code>Common Functions</code> Page</a></li>
<li class="chapter" data-level="3.1.9" data-path="tutorial.html"><a href="tutorial.html#build-your-project"><i class="fa fa-check"></i><b>3.1.9</b> Build your project</a></li>
<li class="chapter" data-level="3.1.10" data-path="tutorial.html"><a href="tutorial.html#download"><i class="fa fa-check"></i><b>3.1.10</b> Download</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tutorial.html"><a href="tutorial.html#ibeacon"><i class="fa fa-check"></i><b>3.2</b> iBeacon</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="tutorial.html"><a href="tutorial.html#setup-advertising-data"><i class="fa fa-check"></i><b>3.2.1</b> Setup Advertising Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="tutorial.html"><a href="tutorial.html#try-it"><i class="fa fa-check"></i><b>3.2.2</b> Try It</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tutorial.html"><a href="tutorial.html#thermometer"><i class="fa fa-check"></i><b>3.3</b> Thermometer</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="tutorial.html"><a href="tutorial.html#setup-advertising-data-1"><i class="fa fa-check"></i><b>3.3.1</b> Setup Advertising Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="tutorial.html"><a href="tutorial.html#setup-gatt-profile"><i class="fa fa-check"></i><b>3.3.2</b> Setup GATT Profile</a></li>
<li class="chapter" data-level="3.3.3" data-path="tutorial.html"><a href="tutorial.html#write-the-code"><i class="fa fa-check"></i><b>3.3.3</b> Write the Code</a></li>
<li class="chapter" data-level="3.3.4" data-path="tutorial.html"><a href="tutorial.html#notification"><i class="fa fa-check"></i><b>3.3.4</b> Notification</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tutorial.html"><a href="tutorial.html#thermometer-with-fota"><i class="fa fa-check"></i><b>3.4</b> Thermometer with FOTA</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="tutorial.html"><a href="tutorial.html#device-with-fota"><i class="fa fa-check"></i><b>3.4.1</b> Device with FOTA</a></li>
<li class="chapter" data-level="3.4.2" data-path="tutorial.html"><a href="tutorial.html#make-a-new-version"><i class="fa fa-check"></i><b>3.4.2</b> Make a New Version</a></li>
<li class="chapter" data-level="3.4.3" data-path="tutorial.html"><a href="tutorial.html#fota-server"><i class="fa fa-check"></i><b>3.4.3</b> FOTA Server</a></li>
<li class="chapter" data-level="3.4.4" data-path="tutorial.html"><a href="tutorial.html#try-it-1"><i class="fa fa-check"></i><b>3.4.4</b> Try It</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="tutorial.html"><a href="tutorial.html#ibeacon-scanner"><i class="fa fa-check"></i><b>3.5</b> iBeacon Scanner</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="tutorial.html"><a href="tutorial.html#distance-estimation"><i class="fa fa-check"></i><b>3.5.1</b> Distance Estimation</a></li>
<li class="chapter" data-level="3.5.2" data-path="tutorial.html"><a href="tutorial.html#concurrent-advertising-scanning"><i class="fa fa-check"></i><b>3.5.2</b> Concurrent Advertising &amp; Scanning</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="tutorial.html"><a href="tutorial.html#notification-indication"><i class="fa fa-check"></i><b>3.6</b> Notification &amp; Indication</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="tutorial.html"><a href="tutorial.html#inter-task-comm"><i class="fa fa-check"></i><b>3.6.1</b> Inter-task Communication</a></li>
<li class="chapter" data-level="3.6.2" data-path="tutorial.html"><a href="tutorial.html#timer"><i class="fa fa-check"></i><b>3.6.2</b> Timer</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="tutorial.html"><a href="tutorial.html#throughput"><i class="fa fa-check"></i><b>3.7</b> Throughput</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="tutorial.html"><a href="tutorial.html#theoretical-peak-throughput"><i class="fa fa-check"></i><b>3.7.1</b> Theoretical Peak Throughput</a></li>
<li class="chapter" data-level="3.7.2" data-path="tutorial.html"><a href="tutorial.html#test-throughput"><i class="fa fa-check"></i><b>3.7.2</b> Test Throughput</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="tutorial.html"><a href="tutorial.html#dual-role-ble-gateway"><i class="fa fa-check"></i><b>3.8</b> Dual Role &amp; BLE Gateway</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="tutorial.html"><a href="tutorial.html#use-wizard-to-create-a-peripheral-app"><i class="fa fa-check"></i><b>3.8.1</b> Use <code>Wizard</code> to create a peripheral app</a></li>
<li class="chapter" data-level="3.8.2" data-path="tutorial.html"><a href="tutorial.html#define-thermometer-data"><i class="fa fa-check"></i><b>3.8.2</b> Define Thermometer Data</a></li>
<li class="chapter" data-level="3.8.3" data-path="tutorial.html"><a href="tutorial.html#scan-for-thermometers"><i class="fa fa-check"></i><b>3.8.3</b> Scan for Thermometers</a></li>
<li class="chapter" data-level="3.8.4" data-path="tutorial.html"><a href="tutorial.html#discover-services"><i class="fa fa-check"></i><b>3.8.4</b> Discover Services</a></li>
<li class="chapter" data-level="3.8.5" data-path="tutorial.html"><a href="tutorial.html#data-handling"><i class="fa fa-check"></i><b>3.8.5</b> Data Handling</a></li>
<li class="chapter" data-level="3.8.6" data-path="tutorial.html"><a href="tutorial.html#robustness"><i class="fa fa-check"></i><b>3.8.6</b> Robustness</a></li>
<li class="chapter" data-level="3.8.7" data-path="tutorial.html"><a href="tutorial.html#prepare-thermometers"><i class="fa fa-check"></i><b>3.8.7</b> Prepare Thermometers</a></li>
<li class="chapter" data-level="3.8.8" data-path="tutorial.html"><a href="tutorial.html#test"><i class="fa fa-check"></i><b>3.8.8</b> Test</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="tutorial.html"><a href="tutorial.html#start-from-examples"><i class="fa fa-check"></i><b>3.9</b> Start from Examples</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="core-tools.html"><a href="core-tools.html"><i class="fa fa-check"></i><b>4</b> Core Tools</a>
<ul>
<li class="chapter" data-level="4.1" data-path="core-tools.html"><a href="core-tools.html#wizard"><i class="fa fa-check"></i><b>4.1</b> Wizard</a></li>
<li class="chapter" data-level="4.2" data-path="core-tools.html"><a href="core-tools.html#ch2-downloader"><i class="fa fa-check"></i><b>4.2</b> Downloader</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="core-tools.html"><a href="core-tools.html#introduction"><i class="fa fa-check"></i><b>4.2.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2.2" data-path="core-tools.html"><a href="core-tools.html#script-mass-prod"><i class="fa fa-check"></i><b>4.2.2</b> Scripting &amp; Mass Production</a></li>
<li class="chapter" data-level="4.2.3" data-path="core-tools.html"><a href="core-tools.html#flash-read-protection"><i class="fa fa-check"></i><b>4.2.3</b> Flash Read Protection</a></li>
<li class="chapter" data-level="4.2.4" data-path="core-tools.html"><a href="core-tools.html#python-version"><i class="fa fa-check"></i><b>4.2.4</b> Python Version</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="core-tools.html"><a href="core-tools.html#tracer"><i class="fa fa-check"></i><b>4.3</b> Tracer</a></li>
<li class="chapter" data-level="4.4" data-path="core-tools.html"><a href="core-tools.html#ch2-axf-tool"><i class="fa fa-check"></i><b>4.4</b> Axf Tool</a></li>
<li class="chapter" data-level="4.5" data-path="core-tools.html"><a href="core-tools.html#ai-shortcuts"><i class="fa fa-check"></i><b>4.5</b> AI Shortcuts</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="core-tools.html"><a href="core-tools.html#installation"><i class="fa fa-check"></i><b>4.5.1</b> Installation</a></li>
<li class="chapter" data-level="4.5.2" data-path="core-tools.html"><a href="core-tools.html#usage"><i class="fa fa-check"></i><b>4.5.2</b> Usage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html"><i class="fa fa-check"></i><b>5</b> Dive Into SDK</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#memory-management"><i class="fa fa-check"></i><b>5.1</b> Memory Management</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#global-variables"><i class="fa fa-check"></i><b>5.1.1</b> Global Variables</a></li>
<li class="chapter" data-level="5.1.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#using-stack"><i class="fa fa-check"></i><b>5.1.2</b> Using Stack</a></li>
<li class="chapter" data-level="5.1.3" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#using-heap"><i class="fa fa-check"></i><b>5.1.3</b> Using Heap</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#multitasking"><i class="fa fa-check"></i><b>5.2</b> Multitasking</a></li>
<li class="chapter" data-level="5.3" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#interrupt-management"><i class="fa fa-check"></i><b>5.3</b> Interrupt Management</a></li>
<li class="chapter" data-level="5.4" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#power-management"><i class="fa fa-check"></i><b>5.4</b> Power Management</a></li>
<li class="chapter" data-level="5.5" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#cmsis-api"><i class="fa fa-check"></i><b>5.5</b> CMSIS API</a></li>
<li class="chapter" data-level="5.6" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#debugging-tracing"><i class="fa fa-check"></i><b>5.6</b> Debugging &amp; Tracing</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#tips-on-segger-rtt"><i class="fa fa-check"></i><b>5.6.1</b> Tips on SEGGER RTT</a></li>
<li class="chapter" data-level="5.6.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#memory-dump"><i class="fa fa-check"></i><b>5.6.2</b> Memory Dump</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="api-ref.html"><a href="api-ref.html"><i class="fa fa-check"></i><b>6</b> Platform API Reference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="api-ref.html"><a href="api-ref.html#configuration-information"><i class="fa fa-check"></i><b>6.1</b> Configuration &amp; Information</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="api-ref.html"><a href="api-ref.html#platform_config"><i class="fa fa-check"></i><b>6.1.1</b> <code>platform_config</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="api-ref.html"><a href="api-ref.html#platform_get_version"><i class="fa fa-check"></i><b>6.1.2</b> <code>platform_get_version</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="api-ref.html"><a href="api-ref.html#platform_read_info"><i class="fa fa-check"></i><b>6.1.3</b> <code>platform_read_info</code></a></li>
<li class="chapter" data-level="6.1.4" data-path="api-ref.html"><a href="api-ref.html#api-switch-app"><i class="fa fa-check"></i><b>6.1.4</b> <code>platform_switch_app</code></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="api-ref.html"><a href="api-ref.html#events-interrupts"><i class="fa fa-check"></i><b>6.2</b> Events &amp; Interrupts</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="api-ref.html"><a href="api-ref.html#platform_set_evt_callback_table"><i class="fa fa-check"></i><b>6.2.1</b> <code>platform_set_evt_callback_table</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="api-ref.html"><a href="api-ref.html#platform_set_irq_callback_table"><i class="fa fa-check"></i><b>6.2.2</b> <code>platform_set_irq_callback_table</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="api-ref.html"><a href="api-ref.html#platform_set_evt_callback"><i class="fa fa-check"></i><b>6.2.3</b> <code>platform_set_evt_callback</code></a></li>
<li class="chapter" data-level="6.2.4" data-path="api-ref.html"><a href="api-ref.html#platform_set_irq_callback"><i class="fa fa-check"></i><b>6.2.4</b> <code>platform_set_irq_callback</code></a></li>
<li class="chapter" data-level="6.2.5" data-path="api-ref.html"><a href="api-ref.html#platform_enable_irq"><i class="fa fa-check"></i><b>6.2.5</b> <code>platform_enable_irq</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="api-ref.html"><a href="api-ref.html#clocks"><i class="fa fa-check"></i><b>6.3</b> Clocks</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="api-ref.html"><a href="api-ref.html#platform_calibrate_rt_clk"><i class="fa fa-check"></i><b>6.3.1</b> <code>platform_calibrate_rt_clk</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="api-ref.html"><a href="api-ref.html#platform_rt_rc_auto_tune"><i class="fa fa-check"></i><b>6.3.2</b> <code>platform_rt_rc_auto_tune</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="api-ref.html"><a href="api-ref.html#platform_rt_rc_auto_tune2"><i class="fa fa-check"></i><b>6.3.3</b> <code>platform_rt_rc_auto_tune2</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="api-ref.html"><a href="api-ref.html#platform_rt_rc_tune"><i class="fa fa-check"></i><b>6.3.4</b> <code>platform_rt_rc_tune</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="api-ref.html"><a href="api-ref.html#rf"><i class="fa fa-check"></i><b>6.4</b> RF</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="api-ref.html"><a href="api-ref.html#platform_set_rf_clk_source"><i class="fa fa-check"></i><b>6.4.1</b> <code>platform_set_rf_clk_source</code></a></li>
<li class="chapter" data-level="6.4.2" data-path="api-ref.html"><a href="api-ref.html#platform_set_rf_init_data"><i class="fa fa-check"></i><b>6.4.2</b> <code>platform_set_rf_init_data</code></a></li>
<li class="chapter" data-level="6.4.3" data-path="api-ref.html"><a href="api-ref.html#platform_set_rf_power_mapping"><i class="fa fa-check"></i><b>6.4.3</b> <code>platform_set_rf_power_mapping</code></a></li>
<li class="chapter" data-level="6.4.4" data-path="api-ref.html"><a href="api-ref.html#platform_patch_rf_init_data"><i class="fa fa-check"></i><b>6.4.4</b> <code>platform_patch_rf_init_data</code></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="api-ref.html"><a href="api-ref.html#memory-rtos"><i class="fa fa-check"></i><b>6.5</b> Memory &amp; RTOS</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="api-ref.html"><a href="api-ref.html#platform_call_on_stack"><i class="fa fa-check"></i><b>6.5.1</b> <code>platform_call_on_stack</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="api-ref.html"><a href="api-ref.html#platform_get_current_task"><i class="fa fa-check"></i><b>6.5.2</b> <code>platform_get_current_task</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="api-ref.html"><a href="api-ref.html#platform_get_gen_os_driver"><i class="fa fa-check"></i><b>6.5.3</b> <code>platform_get_gen_os_driver</code></a></li>
<li class="chapter" data-level="6.5.4" data-path="api-ref.html"><a href="api-ref.html#platform_get_heap_status"><i class="fa fa-check"></i><b>6.5.4</b> <code>platform_get_heap_status</code></a></li>
<li class="chapter" data-level="6.5.5" data-path="api-ref.html"><a href="api-ref.html#platform_get_rtos_heap_mem"><i class="fa fa-check"></i><b>6.5.5</b> <code>platform_get_rtos_heap_mem</code></a></li>
<li class="chapter" data-level="6.5.6" data-path="api-ref.html"><a href="api-ref.html#platform_get_task_handle"><i class="fa fa-check"></i><b>6.5.6</b> <code>platform_get_task_handle</code></a></li>
<li class="chapter" data-level="6.5.7" data-path="api-ref.html"><a href="api-ref.html#platform_install_task_stack"><i class="fa fa-check"></i><b>6.5.7</b> <code>platform_install_task_stack</code></a></li>
<li class="chapter" data-level="6.5.8" data-path="api-ref.html"><a href="api-ref.html#platform_install_isr_stack"><i class="fa fa-check"></i><b>6.5.8</b> <code>platform_install_isr_stack</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="api-ref.html"><a href="api-ref.html#time-timers"><i class="fa fa-check"></i><b>6.6</b> Time &amp; Timers</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="api-ref.html"><a href="api-ref.html#platform_cancel_us_timer"><i class="fa fa-check"></i><b>6.6.1</b> <code>platform_cancel_us_timer</code></a></li>
<li class="chapter" data-level="6.6.2" data-path="api-ref.html"><a href="api-ref.html#platform_create_us_timer"><i class="fa fa-check"></i><b>6.6.2</b> <code>platform_create_us_timer</code></a></li>
<li class="chapter" data-level="6.6.3" data-path="api-ref.html"><a href="api-ref.html#platform_create_us_timer2"><i class="fa fa-check"></i><b>6.6.3</b> <code>platform_create_us_timer2</code></a></li>
<li class="chapter" data-level="6.6.4" data-path="api-ref.html"><a href="api-ref.html#platform_delete_timer"><i class="fa fa-check"></i><b>6.6.4</b> <code>platform_delete_timer</code></a></li>
<li class="chapter" data-level="6.6.5" data-path="api-ref.html"><a href="api-ref.html#platform_get_timer_counter"><i class="fa fa-check"></i><b>6.6.5</b> <code>platform_get_timer_counter</code></a></li>
<li class="chapter" data-level="6.6.6" data-path="api-ref.html"><a href="api-ref.html#platform_get_us_time"><i class="fa fa-check"></i><b>6.6.6</b> <code>platform_get_us_time</code></a></li>
<li class="chapter" data-level="6.6.7" data-path="api-ref.html"><a href="api-ref.html#platform_set_abs_timer"><i class="fa fa-check"></i><b>6.6.7</b> <code>platform_set_abs_timer</code></a></li>
<li class="chapter" data-level="6.6.8" data-path="api-ref.html"><a href="api-ref.html#platform_set_timer"><i class="fa fa-check"></i><b>6.6.8</b> <code>platform_set_timer</code></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="api-ref.html"><a href="api-ref.html#power-saving"><i class="fa fa-check"></i><b>6.7</b> Power Saving</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="api-ref.html"><a href="api-ref.html#platform_pre_suppress_cycles_and_sleep_processing"><i class="fa fa-check"></i><b>6.7.1</b> <code>platform_pre_suppress_cycles_and_sleep_processing</code></a></li>
<li class="chapter" data-level="6.7.2" data-path="api-ref.html"><a href="api-ref.html#platform_pre_sleep_processing"><i class="fa fa-check"></i><b>6.7.2</b> <code>platform_pre_sleep_processing</code></a></li>
<li class="chapter" data-level="6.7.3" data-path="api-ref.html"><a href="api-ref.html#platform_post_sleep_processing"><i class="fa fa-check"></i><b>6.7.3</b> <code>platform_post_sleep_processing</code></a></li>
<li class="chapter" data-level="6.7.4" data-path="api-ref.html"><a href="api-ref.html#platform_os_idle_resumed_hook"><i class="fa fa-check"></i><b>6.7.4</b> <code>platform_os_idle_resumed_hook</code></a></li>
<li class="chapter" data-level="6.7.5" data-path="api-ref.html"><a href="api-ref.html#platform_pre_suppress_ticks_and_sleep_processing"><i class="fa fa-check"></i><b>6.7.5</b> <code>platform_pre_suppress_ticks_and_sleep_processing</code></a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="api-ref.html"><a href="api-ref.html#utilities"><i class="fa fa-check"></i><b>6.8</b> Utilities</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="api-ref.html"><a href="api-ref.html#platform_hrng"><i class="fa fa-check"></i><b>6.8.1</b> <code>platform_hrng</code></a></li>
<li class="chapter" data-level="6.8.2" data-path="api-ref.html"><a href="api-ref.html#platform_rand"><i class="fa fa-check"></i><b>6.8.2</b> <code>platform_rand</code></a></li>
<li class="chapter" data-level="6.8.3" data-path="api-ref.html"><a href="api-ref.html#platform_read_persistent_reg"><i class="fa fa-check"></i><b>6.8.3</b> <code>platform_read_persistent_reg</code></a></li>
<li class="chapter" data-level="6.8.4" data-path="api-ref.html"><a href="api-ref.html#platform_reset"><i class="fa fa-check"></i><b>6.8.4</b> <code>platform_reset</code></a></li>
<li class="chapter" data-level="6.8.5" data-path="api-ref.html"><a href="api-ref.html#platform_shutdown"><i class="fa fa-check"></i><b>6.8.5</b> <code>platform_shutdown</code></a></li>
<li class="chapter" data-level="6.8.6" data-path="api-ref.html"><a href="api-ref.html#platform_write_persistent_reg"><i class="fa fa-check"></i><b>6.8.6</b> <code>platform_write_persistent_reg</code></a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="api-ref.html"><a href="api-ref.html#debugging-tracing-1"><i class="fa fa-check"></i><b>6.9</b> Debugging &amp; Tracing</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="api-ref.html"><a href="api-ref.html#platform_printf"><i class="fa fa-check"></i><b>6.9.1</b> <code>platform_printf</code></a></li>
<li class="chapter" data-level="6.9.2" data-path="api-ref.html"><a href="api-ref.html#platform_raise_assertion"><i class="fa fa-check"></i><b>6.9.2</b> <code>platform_raise_assertion</code></a></li>
<li class="chapter" data-level="6.9.3" data-path="api-ref.html"><a href="api-ref.html#platform_trace_raw"><i class="fa fa-check"></i><b>6.9.3</b> <code>platform_trace_raw</code></a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="api-ref.html"><a href="api-ref.html#others"><i class="fa fa-check"></i><b>6.10</b> Others</a>
<ul>
<li class="chapter" data-level="6.10.1" data-path="api-ref.html"><a href="api-ref.html#platform_get_link_layer_interf"><i class="fa fa-check"></i><b>6.10.1</b> <code>platform_get_link_layer_interf</code></a></li>
<li class="chapter" data-level="6.10.2" data-path="api-ref.html"><a href="api-ref.html#syssetpublicdeviceaddr"><i class="fa fa-check"></i><b>6.10.2</b> <code>sysSetPublicDeviceAddr</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="revision-history.html"><a href="revision-history.html"><i class="fa fa-check"></i><b>7</b> Revision History</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">INGCHIPS SDK User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="api-ref" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Platform API Reference<a href="api-ref.html#api-ref" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter describes the platform API.</p>
<div id="configuration-information" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Configuration &amp; Information<a href="api-ref.html#configuration-information" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_config" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> <code>platform_config</code><a href="api-ref.html#platform_config" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Configure some platform functionalities.</p>
<div id="prototype" class="section level4 hasAnchor" number="6.1.1.1">
<h4><span class="header-section-number">6.1.1.1</span> Prototype<a href="api-ref.html#prototype" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb31-1"><a href="api-ref.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_config<span class="op">(</span><span class="dt">const</span> platform_cfg_item_t item<span class="op">,</span></span>
<span id="cb31-2"><a href="api-ref.html#cb31-2" aria-hidden="true" tabindex="-1"></a>                     <span class="dt">const</span> <span class="dt">uint32_t</span> flag<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters" class="section level4 hasAnchor" number="6.1.1.2">
<h4><span class="header-section-number">6.1.1.2</span> Parameters<a href="api-ref.html#parameters" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const platform_cfg_item_t item</code></p>
<p>Specify the item to be configured. It can be one
of following values:</p>
<ul>
<li><p><code>PLATFORM_CFG_LOG_HCI</code>: Print host controller interface messages. Default: Disabled.</p>
<p>Only available on ING918. HCI logging is only intended for a quick check on BLE behavior.
Please consider using tracing (see <a href="dive-into-sdk.html#debugging-tracing">Debugging &amp; Tracing</a>).</p></li>
<li><p><code>PLATFORM_CFG_POWER_SAVING</code>: Power saving. Default: Disabled.</p></li>
<li><p><code>PLATFORM_CFG_TRACE_MASK</code>: Bit map of selected trace items. Default: <code>0</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb32-1"><a href="api-ref.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span></span>
<span id="cb32-2"><a href="api-ref.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb32-3"><a href="api-ref.html#cb32-3" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_EVENT                 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb32-4"><a href="api-ref.html#cb32-4" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_HCI_CMD               <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb32-5"><a href="api-ref.html#cb32-5" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_HCI_EVENT             <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb32-6"><a href="api-ref.html#cb32-6" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_HCI_ACL               <span class="op">=</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb32-7"><a href="api-ref.html#cb32-7" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_LLCP                  <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb32-8"><a href="api-ref.html#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//..</span></span>
<span id="cb32-9"><a href="api-ref.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_trace_item_t<span class="op">;</span></span></code></pre></div></li>
<li><p><code>PLATFORM_CFG_RT_RC_EN</code>: Enable/Disable real-time RC clock. Default: Enabled.</p></li>
<li><p><code>PLATFORM_CFG_RT_OSC_EN</code>: Enable/Disable real-time crystal oscillator. Default: Enabled.</p></li>
<li><p><code>PLATFORM_CFG_RT_CLK</code>: Real-time clock selection. Flag is <code>platform_rt_clk_src_t</code>. Default: <code>PLATFORM_RT_RC</code></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="api-ref.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span></span>
<span id="cb33-2"><a href="api-ref.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb33-3"><a href="api-ref.html#cb33-3" aria-hidden="true" tabindex="-1"></a>    PLATFORM_RT_OSC<span class="op">,</span>           <span class="co">// External real-time crystal oscillator</span></span>
<span id="cb33-4"><a href="api-ref.html#cb33-4" aria-hidden="true" tabindex="-1"></a>    PLATFORM_RT_RC             <span class="co">// Internal real-time RC clock</span></span>
<span id="cb33-5"><a href="api-ref.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_rt_clk_src_t<span class="op">;</span></span></code></pre></div>
<p>For ING918, When modifying this configuration, both RT_RC and RT_OSC should be <strong>enabled</strong> and <strong>run</strong>:</p>
<pre><code>  * For RT_OSC, wait until status of RT_OSC is OK;
  * For RT_RC, wait 100μs after enabled.</code></pre>
<p>And wait another 100μs before disabling the unused clock.</p></li>
<li><p><code>PLATFORM_CFG_RT_CLK_ACC</code>: Configure real-time clock accuracy in ppm.</p></li>
<li><p><code>PLATFORM_CFG_RT_CALI_PERIOD</code>: Real-time clock auto-calibration period in seconds. Default: 3600 * 2 (2 hours).</p></li>
<li><p><code>PLATFORM_CFG_DEEP_SLEEP_TIME_REDUCTION</code>: Sleep time reduction (deep sleep mode) in micro seconds. ING918 Default: ~550μs.</p></li>
<li><p><code>PLATFORM_CFG_SLEEP_TIME_REDUCTION</code>: Sleep time reduction (other sleep mode) in micro seconds. ING918 Default: ~450μs.</p></li>
<li><p><code>PLATFORM_CFG_LL_DBG_FLAGS</code>: Link layer flags. Combination of bits in <code>ll_cfg_flag_t</code>. Check out
<em>Programmers’ Guide on Bluetooth Low Energy</em><a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a> for details.</p></li>
<li><p><code>PLATFORM_CFG_LL_LEGACY_ADV_INTERVAL</code>: Link layer legacy advertising intervals for high duty cycle
(higher 16bits) and normal duty cycle (lower 16bits) in micro seconds. Default for high duty cycle: 1250;
default for normal duty cycle: 1500.</p></li>
<li><p><code>PLATFORM_CFG_RTOS_ENH_TICK</code>: Enable enhanced ticks for RTOS. Default: Disabled.
When enabled, ticks becomes more accurate when peripherals are generating interrupt requests frequently.</p></li>
<li><p><code>PLATFORM_CFG_LL_DELAY_COMPENSATION</code>: Delay compensation for Link Layer.</p>
<p>When system runs at a lower frequency, more time (in μs) is needed by Link Layer to schedule RF tasks.
For example, if ING916 runs at 24MHz, a compensation of ~2500 μs is needed.</p></li>
<li><p><code>PLATFORM_CFG_24M_OSC_TUNE</code>: 24M OSC tunning. Not available for ING918.</p>
<p>For ING916, tunning value may vary in 0x16~0x2d.</p></li>
<li><p><code>PLATFORM_CFG_ALWAYS_CALL_WAKEUP</code>: Always trigger <code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code> event no matter if deep sleep
procedure is completed or aborted (failed). Default for ING918: Disabled for backward compatibility.
Default for ING916: Enabled.</p></li>
<li><p><code>PLATFORM_CFG_FAST_DEEP_SLEEP_TIME_REDUCTION</code>: Sleep time reduction for fast deep sleep mode in micro seconds. Not available for ING918.</p>
<p>This configuration must be less or equal to <code>PLATFORM_CFG_DEEP_SLEEP_TIME_REDUCTION</code>.
When equal to <code>PLATFORM_CFG_DEEP_SLEEP_TIME_REDUCTION</code>, fast deep sleep mode is not used.</p>
<p>Default for ING916: ~2000μs.</p></li>
<li><p><code>PLATFORM_CFG_AUTO_REDUCE_CLOCK_FREQ</code>: Automatically reduce CPU clock frequency in these circumstances:</p>
<ul>
<li>The default IDLE procedure,</li>
<li>When entering sleep modes.</li>
</ul>
<p>Not available for ING918. Default for ING916: Enabled.</p></li>
</ul></li>
<li><p><code>const uint32_t flag</code></p>
<p>To disable or enable an item. It can be one
of following values:</p>
<ul>
<li><code>PLATFORM_CFG_ENABLE</code></li>
<li><code>PLATFORM_CFG_DISABLE</code></li>
</ul></li>
</ul>
</div>
<div id="return-value" class="section level4 hasAnchor" number="6.1.1.3">
<h4><span class="header-section-number">6.1.1.3</span> Return Value<a href="api-ref.html#return-value" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks" class="section level4 hasAnchor" number="6.1.1.4">
<h4><span class="header-section-number">6.1.1.4</span> Remarks<a href="api-ref.html#remarks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="example" class="section level4 hasAnchor" number="6.1.1.5">
<h4><span class="header-section-number">6.1.1.5</span> Example<a href="api-ref.html#example" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb35-1"><a href="api-ref.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">// On ING918, Enable HCI logging</span></span>
<span id="cb35-2"><a href="api-ref.html#cb35-2" aria-hidden="true" tabindex="-1"></a>platform_config<span class="op">(</span>PLATFORM_CFG_LOG_HCI<span class="op">,</span> PLATFORM_CFG_ENABLE<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_get_version" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> <code>platform_get_version</code><a href="api-ref.html#platform_get_version" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Get version number of platform.</p>
<div id="prototype-1" class="section level4 hasAnchor" number="6.1.2.1">
<h4><span class="header-section-number">6.1.2.1</span> Prototype<a href="api-ref.html#prototype-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="api-ref.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> platform_ver_t <span class="op">*</span>platform_get_version<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-1" class="section level4 hasAnchor" number="6.1.2.2">
<h4><span class="header-section-number">6.1.2.2</span> Parameters<a href="api-ref.html#parameters-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-1" class="section level4 hasAnchor" number="6.1.2.3">
<h4><span class="header-section-number">6.1.2.3</span> Return Value<a href="api-ref.html#return-value-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Pointer to <code>platform_ver_t</code>.</p>
</div>
<div id="remarks-1" class="section level4 hasAnchor" number="6.1.2.4">
<h4><span class="header-section-number">6.1.2.4</span> Remarks<a href="api-ref.html#remarks-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Platform version number has three parts, major, minor and patch:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="api-ref.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> platform_ver</span>
<span id="cb37-2"><a href="api-ref.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb37-3"><a href="api-ref.html#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> major<span class="op">;</span></span>
<span id="cb37-4"><a href="api-ref.html#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>  minor<span class="op">;</span></span>
<span id="cb37-5"><a href="api-ref.html#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>  patch<span class="op">;</span></span>
<span id="cb37-6"><a href="api-ref.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_ver_t<span class="op">;</span></span></code></pre></div>
</div>
<div id="example-1" class="section level4 hasAnchor" number="6.1.2.5">
<h4><span class="header-section-number">6.1.2.5</span> Example<a href="api-ref.html#example-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb38"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb38-1"><a href="api-ref.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> platform_ver_t <span class="op">*</span>ver <span class="op">=</span> platform_get_version<span class="op">();</span></span>
<span id="cb38-2"><a href="api-ref.html#cb38-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;Platform version: %d.%d.%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> ver<span class="op">-&gt;</span>major<span class="op">,</span> ver<span class="op">-&gt;</span>minor<span class="op">,</span> ver<span class="op">-&gt;</span>patch<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_read_info" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> <code>platform_read_info</code><a href="api-ref.html#platform_read_info" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Read platform information.</p>
<div id="prototype-2" class="section level4 hasAnchor" number="6.1.3.1">
<h4><span class="header-section-number">6.1.3.1</span> Prototype<a href="api-ref.html#prototype-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb39"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb39-1"><a href="api-ref.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_read_info<span class="op">(</span><span class="dt">const</span> platform_info_item_t item<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-2" class="section level4 hasAnchor" number="6.1.3.2">
<h4><span class="header-section-number">6.1.3.2</span> Parameters<a href="api-ref.html#parameters-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const platform_info_item_t item</code></p>
<p>Information item.</p>
<ul>
<li><code>PLATFORM_INFO_RT_OSC_STATUS</code>: Read status of real-time crystal oscillator.
Value 0: not OK; Non-0: OK.</li>
</ul>
<p>For ING916: this clock become running <strong>after</strong> selected as real time clock
source.</p>
<ul>
<li><p><code>PLATFORM_INFO_RT_CLK_CALI_VALUE</code>: Read current real time clock calibration result.</p></li>
<li><p><code>PLATFOFM_INFO_IRQ_NUMBER</code>: Get the underline IRQ number of a platform IRQ.</p>
<p>For example, get the underline IRQ number of UART0:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb40-1"><a href="api-ref.html#cb40-1" aria-hidden="true" tabindex="-1"></a>platform_read_info<span class="op">(</span></span>
<span id="cb40-2"><a href="api-ref.html#cb40-2" aria-hidden="true" tabindex="-1"></a>    PLATFOFM_INFO_IRQ_NUMBER <span class="op">+</span> PLATFORM_CB_IRQ_UART0<span class="op">)</span></span></code></pre></div></li>
</ul></li>
</ul>
</div>
<div id="return-value-2" class="section level4 hasAnchor" number="6.1.3.3">
<h4><span class="header-section-number">6.1.3.3</span> Return Value<a href="api-ref.html#return-value-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Value of the information item.</p>
</div>
<div id="remarks-2" class="section level4 hasAnchor" number="6.1.3.4">
<h4><span class="header-section-number">6.1.3.4</span> Remarks<a href="api-ref.html#remarks-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="example-2" class="section level4 hasAnchor" number="6.1.3.5">
<h4><span class="header-section-number">6.1.3.5</span> Example<a href="api-ref.html#example-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb41"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb41-1"><a href="api-ref.html#cb41-1" aria-hidden="true" tabindex="-1"></a>platform_read_info<span class="op">(</span>PLATFORM_INFO_RT_OSC_STATUS<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="api-switch-app" class="section level3 hasAnchor" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> <code>platform_switch_app</code><a href="api-ref.html#api-switch-app" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Switch to a secondary app.</p>
<div id="prototype-3" class="section level4 hasAnchor" number="6.1.4.1">
<h4><span class="header-section-number">6.1.4.1</span> Prototype<a href="api-ref.html#prototype-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb42"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb42-1"><a href="api-ref.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_switch_app<span class="op">(</span><span class="dt">const</span> <span class="dt">uint32_t</span> app_addr<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-3" class="section level4 hasAnchor" number="6.1.4.2">
<h4><span class="header-section-number">6.1.4.2</span> Parameters<a href="api-ref.html#parameters-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const uint32_t app_addr</code></p>
<p>Entry address of the secondary app.</p></li>
</ul>
</div>
<div id="return-value-3" class="section level4 hasAnchor" number="6.1.4.3">
<h4><span class="header-section-number">6.1.4.3</span> Return Value<a href="api-ref.html#return-value-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-3" class="section level4 hasAnchor" number="6.1.4.4">
<h4><span class="header-section-number">6.1.4.4</span> Remarks<a href="api-ref.html#remarks-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When calling this function, the code after it will not be executed.</p>
</div>
<div id="example-3" class="section level4 hasAnchor" number="6.1.4.5">
<h4><span class="header-section-number">6.1.4.5</span> Example<a href="api-ref.html#example-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb43"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb43-1"><a href="api-ref.html#cb43-1" aria-hidden="true" tabindex="-1"></a>platform_switch_app<span class="op">(</span><span class="bn">0x80000</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="events-interrupts" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Events &amp; Interrupts<a href="api-ref.html#events-interrupts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_set_evt_callback_table" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> <code>platform_set_evt_callback_table</code><a href="api-ref.html#platform_set_evt_callback_table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Register a callback function table for all platform events.</p>
<div id="prototype-4" class="section level4 hasAnchor" number="6.2.1.1">
<h4><span class="header-section-number">6.2.1.1</span> Prototype<a href="api-ref.html#prototype-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb44"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb44-1"><a href="api-ref.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_evt_callback_table<span class="op">(</span></span>
<span id="cb44-2"><a href="api-ref.html#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> platform_evt_cb_table_t <span class="op">*</span>table<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-4" class="section level4 hasAnchor" number="6.2.1.2">
<h4><span class="header-section-number">6.2.1.2</span> Parameters<a href="api-ref.html#parameters-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const platform_evt_cb_table_t *table</code></p>
<p>Address of the callback function table.</p></li>
</ul>
</div>
<div id="return-value-4" class="section level4 hasAnchor" number="6.2.1.3">
<h4><span class="header-section-number">6.2.1.3</span> Return Value<a href="api-ref.html#return-value-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-4" class="section level4 hasAnchor" number="6.2.1.4">
<h4><span class="header-section-number">6.2.1.4</span> Remarks<a href="api-ref.html#remarks-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This function shall only be called in <code>app_main</code>. If <code>platform_set_evt_callback</code> is used,
this function shall not be used.</p>
<p>Comparing to <code>platform_set_evt_callback</code>, use this function can save a block of RAM
of <code>sizeof(platform_evt_cb_table_t)</code> bytes.</p>
</div>
<div id="example-4" class="section level4 hasAnchor" number="6.2.1.5">
<h4><span class="header-section-number">6.2.1.5</span> Example<a href="api-ref.html#example-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb45"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb45-1"><a href="api-ref.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">const</span> platform_evt_cb_table_t evt_cb_table <span class="op">=</span></span>
<span id="cb45-2"><a href="api-ref.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb45-3"><a href="api-ref.html#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>callbacks <span class="op">=</span> <span class="op">{</span></span>
<span id="cb45-4"><a href="api-ref.html#cb45-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>PLATFORM_CB_EVT_HARD_FAULT<span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb45-5"><a href="api-ref.html#cb45-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>f <span class="op">=</span> <span class="op">(</span>f_platform_evt_cb<span class="op">)</span>cb_hard_fault<span class="op">,</span></span>
<span id="cb45-6"><a href="api-ref.html#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb45-7"><a href="api-ref.html#cb45-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>PLATFORM_CB_EVT_PROFILE_INIT<span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb45-8"><a href="api-ref.html#cb45-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>f <span class="op">=</span> setup_profile<span class="op">,</span></span>
<span id="cb45-9"><a href="api-ref.html#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb45-10"><a href="api-ref.html#cb45-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...</span></span>
<span id="cb45-11"><a href="api-ref.html#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-12"><a href="api-ref.html#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb45-13"><a href="api-ref.html#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="api-ref.html#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> app_main<span class="op">()</span></span>
<span id="cb45-15"><a href="api-ref.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb45-16"><a href="api-ref.html#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb45-17"><a href="api-ref.html#cb45-17" aria-hidden="true" tabindex="-1"></a>    platform_set_evt_callback_table<span class="op">(&amp;</span>evt_cb_table<span class="op">);</span></span>
<span id="cb45-18"><a href="api-ref.html#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb45-19"><a href="api-ref.html#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_irq_callback_table" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> <code>platform_set_irq_callback_table</code><a href="api-ref.html#platform_set_irq_callback_table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Register a callback function table for all platform interrupt requests.</p>
<div id="prototype-5" class="section level4 hasAnchor" number="6.2.2.1">
<h4><span class="header-section-number">6.2.2.1</span> Prototype<a href="api-ref.html#prototype-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb46"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb46-1"><a href="api-ref.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_irq_callback_table<span class="op">(</span></span>
<span id="cb46-2"><a href="api-ref.html#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> platform_irq_cb_table_t <span class="op">*</span>table<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-5" class="section level4 hasAnchor" number="6.2.2.2">
<h4><span class="header-section-number">6.2.2.2</span> Parameters<a href="api-ref.html#parameters-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const platform_irq_cb_table_t *table</code></p>
<p>Address of the callback function table.</p></li>
</ul>
</div>
<div id="return-value-5" class="section level4 hasAnchor" number="6.2.2.3">
<h4><span class="header-section-number">6.2.2.3</span> Return Value<a href="api-ref.html#return-value-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-5" class="section level4 hasAnchor" number="6.2.2.4">
<h4><span class="header-section-number">6.2.2.4</span> Remarks<a href="api-ref.html#remarks-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This function shall only be called in <code>app_main</code>. If <code>platform_set_irq_callback</code> is used,
this function shall not be used.</p>
<p>Comparing to <code>platform_set_irq_callback</code>, use this function can save a block of RAM
of <code>sizeof(platform_irq_cb_table_t)</code> bytes.</p>
</div>
<div id="example-5" class="section level4 hasAnchor" number="6.2.2.5">
<h4><span class="header-section-number">6.2.2.5</span> Example<a href="api-ref.html#example-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb47"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb47-1"><a href="api-ref.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">const</span> platform_irq_cb_table_t irq_cb_table <span class="op">=</span></span>
<span id="cb47-2"><a href="api-ref.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb47-3"><a href="api-ref.html#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>callbacks <span class="op">=</span> <span class="op">{</span></span>
<span id="cb47-4"><a href="api-ref.html#cb47-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>PLATFORM_CB_IRQ_UART0<span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb47-5"><a href="api-ref.html#cb47-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>f <span class="op">=</span> <span class="op">(</span>f_platform_irq_cb<span class="op">)</span>cb_irq_uart<span class="op">,</span></span>
<span id="cb47-6"><a href="api-ref.html#cb47-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>user_data <span class="op">=</span> APB_UART0</span>
<span id="cb47-7"><a href="api-ref.html#cb47-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb47-8"><a href="api-ref.html#cb47-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...</span></span>
<span id="cb47-9"><a href="api-ref.html#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb47-10"><a href="api-ref.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb47-11"><a href="api-ref.html#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="api-ref.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> app_main<span class="op">()</span></span>
<span id="cb47-13"><a href="api-ref.html#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb47-14"><a href="api-ref.html#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb47-15"><a href="api-ref.html#cb47-15" aria-hidden="true" tabindex="-1"></a>    platform_set_irq_callback_table<span class="op">(&amp;</span>irq_cb_table<span class="op">);</span></span>
<span id="cb47-16"><a href="api-ref.html#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb47-17"><a href="api-ref.html#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_evt_callback" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> <code>platform_set_evt_callback</code><a href="api-ref.html#platform_set_evt_callback" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Registers callback functions to platform events.</p>
<div id="prototype-6" class="section level4 hasAnchor" number="6.2.3.1">
<h4><span class="header-section-number">6.2.3.1</span> Prototype<a href="api-ref.html#prototype-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb48"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb48-1"><a href="api-ref.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_evt_callback<span class="op">(</span>platform_evt_callback_type_t type<span class="op">,</span></span>
<span id="cb48-2"><a href="api-ref.html#cb48-2" aria-hidden="true" tabindex="-1"></a>                               f_platform_evt_cb f<span class="op">,</span></span>
<span id="cb48-3"><a href="api-ref.html#cb48-3" aria-hidden="true" tabindex="-1"></a>                               <span class="dt">void</span> <span class="op">*</span>user_data<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-6" class="section level4 hasAnchor" number="6.2.3.2">
<h4><span class="header-section-number">6.2.3.2</span> Parameters<a href="api-ref.html#parameters-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_evt_callback_type_t type</code></p>
<p>Specify the event type to which the callback function is registered. It can be one
of following values:</p>
<ul>
<li><p><code>PLATFORM_CB_EVT_PUTC</code>: Ouput ASCII character event</p>
<p>When platform want to output ASCII characters for logging, this event
is fired. Parameter <code>void *data</code> passed into the callback function is casted from
<code>char *</code>.</p>
<p><code>Wizard</code> can automatically generate code that redirects platform log to UART if
<code>Print to UART</code> is checked on <code>Common Function</code> when creating a new project.</p></li>
<li><p><code>PLATFORM_CB_EVT_PROFILE_INIT</code>: Profile initialization event</p>
<p>When host initializes, this event is fired to request app to initialize GATT profile.</p>
<p><code>Wizard</code> can automatically generate code for this event when creating a new project.</p></li>
<li><p><code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code>: Wakeup from deep sleep event</p>
<p>When waking up from deep sleep, this event is fired. During deep sleep, peripheral
interfaces (such as UART, I2C, etc) are all powered off. So, when waking up, these
interfaces might need to be re-initialized.</p>
<p><code>Wizard</code> can automatically generate code for event if
<code>Deep Sleep</code> is checked on <code>Common Function</code> when creating a new project.</p>
<p>Parameter <code>void *data</code> passed into the callback function is casted from
<code>platform_wakeup_call_info_t *</code>.</p>
<p>RTOS is not resumed yet, some ROTS APIs are not usable; Some platform
APIs (such as <code>platform_get_us_time</code>) might be unusable either.</p></li>
<li><p><code>PLATFORM_CB_EVT_ON_IDLE_TASK_RESUMED</code>: OS is fully resumed from power saving modes.</p>
<p>The callback is invoked after <code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code> if
its reason is <code>PLATFORM_WAKEUP_REASON_NORMAL</code>.
For NoOS variants, the callback is invoked by <code>platform_os_idle_resumed_hook()</code>.
This event is different with <code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code>:</p>
<ul>
<li>all OS functionalities are resumed (For NoOS variants, this depends on the
proper use of <code>platform_os_idle_resumed_hook()</code>)</li>
<li>all platform APIs are functional</li>
<li>callback is invoked in the idle task.</li>
</ul>
<p>Parameter <code>void *data</code> is always <code>NULL</code>.</p></li>
<li><p><code>PLATFORM_CB_EVT_QUERY_DEEP_SLEEP_ALLOWED</code>: Query if deep sleep is allowed event</p>
<p>When platform prepares to enter deep sleep mode, this event is fired to query app
if deep sleep is allow at this moment. Callback function can reject deep sleep
by returning <code>0</code>, and allow it by returning a non-<code>0</code> value.</p>
<p><code>Wizard</code> can automatically generate code for event if
<code>Deep Sleep</code> is checked on <code>Common Function</code> when creating a new project.</p></li>
<li><p><code>PLATFORM_CB_EVT_HARD_FAULT</code>: Hard fault occurs</p>
<p>When hard fault occurs, this event is fired. Parameter <code>void *data</code>
passed into the callback function is casted from <code>hard_fault_info_t *</code>.
If this callback is not defined, CPU enters a dead loop when hard fault occurs.</p></li>
<li><p><code>PLATFORM_CB_EVT_ASSERTION</code>: Software assertion fails</p>
<p>When software assertion fails, this event is fired. Parameter <code>void *data</code>
passed into the callback function is casted from <code>assertion_info_t *</code>.
If this callback is not defined, CPU enters a dead loop when assertion occurs.</p></li>
<li><p><code>PLATFORM_CB_EVT_LLE_INIT</code>: Link layer engine initialized.</p>
<p>When link layer engine initialized, this event is fired.</p></li>
<li><p><code>PLATFORM_CB_EVT_HEAP_OOM</code>: Out of memory.</p>
<p>When allocation on heap fails (heap out of memory), this event is fired.
If this event is fired and no callback is defined, CPU enters a dead loop.
Parameter <code>void *data</code> is casted from an integer identifying which heap is run out:</p>
<ul>
<li><code>0</code>: FreeRTOS’s heap;</li>
<li><code>1</code>: Link Layer’s heap;</li>
<li><code>2</code>: Link Layer’s task pool.</li>
</ul></li>
<li><p><code>PLATFORM_CB_EVT_TRACE</code>: Trace output.</p>
<p>When a trace item is emitted, this event is fired. Apps can define a callback
function for this event to save or log trace output. <code>param</code> to the callback
is casted from <code>platform_trace_evt_t *</code> (See <a href="dive-into-sdk.html#debugging-tracing">Debugging &amp; Tracing</a>).</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb49-1"><a href="api-ref.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span></span>
<span id="cb49-2"><a href="api-ref.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb49-3"><a href="api-ref.html#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>data1<span class="op">;</span></span>
<span id="cb49-4"><a href="api-ref.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>data2<span class="op">;</span></span>
<span id="cb49-5"><a href="api-ref.html#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint16_t</span> len1<span class="op">;</span></span>
<span id="cb49-6"><a href="api-ref.html#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint16_t</span> len2<span class="op">;</span></span>
<span id="cb49-7"><a href="api-ref.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_evt_trace_t<span class="op">;</span></span></code></pre></div>
<p>A trace item is a combination of <code>data1</code> and <code>data2</code>. Note:</p>
<ol style="list-style-type: decimal">
<li><p><code>len1</code> or <code>len2</code> might be 0, but not both;</p></li>
<li><p>If callback function finds that it can’t output data of size
<code>len1</code> + <code>len2</code>, then, both <code>data1</code> &amp; <code>data2</code> should be discarded to avoid
trace item corruption.</p></li>
</ol></li>
<li><p><code>PLATFORM_CB_EVT_EXCEPTION</code>: Hardware exceptions.</p>
<p>Parameter <code>void *data</code> is casted from <code>platform_exception_id_t *</code>.</p></li>
<li><p><code>PLATFORM_CB_EVT_IDLE_PROC</code>: Customized IDLE procedure.</p>
<p>See “Programmer’s Guide - Power Saving”<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a>.</p></li>
<li><p><code>PLATFORM_CB_EVT_HCI_RECV</code>: Take over HCI and isolate the built-in Host completely.</p>
<p>When defined:</p>
<ul>
<li>HCI events and ACL data are passed to this callback;</li>
<li><code>PLATFORM_CB_EVT_PROFILE_INIT</code> is ignored.</li>
</ul>
<p>Parameter <code>void *data</code> is casted from <code>const platform_hci_recv_t *</code>. See also
<a href="api-ref.html#platform_get_link_layer_interf"><code>platform_get_link_layer_interf</code></a>.</p></li>
<li><p><code>PLATFORM_CB_EVT_BEFORE_DEEP_SLEEP</code>: Platform is entering deep sleep mode</p>
<p>When platform decides to enter deep sleep mode, this event is emitted.
Apps can take this opportunity to configure peripherals. The callback
function shall be simple and return as soon as possible.</p>
<p>Parameter <code>void *data</code> is casted from <code>platform_sleep_category_b_t</code>,
representing the selected sleep mode.</p></li>
</ul></li>
<li><p><code>f_platform_evt_cb f</code></p>
<p>The callback function registered to event <code>type</code>. <code>f_platform_evt_cb</code> is:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb50-1"><a href="api-ref.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">uint32_t</span> <span class="op">(*</span>f_platform_evt_cb<span class="op">)(</span><span class="dt">void</span> <span class="op">*</span>data<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>user_data<span class="op">);</span></span></code></pre></div>
<p>Returned value is ignored except explicitly stated.</p></li>
<li><p><code>void *user_data</code></p>
<p>This is passed to callback function’s <code>user_data</code> unchanged.</p></li>
</ul>
</div>
<div id="return-value-6" class="section level4 hasAnchor" number="6.2.3.3">
<h4><span class="header-section-number">6.2.3.3</span> Return Value<a href="api-ref.html#return-value-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-6" class="section level4 hasAnchor" number="6.2.3.4">
<h4><span class="header-section-number">6.2.3.4</span> Remarks<a href="api-ref.html#remarks-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It is not required to register callback functions to each event.</p>
<p>If no callback function is registered to <code>PLATFORM_CB_EVT_PUTC</code> event, all platform log
including <code>platform_printf</code> is discarded.</p>
<p>If no callback function is registered to <code>PLATFORM_CB_EVT_PROFILE_INIT</code> event, BLE device’s
profile is empty.</p>
<p>If no callback function is registered to <code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code> event, app
will not be notified when waking up from deep sleep.</p>
<p>If no callback function is registered to <code>PLATFORM_CB_EVT_QUERY_DEEP_SLEEP_ALLOWED</code> event,
deep sleep is <em>disabled</em>.</p>
</div>
<div id="example-6" class="section level4 hasAnchor" number="6.2.3.5">
<h4><span class="header-section-number">6.2.3.5</span> Example<a href="api-ref.html#example-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb51"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb51-1"><a href="api-ref.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> cb_putc<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>c<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>dummy<span class="op">)</span></span>
<span id="cb51-2"><a href="api-ref.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb51-3"><a href="api-ref.html#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: output char c to UART</span></span>
<span id="cb51-4"><a href="api-ref.html#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb51-5"><a href="api-ref.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-6"><a href="api-ref.html#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="api-ref.html#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="op">......</span></span>
<span id="cb51-8"><a href="api-ref.html#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="api-ref.html#cb51-9" aria-hidden="true" tabindex="-1"></a>platform_set_evt_callback<span class="op">(</span>PLATFORM_CB_EVT_PUTC<span class="op">,</span> <span class="op">(</span>f_platform_evt_cb<span class="op">)</span>cb_putc<span class="op">,</span></span>
<span id="cb51-10"><a href="api-ref.html#cb51-10" aria-hidden="true" tabindex="-1"></a>                          NULL<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_irq_callback" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> <code>platform_set_irq_callback</code><a href="api-ref.html#platform_set_irq_callback" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Registers callback functions to interrupt requests.</p>
<p>Developers do not need to define IRQ handlers in apps, but use callback functions instead.</p>
<div id="prototype-7" class="section level4 hasAnchor" number="6.2.4.1">
<h4><span class="header-section-number">6.2.4.1</span> Prototype<a href="api-ref.html#prototype-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb52"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb52-1"><a href="api-ref.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_irq_callback<span class="op">(</span>platform_irq_callback_type_t type<span class="op">,</span></span>
<span id="cb52-2"><a href="api-ref.html#cb52-2" aria-hidden="true" tabindex="-1"></a>                               f_platform_irq_cb f<span class="op">,</span></span>
<span id="cb52-3"><a href="api-ref.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                               <span class="dt">void</span> <span class="op">*</span>user_data<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-7" class="section level4 hasAnchor" number="6.2.4.2">
<h4><span class="header-section-number">6.2.4.2</span> Parameters<a href="api-ref.html#parameters-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_irq_callback_type_t type</code></p>
<p>Specify the IRQ type to which the callback function is registered. Values vary
for different chip families. Take ING918 as an example:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb53-1"><a href="api-ref.html#cb53-1" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_RTC<span class="op">,</span></span>
<span id="cb53-2"><a href="api-ref.html#cb53-2" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_TIMER0<span class="op">,</span></span>
<span id="cb53-3"><a href="api-ref.html#cb53-3" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_TIMER1<span class="op">,</span></span>
<span id="cb53-4"><a href="api-ref.html#cb53-4" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_TIMER2<span class="op">,</span></span>
<span id="cb53-5"><a href="api-ref.html#cb53-5" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_GPIO<span class="op">,</span></span>
<span id="cb53-6"><a href="api-ref.html#cb53-6" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_SPI0<span class="op">,</span></span>
<span id="cb53-7"><a href="api-ref.html#cb53-7" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_SPI1<span class="op">,</span></span>
<span id="cb53-8"><a href="api-ref.html#cb53-8" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_UART0<span class="op">,</span></span>
<span id="cb53-9"><a href="api-ref.html#cb53-9" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_UART1<span class="op">,</span></span>
<span id="cb53-10"><a href="api-ref.html#cb53-10" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_I2C0<span class="op">,</span></span>
<span id="cb53-11"><a href="api-ref.html#cb53-11" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_I2C1</span></code></pre></div></li>
<li><p><code>f_platform_irq_cb f</code></p>
<p>The callback function registered to IRQ <code>type</code>. <code>f_platform_irq_cb</code> is:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb54-1"><a href="api-ref.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">uint32_t</span> <span class="op">(*</span>f_platform_irq_cb<span class="op">)(</span><span class="dt">void</span> <span class="op">*</span>user_data<span class="op">);</span></span></code></pre></div></li>
<li><p><code>void *user_data</code></p>
<p>This is passed to callback function’s <code>user_data</code> unchanged.</p></li>
</ul>
</div>
<div id="return-value-7" class="section level4 hasAnchor" number="6.2.4.3">
<h4><span class="header-section-number">6.2.4.3</span> Return Value<a href="api-ref.html#return-value-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-7" class="section level4 hasAnchor" number="6.2.4.4">
<h4><span class="header-section-number">6.2.4.4</span> Remarks<a href="api-ref.html#remarks-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When a callback function is registered to an IRQ, the IRQ is enabled automatically.
See also <a href="api-ref.html#platform_enable_irq"><code>platform_enable_irq</code></a>.</p>
</div>
<div id="example-7" class="section level4 hasAnchor" number="6.2.4.5">
<h4><span class="header-section-number">6.2.4.5</span> Example<a href="api-ref.html#example-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb55"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb55-1"><a href="api-ref.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> cb_irq_uart0<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>dummy<span class="op">)</span></span>
<span id="cb55-2"><a href="api-ref.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb55-3"><a href="api-ref.html#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: add UART0 IRQ handling code</span></span>
<span id="cb55-4"><a href="api-ref.html#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb55-5"><a href="api-ref.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb55-6"><a href="api-ref.html#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="api-ref.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="op">......</span></span>
<span id="cb55-8"><a href="api-ref.html#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="api-ref.html#cb55-9" aria-hidden="true" tabindex="-1"></a>platform_set_irq_callback<span class="op">(</span></span>
<span id="cb55-10"><a href="api-ref.html#cb55-10" aria-hidden="true" tabindex="-1"></a>    PLATFORM_CB_IRQ_UART0<span class="op">,</span></span>
<span id="cb55-11"><a href="api-ref.html#cb55-11" aria-hidden="true" tabindex="-1"></a>    cb_irq_uart0<span class="op">,</span></span>
<span id="cb55-12"><a href="api-ref.html#cb55-12" aria-hidden="true" tabindex="-1"></a>    NULL<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_enable_irq" class="section level3 hasAnchor" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> <code>platform_enable_irq</code><a href="api-ref.html#platform_enable_irq" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Enable or disable a specified IRQ.</p>
<div id="prototype-8" class="section level4 hasAnchor" number="6.2.5.1">
<h4><span class="header-section-number">6.2.5.1</span> Prototype<a href="api-ref.html#prototype-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb56"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb56-1"><a href="api-ref.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_enable_irq<span class="op">(</span></span>
<span id="cb56-2"><a href="api-ref.html#cb56-2" aria-hidden="true" tabindex="-1"></a>    platform_irq_callback_type_t type<span class="op">,</span></span>
<span id="cb56-3"><a href="api-ref.html#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> flag<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-8" class="section level4 hasAnchor" number="6.2.5.2">
<h4><span class="header-section-number">6.2.5.2</span> Parameters<a href="api-ref.html#parameters-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_irq_callback_type_t type</code>:</p>
<p>The IRQ to be configured.</p></li>
<li><p><code>uint8_t flag</code>:</p>
<p>Enable (1) or disable (0).</p></li>
</ul>
</div>
<div id="return-value-8" class="section level4 hasAnchor" number="6.2.5.3">
<h4><span class="header-section-number">6.2.5.3</span> Return Value<a href="api-ref.html#return-value-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-8" class="section level4 hasAnchor" number="6.2.5.4">
<h4><span class="header-section-number">6.2.5.4</span> Remarks<a href="api-ref.html#remarks-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>“Enabling” or “disabling” an interrupt here is from the perspective of CPU. Take UART
as an example, UART itself has to be configured to generate interrupts for Rx, Tx, or timeout,
which is out of the scope of this function.</p>
</div>
<div id="example-8" class="section level4 hasAnchor" number="6.2.5.5">
<h4><span class="header-section-number">6.2.5.5</span> Example<a href="api-ref.html#example-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To enable the interrupt request from UART0:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb57-1"><a href="api-ref.html#cb57-1" aria-hidden="true" tabindex="-1"></a>platform_enable_irq<span class="op">(</span></span>
<span id="cb57-2"><a href="api-ref.html#cb57-2" aria-hidden="true" tabindex="-1"></a>    PLATFORM_CB_IRQ_UART0<span class="op">,</span></span>
<span id="cb57-3"><a href="api-ref.html#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="clocks" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Clocks<a href="api-ref.html#clocks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>See also “The Real-time Clock”<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a>
in “Programmer’s Guide - Power Saving”<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>.</p>
<div id="platform_calibrate_rt_clk" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> <code>platform_calibrate_rt_clk</code><a href="api-ref.html#platform_calibrate_rt_clk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Calibrate real-time clock and get the calibration value.</p>
<div id="prototype-9" class="section level4 hasAnchor" number="6.3.1.1">
<h4><span class="header-section-number">6.3.1.1</span> Prototype<a href="api-ref.html#prototype-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb58"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb58-1"><a href="api-ref.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_calibrate_rt_clk<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_rt_rc_auto_tune" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> <code>platform_rt_rc_auto_tune</code><a href="api-ref.html#platform_rt_rc_auto_tune" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Automatically tune the internal real-time RC clock, and get the tuning value.</p>
<p>For ING918, this function tunes the internal real-time RC clock to 50kHz<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a>.
For others, it tunes the internal real-time RC clock to 32768Hz.</p>
<div id="prototype-10" class="section level4 hasAnchor" number="6.3.2.1">
<h4><span class="header-section-number">6.3.2.1</span> Prototype<a href="api-ref.html#prototype-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb59"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb59-1"><a href="api-ref.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint16_t</span> platform_rt_rc_auto_tune<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-9" class="section level4 hasAnchor" number="6.3.2.2">
<h4><span class="header-section-number">6.3.2.2</span> Parameters<a href="api-ref.html#parameters-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-9" class="section level4 hasAnchor" number="6.3.2.3">
<h4><span class="header-section-number">6.3.2.3</span> Return Value<a href="api-ref.html#return-value-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The 16-bits tuning value.</p>
</div>
<div id="remarks-9" class="section level4 hasAnchor" number="6.3.2.4">
<h4><span class="header-section-number">6.3.2.4</span> Remarks<a href="api-ref.html#remarks-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This function must be called if the app enables power saving mode, and the real-time RC
clock is used as the clock source.</p>
<p>This operation costs ~250ms. It is recommended to call this once and store the
returned value for later usage.</p>
</div>
<div id="example-9" class="section level4 hasAnchor" number="6.3.2.5">
<h4><span class="header-section-number">6.3.2.5</span> Example<a href="api-ref.html#example-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb60"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb60-1"><a href="api-ref.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">// the simplest example: call this function in the</span></span>
<span id="cb60-2"><a href="api-ref.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co">// callback function of `PLATFORM_CB_EVT_PROFILE_INIT`</span></span>
<span id="cb60-3"><a href="api-ref.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">// without saving the returned value.</span></span>
<span id="cb60-4"><a href="api-ref.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> setup_profile<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>user_data<span class="op">)</span></span>
<span id="cb60-5"><a href="api-ref.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb60-6"><a href="api-ref.html#cb60-6" aria-hidden="true" tabindex="-1"></a>    platform_rt_rc_auto_tune<span class="op">();</span></span>
<span id="cb60-7"><a href="api-ref.html#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb60-8"><a href="api-ref.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="platform_rt_rc_auto_tune2" class="section level3 hasAnchor" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> <code>platform_rt_rc_auto_tune2</code><a href="api-ref.html#platform_rt_rc_auto_tune2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Automatically tune the internal real-time RC clock to a specific frequency, and get the tuning value.</p>
<div id="prototype-11" class="section level4 hasAnchor" number="6.3.3.1">
<h4><span class="header-section-number">6.3.3.1</span> Prototype<a href="api-ref.html#prototype-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb61"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb61-1"><a href="api-ref.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint16_t</span> platform_rt_rc_auto_tune2<span class="op">(</span></span>
<span id="cb61-2"><a href="api-ref.html#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> target_frequency<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-10" class="section level4 hasAnchor" number="6.3.3.2">
<h4><span class="header-section-number">6.3.3.2</span> Parameters<a href="api-ref.html#parameters-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint32_t target_frequency</code></p>
<p>Target frequency in Hertz.</p></li>
</ul>
</div>
<div id="return-value-10" class="section level4 hasAnchor" number="6.3.3.3">
<h4><span class="header-section-number">6.3.3.3</span> Return Value<a href="api-ref.html#return-value-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The 16-bits tuning value.</p>
</div>
</div>
<div id="platform_rt_rc_tune" class="section level3 hasAnchor" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> <code>platform_rt_rc_tune</code><a href="api-ref.html#platform_rt_rc_tune" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Tune internal the real-time RC clock with the tune value.</p>
<div id="prototype-12" class="section level4 hasAnchor" number="6.3.4.1">
<h4><span class="header-section-number">6.3.4.1</span> Prototype<a href="api-ref.html#prototype-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb62"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb62-1"><a href="api-ref.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_rt_rc_tune<span class="op">(</span><span class="dt">uint16_t</span> value<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-11" class="section level4 hasAnchor" number="6.3.4.2">
<h4><span class="header-section-number">6.3.4.2</span> Parameters<a href="api-ref.html#parameters-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint16_t value</code></p>
<p>Value used to tune the clock (returned by <a href="api-ref.html#platform_rt_rc_auto_tune"><code>platform_rt_rc_auto_tune</code></a>, or <a href="api-ref.html#platform_rt_rc_auto_tune2"><code>platform_rt_rc_auto_tune2</code></a>)</p></li>
</ul>
</div>
<div id="return-value-11" class="section level4 hasAnchor" number="6.3.4.3">
<h4><span class="header-section-number">6.3.4.3</span> Return Value<a href="api-ref.html#return-value-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-10" class="section level4 hasAnchor" number="6.3.4.4">
<h4><span class="header-section-number">6.3.4.4</span> Remarks<a href="api-ref.html#remarks-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>void.</p>
</div>
<div id="example-10" class="section level4 hasAnchor" number="6.3.4.5">
<h4><span class="header-section-number">6.3.4.5</span> Example<a href="api-ref.html#example-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb63"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb63-1"><a href="api-ref.html#cb63-1" aria-hidden="true" tabindex="-1"></a>platform_rt_rc_tune<span class="op">(</span>value<span class="op">);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="rf" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> RF<a href="api-ref.html#rf" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_set_rf_clk_source" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> <code>platform_set_rf_clk_source</code><a href="api-ref.html#platform_set_rf_clk_source" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Select RF clock source. This function is for internal use.</p>
</div>
<div id="platform_set_rf_init_data" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> <code>platform_set_rf_init_data</code><a href="api-ref.html#platform_set_rf_init_data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Customize RF initialization data. This function is for internal use.</p>
</div>
<div id="platform_set_rf_power_mapping" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> <code>platform_set_rf_power_mapping</code><a href="api-ref.html#platform_set_rf_power_mapping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Power level is represented by an index internally. There is a power mapping table
which lists the actual Tx power level of an index. Take ING918 as an example,
power index is in a range of [0..63], and power mapping table is an array of 64
entries, each entry giving the Tx power level in 0.01 dBm.</p>
<p>For applications that need better power level control, actual power level can be measured
for each index. Update the mapping with this function, then the stack can determine
the proper index for a request power level.</p>
<div id="prototype-13" class="section level4 hasAnchor" number="6.4.3.1">
<h4><span class="header-section-number">6.4.3.1</span> Prototype<a href="api-ref.html#prototype-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb64"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb64-1"><a href="api-ref.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_rf_power_mapping<span class="op">(</span></span>
<span id="cb64-2"><a href="api-ref.html#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int16_t</span> <span class="op">*</span>rf_power_mapping<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-12" class="section level4 hasAnchor" number="6.4.3.2">
<h4><span class="header-section-number">6.4.3.2</span> Parameters<a href="api-ref.html#parameters-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const int16_t *rf_power_mapping</code></p>
<p>The new power mapping table.</p></li>
</ul>
</div>
<div id="return-value-12" class="section level4 hasAnchor" number="6.4.3.3">
<h4><span class="header-section-number">6.4.3.3</span> Return Value<a href="api-ref.html#return-value-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-11" class="section level4 hasAnchor" number="6.4.3.4">
<h4><span class="header-section-number">6.4.3.4</span> Remarks<a href="api-ref.html#remarks-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="example-11" class="section level4 hasAnchor" number="6.4.3.5">
<h4><span class="header-section-number">6.4.3.5</span> Example<a href="api-ref.html#example-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb65"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb65-1"><a href="api-ref.html#cb65-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-2"><a href="api-ref.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">const</span> <span class="dt">int16_t</span> power_mapping<span class="op">[]</span> <span class="op">=</span></span>
<span id="cb65-3"><a href="api-ref.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb65-4"><a href="api-ref.html#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="dv">6337</span><span class="op">,</span>  <span class="co">// index 0: -63.37dBm</span></span>
<span id="cb65-5"><a href="api-ref.html#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb65-6"><a href="api-ref.html#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">603</span>     <span class="co">// index 63: 6.03dBm</span></span>
<span id="cb65-7"><a href="api-ref.html#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb65-8"><a href="api-ref.html#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="api-ref.html#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="api-ref.html#cb65-10" aria-hidden="true" tabindex="-1"></a>platform_set_rf_power_mapping<span class="op">(</span></span>
<span id="cb65-11"><a href="api-ref.html#cb65-11" aria-hidden="true" tabindex="-1"></a>    power_mapping<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_patch_rf_init_data" class="section level3 hasAnchor" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> <code>platform_patch_rf_init_data</code><a href="api-ref.html#platform_patch_rf_init_data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Patch part of the internal RF initialization data. This function is for internal use.</p>
</div>
</div>
<div id="memory-rtos" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Memory &amp; RTOS<a href="api-ref.html#memory-rtos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_call_on_stack" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> <code>platform_call_on_stack</code><a href="api-ref.html#platform_call_on_stack" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Call a function on a separate dedicated stack. This is useful when
a function that uses a lot of stack needs to be called, occasionally.</p>
<div id="prototype-14" class="section level4 hasAnchor" number="6.5.1.1">
<h4><span class="header-section-number">6.5.1.1</span> Prototype<a href="api-ref.html#prototype-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb66"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb66-1"><a href="api-ref.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_call_on_stack<span class="op">(</span></span>
<span id="cb66-2"><a href="api-ref.html#cb66-2" aria-hidden="true" tabindex="-1"></a>    f_platform_function f<span class="op">,</span></span>
<span id="cb66-3"><a href="api-ref.html#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>user_data<span class="op">,</span></span>
<span id="cb66-4"><a href="api-ref.html#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>stack_start<span class="op">,</span></span>
<span id="cb66-5"><a href="api-ref.html#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> stack_size<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-13" class="section level4 hasAnchor" number="6.5.1.2">
<h4><span class="header-section-number">6.5.1.2</span> Parameters<a href="api-ref.html#parameters-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>f_platform_function f</code></p>
<p>The function to be called.</p></li>
<li><p><code>void *user_data</code></p>
<p>User data to be passed to <code>f</code>.</p></li>
<li><p><code>void *stack_start</code></p>
<p>Start (lowest) address of the dedicated stack.</p></li>
<li><p><code>uint32_t stack_size</code></p>
<p>Size of the dedicated stack in bytes.</p></li>
</ul>
</div>
<div id="return-value-13" class="section level4 hasAnchor" number="6.5.1.3">
<h4><span class="header-section-number">6.5.1.3</span> Return Value<a href="api-ref.html#return-value-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-12" class="section level4 hasAnchor" number="6.5.1.4">
<h4><span class="header-section-number">6.5.1.4</span> Remarks<a href="api-ref.html#remarks-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Although <code>stack_size</code> is provided, this function does not protect the stack from overwritten by <code>f</code>.</p>
</div>
</div>
<div id="platform_get_current_task" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> <code>platform_get_current_task</code><a href="api-ref.html#platform_get_current_task" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Get the current task from which this API is called.</p>
<div id="prototype-15" class="section level4 hasAnchor" number="6.5.2.1">
<h4><span class="header-section-number">6.5.2.1</span> Prototype<a href="api-ref.html#prototype-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb67"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb67-1"><a href="api-ref.html#cb67-1" aria-hidden="true" tabindex="-1"></a>platform_task_id_t platform_get_current_task<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-14" class="section level4 hasAnchor" number="6.5.2.2">
<h4><span class="header-section-number">6.5.2.2</span> Parameters<a href="api-ref.html#parameters-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-14" class="section level4 hasAnchor" number="6.5.2.3">
<h4><span class="header-section-number">6.5.2.3</span> Return Value<a href="api-ref.html#return-value-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb68"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb68-1"><a href="api-ref.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span></span>
<span id="cb68-2"><a href="api-ref.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb68-3"><a href="api-ref.html#cb68-3" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TASK_CONTROLLER<span class="op">,</span></span>
<span id="cb68-4"><a href="api-ref.html#cb68-4" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TASK_HOST<span class="op">,</span></span>
<span id="cb68-5"><a href="api-ref.html#cb68-5" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TASK_RTOS_TIMER<span class="op">,</span></span>
<span id="cb68-6"><a href="api-ref.html#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_task_id_t<span class="op">;</span></span></code></pre></div>
</div>
<div id="remarks-13" class="section level4 hasAnchor" number="6.5.2.4">
<h4><span class="header-section-number">6.5.2.4</span> Remarks<a href="api-ref.html#remarks-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This API is only available in bundles with built-in RTOS.</p>
</div>
</div>
<div id="platform_get_gen_os_driver" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> <code>platform_get_gen_os_driver</code><a href="api-ref.html#platform_get_gen_os_driver" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Get the generic OS driver. For “NoOS” variants, driver provided by app is returned;
for bundles with built-in RTOS, an emulated driver is returned.</p>
<div id="prototype-16" class="section level4 hasAnchor" number="6.5.3.1">
<h4><span class="header-section-number">6.5.3.1</span> Prototype<a href="api-ref.html#prototype-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb69"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb69-1"><a href="api-ref.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>platform_get_gen_os_driver<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-15" class="section level4 hasAnchor" number="6.5.3.2">
<h4><span class="header-section-number">6.5.3.2</span> Parameters<a href="api-ref.html#parameters-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-15" class="section level4 hasAnchor" number="6.5.3.3">
<h4><span class="header-section-number">6.5.3.3</span> Return Value<a href="api-ref.html#return-value-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Return value is casted from <code>const gen_os_driver_t *</code>. Developers can cast the
return value back to <code>const gen_os_driver_t *</code> and use API in it.</p>
</div>
<div id="remarks-14" class="section level4 hasAnchor" number="6.5.3.4">
<h4><span class="header-section-number">6.5.3.4</span> Remarks<a href="api-ref.html#remarks-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>gen_os_driver_t</code> is an abstract layer over RTOS. Using API in it instead of RTOS API
can make apps cross RTOS (independent of underlying RTOS).</p>
<p>In and after SDK v8.5, since the built-in RTOS can be replaced, things become <em>tricky</em> in
<code>app_main</code>. For backward compatibility, <code>platform_get_gen_os_driver</code> will return
the emulated driver as elder versions. If developers want to replace the built-in RTOS,
this API shall not be used in <code>app_main</code>.</p>
</div>
</div>
<div id="platform_get_heap_status" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> <code>platform_get_heap_status</code><a href="api-ref.html#platform_get_heap_status" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Get current status of built-in RTOS’s heap, such as available size, etc.</p>
<div id="prototype-17" class="section level4 hasAnchor" number="6.5.4.1">
<h4><span class="header-section-number">6.5.4.1</span> Prototype<a href="api-ref.html#prototype-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb70"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb70-1"><a href="api-ref.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_get_heap_status<span class="op">(</span>platform_heap_status_t <span class="op">*</span>status<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-16" class="section level4 hasAnchor" number="6.5.4.2">
<h4><span class="header-section-number">6.5.4.2</span> Parameters<a href="api-ref.html#parameters-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_heap_status_t *status</code></p>
<p>Heap status.</p></li>
</ul>
</div>
<div id="return-value-16" class="section level4 hasAnchor" number="6.5.4.3">
<h4><span class="header-section-number">6.5.4.3</span> Return Value<a href="api-ref.html#return-value-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-15" class="section level4 hasAnchor" number="6.5.4.4">
<h4><span class="header-section-number">6.5.4.4</span> Remarks<a href="api-ref.html#remarks-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Heap status is defined as:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb71-1"><a href="api-ref.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span></span>
<span id="cb71-2"><a href="api-ref.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb71-3"><a href="api-ref.html#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> bytes_free<span class="op">;</span>                <span class="co">// total free bytes</span></span>
<span id="cb71-4"><a href="api-ref.html#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> bytes_minimum_ever_free<span class="op">;</span>   <span class="co">// minimum of bytes_free from startup</span></span>
<span id="cb71-5"><a href="api-ref.html#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_heap_status_t<span class="op">;</span></span></code></pre></div>
</div>
<div id="example-12" class="section level4 hasAnchor" number="6.5.4.5">
<h4><span class="header-section-number">6.5.4.5</span> Example<a href="api-ref.html#example-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb72"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb72-1"><a href="api-ref.html#cb72-1" aria-hidden="true" tabindex="-1"></a>platform_heap_status_t status<span class="op">;</span></span>
<span id="cb72-2"><a href="api-ref.html#cb72-2" aria-hidden="true" tabindex="-1"></a>platform_get_heap_status<span class="op">(&amp;</span>status<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_get_rtos_heap_mem" class="section level3 hasAnchor" number="6.5.5">
<h3><span class="header-section-number">6.5.5</span> <code>platform_get_rtos_heap_mem</code><a href="api-ref.html#platform_get_rtos_heap_mem" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Get memory block used as heap by built-in RTOS.</p>
<div id="prototype-18" class="section level4 hasAnchor" number="6.5.5.1">
<h4><span class="header-section-number">6.5.5.1</span> Prototype<a href="api-ref.html#prototype-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb73"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb73-1"><a href="api-ref.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>platform_get_rtos_heap_mem<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>size<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-17" class="section level4 hasAnchor" number="6.5.5.2">
<h4><span class="header-section-number">6.5.5.2</span> Parameters<a href="api-ref.html#parameters-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>int *size</code></p>
<p>Memory block size in byte.</p></li>
</ul>
</div>
<div id="return-value-17" class="section level4 hasAnchor" number="6.5.5.3">
<h4><span class="header-section-number">6.5.5.3</span> Return Value<a href="api-ref.html#return-value-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Address of memory block.</p>
</div>
<div id="remarks-16" class="section level4 hasAnchor" number="6.5.5.4">
<h4><span class="header-section-number">6.5.5.4</span> Remarks<a href="api-ref.html#remarks-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When replacing built-in RTOS with a customized one, this memory block is not used at all.
Developers can use this API to get its address and size, and utilize it.</p>
</div>
<div id="example-13" class="section level4 hasAnchor" number="6.5.5.5">
<h4><span class="header-section-number">6.5.5.5</span> Example<a href="api-ref.html#example-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb74"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb74-1"><a href="api-ref.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">// initialize this memory block as heap for RT-Thread</span></span>
<span id="cb74-2"><a href="api-ref.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> size <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb74-3"><a href="api-ref.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>heap <span class="op">=</span> platform_get_rtos_heap_mem<span class="op">(&amp;</span>size<span class="op">);</span></span>
<span id="cb74-4"><a href="api-ref.html#cb74-4" aria-hidden="true" tabindex="-1"></a>rt_system_heap_init<span class="op">(</span>heap<span class="op">,</span> heap <span class="op">+</span> size<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_get_task_handle" class="section level3 hasAnchor" number="6.5.6">
<h3><span class="header-section-number">6.5.6</span> <code>platform_get_task_handle</code><a href="api-ref.html#platform_get_task_handle" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Get RTOS handle of a specific platform task.</p>
<div id="prototype-19" class="section level4 hasAnchor" number="6.5.6.1">
<h4><span class="header-section-number">6.5.6.1</span> Prototype<a href="api-ref.html#prototype-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb75"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb75-1"><a href="api-ref.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uintptr_t</span> platform_get_task_handle<span class="op">(</span></span>
<span id="cb75-2"><a href="api-ref.html#cb75-2" aria-hidden="true" tabindex="-1"></a>    platform_task_id_t id<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-18" class="section level4 hasAnchor" number="6.5.6.2">
<h4><span class="header-section-number">6.5.6.2</span> Parameters<a href="api-ref.html#parameters-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_task_id_t id</code></p>
<p>Platform task ID.</p></li>
</ul>
</div>
<div id="return-value-18" class="section level4 hasAnchor" number="6.5.6.3">
<h4><span class="header-section-number">6.5.6.3</span> Return Value<a href="api-ref.html#return-value-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Task handle if such task is known to platform else 0. For example, in the case of
“NoOS” variants, platform does not know the handle of <code>PLATFORM_TASK_RTOS_TIMER</code>,
so 0 is returned.</p>
</div>
</div>
<div id="platform_install_task_stack" class="section level3 hasAnchor" number="6.5.7">
<h3><span class="header-section-number">6.5.7</span> <code>platform_install_task_stack</code><a href="api-ref.html#platform_install_task_stack" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Install a new RTOS stack for a specific platform task.</p>
<p>Use this to enlarge stack when the default stack size is not enough for internal tasks.
For example, user developed RTOS timer callbacks might require a larger stack space.</p>
<p>Developers can check RTOS documentation for how to check stack usages. For example,
<code>uxTaskGetStackHighWaterMark</code> in FreeRTOS is used to query how close a task has
come to overflowing the stack space allocated to it.</p>
<div id="prototype-20" class="section level4 hasAnchor" number="6.5.7.1">
<h4><span class="header-section-number">6.5.7.1</span> Prototype<a href="api-ref.html#prototype-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb76"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb76-1"><a href="api-ref.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_install_task_stack<span class="op">(</span></span>
<span id="cb76-2"><a href="api-ref.html#cb76-2" aria-hidden="true" tabindex="-1"></a>    platform_task_id_t id<span class="op">,</span></span>
<span id="cb76-3"><a href="api-ref.html#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>start<span class="op">,</span></span>
<span id="cb76-4"><a href="api-ref.html#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> size<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-19" class="section level4 hasAnchor" number="6.5.7.2">
<h4><span class="header-section-number">6.5.7.2</span> Parameters<a href="api-ref.html#parameters-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_task_id_t id</code></p>
<p>Task identifier.</p></li>
<li><p><code>void *start</code></p>
<p>Start (lowest) address of the stack. Address shall be properly aligned for underlying CPU.</p></li>
<li><p><code>uint32_t size</code></p>
<p>Size of the new stack in bytes.</p></li>
</ul>
</div>
<div id="return-value-19" class="section level4 hasAnchor" number="6.5.7.3">
<h4><span class="header-section-number">6.5.7.3</span> Return Value<a href="api-ref.html#return-value-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-17" class="section level4 hasAnchor" number="6.5.7.4">
<h4><span class="header-section-number">6.5.7.4</span> Remarks<a href="api-ref.html#remarks-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This function shall only be called in <code>app_main</code>.</p>
<p>For NoOS variants, RTOS stacks can be replaced (modify its size, etc) when implementing
the generic OS interface.</p>
</div>
</div>
<div id="platform_install_isr_stack" class="section level3 hasAnchor" number="6.5.8">
<h3><span class="header-section-number">6.5.8</span> <code>platform_install_isr_stack</code><a href="api-ref.html#platform_install_isr_stack" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Install a new stack for ISR.</p>
<div id="prototype-21" class="section level4 hasAnchor" number="6.5.8.1">
<h4><span class="header-section-number">6.5.8.1</span> Prototype<a href="api-ref.html#prototype-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb77"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb77-1"><a href="api-ref.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_install_isr_stack<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>top<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-20" class="section level4 hasAnchor" number="6.5.8.2">
<h4><span class="header-section-number">6.5.8.2</span> Parameters<a href="api-ref.html#parameters-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>void *top</code></p>
<p>Top of the new stack, which must be properly aligned for the underlying CPU.</p></li>
</ul>
</div>
<div id="return-value-20" class="section level4 hasAnchor" number="6.5.8.3">
<h4><span class="header-section-number">6.5.8.3</span> Return Value<a href="api-ref.html#return-value-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-18" class="section level4 hasAnchor" number="6.5.8.4">
<h4><span class="header-section-number">6.5.8.4</span> Remarks<a href="api-ref.html#remarks-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In case apps need a much larger stack than the default one in ISR, a new stack can be
installed to replace the default one.</p>
<p>This function is only allowed to be called in <code>app_main</code>. The new stack is put into
use after <code>app_main</code> returns.</p>
</div>
<div id="example-14" class="section level4 hasAnchor" number="6.5.8.5">
<h4><span class="header-section-number">6.5.8.5</span> Example<a href="api-ref.html#example-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb78"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb78-1"><a href="api-ref.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> new_stack<span class="op">[</span><span class="dv">2048</span><span class="op">];</span></span>
<span id="cb78-2"><a href="api-ref.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb78-3"><a href="api-ref.html#cb78-3" aria-hidden="true" tabindex="-1"></a>platform_install_isr_stack<span class="op">(</span>new_stack <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span>new_stack<span class="op">)</span> <span class="op">/</span> <span class="kw">sizeof</span><span class="op">(</span>new_stack<span class="op">[</span><span class="dv">0</span><span class="op">]));</span></span></code></pre></div>
</div>
</div>
</div>
<div id="time-timers" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Time &amp; Timers<a href="api-ref.html#time-timers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>API for reading current time (timer counter):</p>
<ul>
<li><code>platform_get_timer_counter</code></li>
<li><code>platform_get_us_time</code></li>
</ul>
<p>API for using timers with 625μs resolution:</p>
<ul>
<li><code>platform_set_abs_timer</code></li>
<li><code>platform_set_timer</code></li>
<li><code>platform_delete_timer</code></li>
</ul>
<p>API for using timers with 1μs resolution:</p>
<ul>
<li><code>platform_create_us_timer</code></li>
<li><code>platform_cancel_us_timer</code></li>
<li><code>platform_create_us_timer2</code></li>
</ul>
<p>Both types of timers can be used with power saving, i.e. it just works as expected
when power saving is enabled. A comparison of of these two types of timers is shown in Table <a href="api-ref.html#tab:ch-api-compare-timers">6.1</a>.</p>
<table style="width:100%;">
<caption><span id="tab:ch-api-compare-timers">Table 6.1: </span> Two Types of Platform Timers</caption>
<colgroup>
<col width="17%" />
<col width="41%" />
<col width="41%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Type</th>
<th align="left">625μs resolution</th>
<th align="left">1μs resolution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Callback</td>
<td align="left">Invoked from a task-like context</td>
<td align="left">Invoked from an ISR or caller</td>
</tr>
<tr class="even">
<td align="center">Identifier</td>
<td align="left">Callback function pointer</td>
<td align="left">Timer handle</td>
</tr>
<tr class="odd">
<td align="center">Capacity</td>
<td align="left">Limited by heap</td>
<td align="left">Only a few</td>
</tr>
</tbody>
</table>
<p>Timers with 1μs resolution are redesigned in SDK v8.5.</p>
<ul>
<li><p>In elder versions,</p>
<p>API are actually wrapper around some Controller functions, where <code>platform_create_us_timer</code>
is scheduling an operation with a duration of 1μs at time <em>T</em>. Therefore, if Controller
<em>will be doing</em> something like Scanning or Advertising around time <em>T</em>, <code>platform_create_us_timer</code> will
fail. Calling <code>platform_create_us_timer</code> in <code>callback</code> is also <strong>forbidden</strong>.</p></li>
<li><p>In and after v8.5,</p>
<p>This type of timer is not a wrapper any more, and <code>platform_create_us_timer</code> will
succeed in such cases and Controller uses this interface for managing all RF operations.
<code>platform_create_us_timer</code> can be called in <code>callback</code>.</p></li>
</ul>
<p><code>platform_create_us_timer</code> allocates data from a dedicated memory pool size of which is fixed and limited.
In and after v8.5, up to 4 timers can be created. Note that Controller uses exactly one such timer.
If Controller fails to create a timer, event <code>PLATFORM_CB_EVT_HEAP_OOM</code> is raised.</p>
<div id="platform_cancel_us_timer" class="section level3 hasAnchor" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> <code>platform_cancel_us_timer</code><a href="api-ref.html#platform_cancel_us_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cancel a platform timer previously created by <code>platform_create_us_timer</code>.</p>
<div id="prototype-22" class="section level4 hasAnchor" number="6.6.1.1">
<h4><span class="header-section-number">6.6.1.1</span> Prototype<a href="api-ref.html#prototype-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb79"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb79-1"><a href="api-ref.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> platform_cancel_us_timer<span class="op">(</span></span>
<span id="cb79-2"><a href="api-ref.html#cb79-2" aria-hidden="true" tabindex="-1"></a>    platform_us_timer_handle_t timer_handle<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-21" class="section level4 hasAnchor" number="6.6.1.2">
<h4><span class="header-section-number">6.6.1.2</span> Parameters<a href="api-ref.html#parameters-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_us_timer_handle_t timer_handle</code></p>
<p>Handle of the timer.</p></li>
</ul>
</div>
<div id="return-value-21" class="section level4 hasAnchor" number="6.6.1.3">
<h4><span class="header-section-number">6.6.1.3</span> Return Value<a href="api-ref.html#return-value-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This function returns 0 if the specified time is canceled successfully. Otherwise,
a non-0 value is returned, which also means the callback function of the timer
is executing.</p>
</div>
</div>
<div id="platform_create_us_timer" class="section level3 hasAnchor" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> <code>platform_create_us_timer</code><a href="api-ref.html#platform_create_us_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Setup a single-shot platform timer with 1 microsecond (μs) resolution.</p>
<div id="prototype-23" class="section level4 hasAnchor" number="6.6.2.1">
<h4><span class="header-section-number">6.6.2.1</span> Prototype<a href="api-ref.html#prototype-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb80"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb80-1"><a href="api-ref.html#cb80-1" aria-hidden="true" tabindex="-1"></a>platform_us_timer_handle_t platform_create_us_timer<span class="op">(</span></span>
<span id="cb80-2"><a href="api-ref.html#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> abs_time<span class="op">,</span></span>
<span id="cb80-3"><a href="api-ref.html#cb80-3" aria-hidden="true" tabindex="-1"></a>    f_platform_us_timer_callback callback<span class="op">,</span></span>
<span id="cb80-4"><a href="api-ref.html#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>param<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-22" class="section level4 hasAnchor" number="6.6.2.2">
<h4><span class="header-section-number">6.6.2.2</span> Parameters<a href="api-ref.html#parameters-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint64_t abs_time</code></p>
<p>When <code>platform_get_us_timer() == abs_time</code>, the callback is invoked.</p></li>
<li><p><code>f_platform_us_timer_callback callback</code></p>
<p>The callback function. The signature is:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb81-1"><a href="api-ref.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">void</span> <span class="op">(*</span> f_platform_us_timer_callback<span class="op">)(</span></span>
<span id="cb81-2"><a href="api-ref.html#cb81-2" aria-hidden="true" tabindex="-1"></a>    platform_us_timer_handle_t timer_handle<span class="op">,</span></span>
<span id="cb81-3"><a href="api-ref.html#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> time_us<span class="op">,</span></span>
<span id="cb81-4"><a href="api-ref.html#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>param<span class="op">);</span></span></code></pre></div>
<p>Where, <code>timer_handle</code> is the returned value of <code>platform_create_us_timer</code>,
i.e., <code>time_us</code> is current value of <code>platform_get_us_timer</code> when invoking the callback,
and <code>param</code> is the user parameter when creating this timer.</p></li>
<li><p><code>void *param</code></p>
<p>User parameter.</p></li>
</ul>
</div>
<div id="return-value-22" class="section level4 hasAnchor" number="6.6.2.3">
<h4><span class="header-section-number">6.6.2.3</span> Return Value<a href="api-ref.html#return-value-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This function returns a handle of the created timer. A non-NULL value is returned
when the timer is successfully created. Otherwise, NULL is returned.</p>
</div>
<div id="remarks-19" class="section level4 hasAnchor" number="6.6.2.4">
<h4><span class="header-section-number">6.6.2.4</span> Remarks<a href="api-ref.html#remarks-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Although <code>abs_time</code> is in microsecond (μs), callback is <strong>not guaranteed</strong> to be
invoked with such resolution.</p>
<p>Pseudo code:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb82-1"><a href="api-ref.html#cb82-1" aria-hidden="true" tabindex="-1"></a>create_us_timer<span class="op">(..)</span></span>
<span id="cb82-2"><a href="api-ref.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb82-3"><a href="api-ref.html#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>out of memory<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb82-4"><a href="api-ref.html#cb82-4" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> allocate a handle<span class="op">;</span></span>
<span id="cb82-5"><a href="api-ref.html#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>timer is too near<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-6"><a href="api-ref.html#cb82-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// callback is invoked immediately in the context of the caller</span></span>
<span id="cb82-7"><a href="api-ref.html#cb82-7" aria-hidden="true" tabindex="-1"></a>        callback<span class="op">(</span>param<span class="op">);</span></span>
<span id="cb82-8"><a href="api-ref.html#cb82-8" aria-hidden="true" tabindex="-1"></a>        free memory<span class="op">;</span></span>
<span id="cb82-9"><a href="api-ref.html#cb82-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> r<span class="op">;</span>        <span class="co">// a non-NULL value is returned</span></span>
<span id="cb82-10"><a href="api-ref.html#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb82-11"><a href="api-ref.html#cb82-11" aria-hidden="true" tabindex="-1"></a>    save r into a queue<span class="op">;</span> <span class="co">// callback will be invoked in an ISR later</span></span>
<span id="cb82-12"><a href="api-ref.html#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r<span class="op">;</span></span>
<span id="cb82-13"><a href="api-ref.html#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="platform_create_us_timer2" class="section level3 hasAnchor" number="6.6.3">
<h3><span class="header-section-number">6.6.3</span> <code>platform_create_us_timer2</code><a href="api-ref.html#platform_create_us_timer2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Setup a single-shot platform timer with 1 microsecond (μs) resolution.</p>
<div id="prototype-24" class="section level4 hasAnchor" number="6.6.3.1">
<h4><span class="header-section-number">6.6.3.1</span> Prototype<a href="api-ref.html#prototype-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb83"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb83-1"><a href="api-ref.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> platform_create_us_timer2<span class="op">(</span></span>
<span id="cb83-2"><a href="api-ref.html#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> abs_time<span class="op">,</span></span>
<span id="cb83-3"><a href="api-ref.html#cb83-3" aria-hidden="true" tabindex="-1"></a>    f_platform_us_timer_callback callback<span class="op">,</span></span>
<span id="cb83-4"><a href="api-ref.html#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>param<span class="op">,</span></span>
<span id="cb83-5"><a href="api-ref.html#cb83-5" aria-hidden="true" tabindex="-1"></a>    platform_us_timer_handle_t <span class="op">*</span>timer_handle<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-23" class="section level4 hasAnchor" number="6.6.3.2">
<h4><span class="header-section-number">6.6.3.2</span> Parameters<a href="api-ref.html#parameters-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint64_t abs_time</code></p>
<p>When <code>platform_get_us_timer() == abs_time</code>, the callback is invoked.</p></li>
<li><p><code>f_platform_us_timer_callback callback</code></p>
<p>The callback function.</p></li>
<li><p><code>void *param</code></p>
<p>User parameter.</p></li>
<li><p><code>platform_us_timer_handle_t *timer_handle</code></p>
<p>Handle of the created timer if successfully created. Otherwise, <code>timer_handle</code>
is set to NULL.</p></li>
</ul>
</div>
<div id="return-value-23" class="section level4 hasAnchor" number="6.6.3.3">
<h4><span class="header-section-number">6.6.3.3</span> Return Value<a href="api-ref.html#return-value-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>0</code> is returned when the timer is successfully created. Otherwise, <code>-1</code> is returned.</p>
</div>
<div id="remarks-20" class="section level4 hasAnchor" number="6.6.3.4">
<h4><span class="header-section-number">6.6.3.4</span> Remarks<a href="api-ref.html#remarks-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It is common practice to clear the handle in the <code>callback</code>. This could be problematic
using <code>platform_create_us_timer</code>. For example:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb84-1"><a href="api-ref.html#cb84-1" aria-hidden="true" tabindex="-1"></a>platform_us_timer_handle_t handle<span class="op">;</span></span>
<span id="cb84-2"><a href="api-ref.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> callback<span class="op">(...)</span></span>
<span id="cb84-3"><a href="api-ref.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb84-4"><a href="api-ref.html#cb84-4" aria-hidden="true" tabindex="-1"></a>    handle <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb84-5"><a href="api-ref.html#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb84-6"><a href="api-ref.html#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="api-ref.html#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">// callback might be called before this functions returns</span></span>
<span id="cb84-8"><a href="api-ref.html#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co">// so, handle would not be cleared.</span></span>
<span id="cb84-9"><a href="api-ref.html#cb84-9" aria-hidden="true" tabindex="-1"></a>handle <span class="op">=</span> platform_create_us_timer<span class="op">(</span>T<span class="op">,</span></span>
<span id="cb84-10"><a href="api-ref.html#cb84-10" aria-hidden="true" tabindex="-1"></a>    callback<span class="op">);</span></span></code></pre></div>
<p><code>platform_create_us_timer2</code> is provided to solve such issues.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb85-1"><a href="api-ref.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">// handle is set properly by `platform_create_us_timer2`</span></span>
<span id="cb85-2"><a href="api-ref.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co">// before calling `callback`.</span></span>
<span id="cb85-3"><a href="api-ref.html#cb85-3" aria-hidden="true" tabindex="-1"></a>platform_create_us_timer2<span class="op">(</span>T<span class="op">,</span></span>
<span id="cb85-4"><a href="api-ref.html#cb85-4" aria-hidden="true" tabindex="-1"></a>    callback<span class="op">,</span></span>
<span id="cb85-5"><a href="api-ref.html#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>handle<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_delete_timer" class="section level3 hasAnchor" number="6.6.4">
<h3><span class="header-section-number">6.6.4</span> <code>platform_delete_timer</code><a href="api-ref.html#platform_delete_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Delete a previously platform timer created by <code>platform_set_timer</code> or <code>platform_set_abs_timer</code>.</p>
<div id="prototype-25" class="section level4 hasAnchor" number="6.6.4.1">
<h4><span class="header-section-number">6.6.4.1</span> Prototype<a href="api-ref.html#prototype-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb86"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb86-1"><a href="api-ref.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_delete_timer<span class="op">(</span>f_platform_timer_callback callback<span class="op">)</span></span></code></pre></div>
</div>
<div id="parameters-24" class="section level4 hasAnchor" number="6.6.4.2">
<h4><span class="header-section-number">6.6.4.2</span> Parameters<a href="api-ref.html#parameters-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>f_platform_timer_callback callback</code></p>
<p>The callback function, which is also an identifier for the timer.</p></li>
</ul>
</div>
<div id="return-value-24" class="section level4 hasAnchor" number="6.6.4.3">
<h4><span class="header-section-number">6.6.4.3</span> Return Value<a href="api-ref.html#return-value-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-21" class="section level4 hasAnchor" number="6.6.4.4">
<h4><span class="header-section-number">6.6.4.4</span> Remarks<a href="api-ref.html#remarks-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When calling this function, the callback might already be
queued for invoking in the task. Therefore, the callback might still be invoked
after this function is called.</p>
</div>
</div>
<div id="platform_get_timer_counter" class="section level3 hasAnchor" number="6.6.5">
<h3><span class="header-section-number">6.6.5</span> <code>platform_get_timer_counter</code><a href="api-ref.html#platform_get_timer_counter" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Read the counter of platform timer at 625μs resolution.</p>
<div id="prototype-26" class="section level4 hasAnchor" number="6.6.5.1">
<h4><span class="header-section-number">6.6.5.1</span> Prototype<a href="api-ref.html#prototype-26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb87"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb87-1"><a href="api-ref.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_get_timer_counter<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-25" class="section level4 hasAnchor" number="6.6.5.2">
<h4><span class="header-section-number">6.6.5.2</span> Parameters<a href="api-ref.html#parameters-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-25" class="section level4 hasAnchor" number="6.6.5.3">
<h4><span class="header-section-number">6.6.5.3</span> Return Value<a href="api-ref.html#return-value-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A full 32 bits value represents current counter, which is roughly
<code>platform_get_us_time() / 625</code>.</p>
</div>
</div>
<div id="platform_get_us_time" class="section level3 hasAnchor" number="6.6.6">
<h3><span class="header-section-number">6.6.6</span> <code>platform_get_us_time</code><a href="api-ref.html#platform_get_us_time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Read the internal time counting from BLE initialization.</p>
<div id="prototype-27" class="section level4 hasAnchor" number="6.6.6.1">
<h4><span class="header-section-number">6.6.6.1</span> Prototype<a href="api-ref.html#prototype-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb88"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb88-1"><a href="api-ref.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int64_t</span> platform_get_us_time<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-26" class="section level4 hasAnchor" number="6.6.6.2">
<h4><span class="header-section-number">6.6.6.2</span> Parameters<a href="api-ref.html#parameters-26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-26" class="section level4 hasAnchor" number="6.6.6.3">
<h4><span class="header-section-number">6.6.6.3</span> Return Value<a href="api-ref.html#return-value-26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Value of the internal time counter counting at 1μs. This counter wraps around every ~21.8 years.</p>
</div>
<div id="remarks-22" class="section level4 hasAnchor" number="6.6.6.4">
<h4><span class="header-section-number">6.6.6.4</span> Remarks<a href="api-ref.html#remarks-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This counter restarts after shutdown.</p>
</div>
<div id="example-15" class="section level4 hasAnchor" number="6.6.6.5">
<h4><span class="header-section-number">6.6.6.5</span> Example<a href="api-ref.html#example-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb89"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb89-1"><a href="api-ref.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint64_t</span> now <span class="op">=</span> platform_get_us_time<span class="op">();</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_abs_timer" class="section level3 hasAnchor" number="6.6.7">
<h3><span class="header-section-number">6.6.7</span> <code>platform_set_abs_timer</code><a href="api-ref.html#platform_set_abs_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Setup a single-shot platform timer triggered at an absolute time with 625μs resolution.</p>
<div id="prototype-28" class="section level4 hasAnchor" number="6.6.7.1">
<h4><span class="header-section-number">6.6.7.1</span> Prototype<a href="api-ref.html#prototype-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb90"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb90-1"><a href="api-ref.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_abs_timer<span class="op">(</span></span>
<span id="cb90-2"><a href="api-ref.html#cb90-2" aria-hidden="true" tabindex="-1"></a>    f_platform_timer_callback callback<span class="op">,</span></span>
<span id="cb90-3"><a href="api-ref.html#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> abs_time<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-27" class="section level4 hasAnchor" number="6.6.7.2">
<h4><span class="header-section-number">6.6.7.2</span> Parameters<a href="api-ref.html#parameters-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>f_platform_timer_callback callback</code></p>
<p>The callback function when the timer expired, and is
called in a RTOS task-like<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a> context, but not an ISR.</p></li>
<li><p><code>uint32_t abs_time</code></p>
<p>when <code>platform_get_timer_counter() == abs_time</code>, <code>callback</code> is invoked.
If <code>abs_time</code> just passes <code>platform_get_timer_counter()</code>, <code>callback</code> is invoked immediately,
for example, <code>abs_time</code> is <code>platform_get_timer_counter() - 1</code>.</p></li>
</ul>
</div>
<div id="return-value-27" class="section level4 hasAnchor" number="6.6.7.3">
<h4><span class="header-section-number">6.6.7.3</span> Return Value<a href="api-ref.html#return-value-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-23" class="section level4 hasAnchor" number="6.6.7.4">
<h4><span class="header-section-number">6.6.7.4</span> Remarks<a href="api-ref.html#remarks-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This function always succeeds, except when running out of memory.</p>
</div>
<div id="example-16" class="section level4 hasAnchor" number="6.6.7.5">
<h4><span class="header-section-number">6.6.7.5</span> Example<a href="api-ref.html#example-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Use this function to emulate a periodic timer.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb91-1"><a href="api-ref.html#cb91-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-2"><a href="api-ref.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PERIOD  100</span></span>
<span id="cb91-3"><a href="api-ref.html#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">uint32_t</span> last_timer <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb91-4"><a href="api-ref.html#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="api-ref.html#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_timer_callback<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb91-6"><a href="api-ref.html#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb91-7"><a href="api-ref.html#cb91-7" aria-hidden="true" tabindex="-1"></a>    last_timer <span class="op">+=</span> PERIOD<span class="op">;</span></span>
<span id="cb91-8"><a href="api-ref.html#cb91-8" aria-hidden="true" tabindex="-1"></a>    platform_set_abs_timer<span class="op">(</span>platform_timer_callback<span class="op">,</span> last_timer<span class="op">);</span></span>
<span id="cb91-9"><a href="api-ref.html#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="api-ref.html#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do periodic job</span></span>
<span id="cb91-11"><a href="api-ref.html#cb91-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb91-12"><a href="api-ref.html#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb91-13"><a href="api-ref.html#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="api-ref.html#cb91-14" aria-hidden="true" tabindex="-1"></a>last_timer <span class="op">=</span> platform_get_timer_counter<span class="op">()</span> <span class="op">+</span> PERIOD<span class="op">;</span></span>
<span id="cb91-15"><a href="api-ref.html#cb91-15" aria-hidden="true" tabindex="-1"></a>platform_set_abs_timer<span class="op">(</span>platform_timer_callback<span class="op">,</span> last_timer<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_timer" class="section level3 hasAnchor" number="6.6.8">
<h3><span class="header-section-number">6.6.8</span> <code>platform_set_timer</code><a href="api-ref.html#platform_set_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Setup a single-shot platform timer after a delay from “now” with 625μs resolution.</p>
<div id="prototype-29" class="section level4 hasAnchor" number="6.6.8.1">
<h4><span class="header-section-number">6.6.8.1</span> Prototype<a href="api-ref.html#prototype-29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb92"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb92-1"><a href="api-ref.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_timer<span class="op">(</span></span>
<span id="cb92-2"><a href="api-ref.html#cb92-2" aria-hidden="true" tabindex="-1"></a>    f_platform_timer_callback callback<span class="op">,</span></span>
<span id="cb92-3"><a href="api-ref.html#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> delay<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-28" class="section level4 hasAnchor" number="6.6.8.2">
<h4><span class="header-section-number">6.6.8.2</span> Parameters<a href="api-ref.html#parameters-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>f_platform_timer_callback callback</code></p>
<p>The callback function when the timer expired, and is
called in a RTOS task-like context, but not an ISR.</p></li>
<li><p><code>uint32_t delay</code></p>
<p>Time delay before the timer expires (unit: 625μs).</p>
<p>Valid Range: 0~0x7fffffff. When <code>delay</code> is 0, the timer is cleared.</p></li>
</ul>
</div>
<div id="return-value-28" class="section level4 hasAnchor" number="6.6.8.3">
<h4><span class="header-section-number">6.6.8.3</span> Return Value<a href="api-ref.html#return-value-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-24" class="section level4 hasAnchor" number="6.6.8.4">
<h4><span class="header-section-number">6.6.8.4</span> Remarks<a href="api-ref.html#remarks-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This function always succeeds, except when running out of memory.</p>
<p><code>platform_set_timer(f, 100)</code> is equivalent to:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb93-1"><a href="api-ref.html#cb93-1" aria-hidden="true" tabindex="-1"></a>platform_set_abs_timer<span class="op">(</span>f<span class="op">,</span></span>
<span id="cb93-2"><a href="api-ref.html#cb93-2" aria-hidden="true" tabindex="-1"></a>    platform_get_timer_counter<span class="op">()</span> <span class="op">+</span> <span class="dv">100</span><span class="op">);</span></span></code></pre></div>
<p><code>platform_set_timer(f, 0)</code> is equivalent to:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb94-1"><a href="api-ref.html#cb94-1" aria-hidden="true" tabindex="-1"></a>platform_delete_timer<span class="op">(</span>f<span class="op">);</span></span></code></pre></div>
<p>but not</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb95-1"><a href="api-ref.html#cb95-1" aria-hidden="true" tabindex="-1"></a>platform_set_abs_timer<span class="op">(</span>f<span class="op">,</span></span>
<span id="cb95-2"><a href="api-ref.html#cb95-2" aria-hidden="true" tabindex="-1"></a>    platform_get_timer_counter<span class="op">()</span> <span class="op">+</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div>
<p>Since <code>callback</code> is also the identifier of the timer, below two lines defines only
a timer expiring after 200 units but not two separate timers:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb96-1"><a href="api-ref.html#cb96-1" aria-hidden="true" tabindex="-1"></a>platform_set_timer<span class="op">(</span>f<span class="op">,</span> <span class="dv">100</span><span class="op">);</span></span>
<span id="cb96-2"><a href="api-ref.html#cb96-2" aria-hidden="true" tabindex="-1"></a>platform_set_timer<span class="op">(</span>f<span class="op">,</span> <span class="dv">200</span><span class="op">);</span> <span class="co">// update the timer, but not creating a new one</span></span></code></pre></div>
<p>If <code>f</code> is used once again in <code>platform_set_abs_timer</code>, then the timer is updated
again:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb97-1"><a href="api-ref.html#cb97-1" aria-hidden="true" tabindex="-1"></a>platform_set_abs_timer<span class="op">(</span>f<span class="op">,</span> <span class="op">...);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="power-saving" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Power Saving<a href="api-ref.html#power-saving" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section provides APIs for implementing power saving in RTOS.
See “Programmer’s Guide - Power Saving”<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a> for more information.</p>
<div id="platform_pre_suppress_cycles_and_sleep_processing" class="section level3 hasAnchor" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> <code>platform_pre_suppress_cycles_and_sleep_processing</code><a href="api-ref.html#platform_pre_suppress_cycles_and_sleep_processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Prepare to suppress some cycles for tick-less power saving.</p>
<div id="prototype-30" class="section level4 hasAnchor" number="6.7.1.1">
<h4><span class="header-section-number">6.7.1.1</span> Prototype<a href="api-ref.html#prototype-30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb98"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb98-1"><a href="api-ref.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_pre_suppress_cycles_and_sleep_processing<span class="op">(</span></span>
<span id="cb98-2"><a href="api-ref.html#cb98-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> expected_cycles<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-29" class="section level4 hasAnchor" number="6.7.1.2">
<h4><span class="header-section-number">6.7.1.2</span> Parameters<a href="api-ref.html#parameters-29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint32_t expected_cycles</code></p>
<p>Excepted cycles that can be suppressed (skipped safely in power saving modes).</p>
<p>Full range of <code>uint32_t</code> is supported.</p></li>
</ul>
</div>
<div id="return-value-29" class="section level4 hasAnchor" number="6.7.1.3">
<h4><span class="header-section-number">6.7.1.3</span> Return Value<a href="api-ref.html#return-value-29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Adjusted cycles that can be suppressed.</p>
</div>
</div>
<div id="platform_pre_sleep_processing" class="section level3 hasAnchor" number="6.7.2">
<h3><span class="header-section-number">6.7.2</span> <code>platform_pre_sleep_processing</code><a href="api-ref.html#platform_pre_sleep_processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Preprocessing for tick-less sleep.</p>
<div id="prototype-31" class="section level4 hasAnchor" number="6.7.2.1">
<h4><span class="header-section-number">6.7.2.1</span> Prototype<a href="api-ref.html#prototype-31" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb99"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb99-1"><a href="api-ref.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_pre_sleep_processing<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-30" class="section level4 hasAnchor" number="6.7.2.2">
<h4><span class="header-section-number">6.7.2.2</span> Parameters<a href="api-ref.html#parameters-30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-30" class="section level4 hasAnchor" number="6.7.2.3">
<h4><span class="header-section-number">6.7.2.3</span> Return Value<a href="api-ref.html#return-value-30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
</div>
<div id="platform_post_sleep_processing" class="section level3 hasAnchor" number="6.7.3">
<h3><span class="header-section-number">6.7.3</span> <code>platform_post_sleep_processing</code><a href="api-ref.html#platform_post_sleep_processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Postprocessing for tick-less sleep.</p>
<div id="prototype-32" class="section level4 hasAnchor" number="6.7.3.1">
<h4><span class="header-section-number">6.7.3.1</span> Prototype<a href="api-ref.html#prototype-32" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb100"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb100-1"><a href="api-ref.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_post_sleep_processing<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-31" class="section level4 hasAnchor" number="6.7.3.2">
<h4><span class="header-section-number">6.7.3.2</span> Parameters<a href="api-ref.html#parameters-31" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-31" class="section level4 hasAnchor" number="6.7.3.3">
<h4><span class="header-section-number">6.7.3.3</span> Return Value<a href="api-ref.html#return-value-31" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-25" class="section level4 hasAnchor" number="6.7.3.4">
<h4><span class="header-section-number">6.7.3.4</span> Remarks<a href="api-ref.html#remarks-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If <code>platform_pre_sleep_processing</code> is called, it must be followed by <code>platform_post_sleep_processing</code>.</p>
</div>
</div>
<div id="platform_os_idle_resumed_hook" class="section level3 hasAnchor" number="6.7.4">
<h3><span class="header-section-number">6.7.4</span> <code>platform_os_idle_resumed_hook</code><a href="api-ref.html#platform_os_idle_resumed_hook" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hook for Idle task got resumed. Call this when Idle task is resumed.</p>
<div id="prototype-33" class="section level4 hasAnchor" number="6.7.4.1">
<h4><span class="header-section-number">6.7.4.1</span> Prototype<a href="api-ref.html#prototype-33" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb101"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb101-1"><a href="api-ref.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_os_idle_resumed_hook<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-32" class="section level4 hasAnchor" number="6.7.4.2">
<h4><span class="header-section-number">6.7.4.2</span> Parameters<a href="api-ref.html#parameters-32" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-32" class="section level4 hasAnchor" number="6.7.4.3">
<h4><span class="header-section-number">6.7.4.3</span> Return Value<a href="api-ref.html#return-value-32" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
</div>
<div id="platform_pre_suppress_ticks_and_sleep_processing" class="section level3 hasAnchor" number="6.7.5">
<h3><span class="header-section-number">6.7.5</span> <code>platform_pre_suppress_ticks_and_sleep_processing</code><a href="api-ref.html#platform_pre_suppress_ticks_and_sleep_processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pre-suppress ticks and sleep processing. This API is obsoleted.
Use <code>platform_pre_suppress_cycles_and_sleep_processing</code> instead.</p>
</div>
</div>
<div id="utilities" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> Utilities<a href="api-ref.html#utilities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_hrng" class="section level3 hasAnchor" number="6.8.1">
<h3><span class="header-section-number">6.8.1</span> <code>platform_hrng</code><a href="api-ref.html#platform_hrng" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Generate random bytes by using hardware random-number generator.</p>
<div id="prototype-34" class="section level4 hasAnchor" number="6.8.1.1">
<h4><span class="header-section-number">6.8.1.1</span> Prototype<a href="api-ref.html#prototype-34" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb102"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb102-1"><a href="api-ref.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>  platform_hrng<span class="op">(</span><span class="dt">uint8_t</span> <span class="op">*</span>bytes<span class="op">,</span> <span class="dt">const</span> <span class="dt">uint32_t</span> len<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-33" class="section level4 hasAnchor" number="6.8.1.2">
<h4><span class="header-section-number">6.8.1.2</span> Parameters<a href="api-ref.html#parameters-33" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint8_t *bytes</code></p>
<p>Random data output.</p></li>
<li><p><code>const uint32_t len</code></p>
<p>Number of random bytes to be generated.</p></li>
</ul>
</div>
<div id="return-value-33" class="section level4 hasAnchor" number="6.8.1.3">
<h4><span class="header-section-number">6.8.1.3</span> Return Value<a href="api-ref.html#return-value-33" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-26" class="section level4 hasAnchor" number="6.8.1.4">
<h4><span class="header-section-number">6.8.1.4</span> Remarks<a href="api-ref.html#remarks-26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Time consumption to generate a fix length of data is undetermined.</p>
</div>
<div id="example-17" class="section level4 hasAnchor" number="6.8.1.5">
<h4><span class="header-section-number">6.8.1.5</span> Example<a href="api-ref.html#example-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb103"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb103-1"><a href="api-ref.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> strong_random<span class="op">;</span></span>
<span id="cb103-2"><a href="api-ref.html#cb103-2" aria-hidden="true" tabindex="-1"></a>platform_hrng<span class="op">(&amp;</span>strong_random<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>strong_random<span class="op">));</span></span></code></pre></div>
</div>
</div>
<div id="platform_rand" class="section level3 hasAnchor" number="6.8.2">
<h3><span class="header-section-number">6.8.2</span> <code>platform_rand</code><a href="api-ref.html#platform_rand" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Generate a pseudo random integer by internal PRNG.</p>
<div id="prototype-35" class="section level4 hasAnchor" number="6.8.2.1">
<h4><span class="header-section-number">6.8.2.1</span> Prototype<a href="api-ref.html#prototype-35" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb104"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb104-1"><a href="api-ref.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> platform_rand<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-34" class="section level4 hasAnchor" number="6.8.2.2">
<h4><span class="header-section-number">6.8.2.2</span> Parameters<a href="api-ref.html#parameters-34" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-34" class="section level4 hasAnchor" number="6.8.2.3">
<h4><span class="header-section-number">6.8.2.3</span> Return Value<a href="api-ref.html#return-value-34" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A pseudo random integer in range of 0 to RAND_MAX.</p>
</div>
<div id="remarks-27" class="section level4 hasAnchor" number="6.8.2.4">
<h4><span class="header-section-number">6.8.2.4</span> Remarks<a href="api-ref.html#remarks-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Seed of the internal PRNG is initialized by HRNG at startup. This function
can be used as a replacement of <code>rand()</code> in standard library.</p>
</div>
<div id="example-18" class="section level4 hasAnchor" number="6.8.2.5">
<h4><span class="header-section-number">6.8.2.5</span> Example<a href="api-ref.html#example-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb105"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb105-1"><a href="api-ref.html#cb105-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;rand: %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> platform_rand<span class="op">());</span></span></code></pre></div>
</div>
</div>
<div id="platform_read_persistent_reg" class="section level3 hasAnchor" number="6.8.3">
<h3><span class="header-section-number">6.8.3</span> <code>platform_read_persistent_reg</code><a href="api-ref.html#platform_read_persistent_reg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Read value from the persistent register. See also
<a href="api-ref.html#platform_write_persistent_reg"><code>platform_write_persistent_reg</code></a>.</p>
<div id="prototype-36" class="section level4 hasAnchor" number="6.8.3.1">
<h4><span class="header-section-number">6.8.3.1</span> Prototype<a href="api-ref.html#prototype-36" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb106"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb106-1"><a href="api-ref.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_read_persistent_reg<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-35" class="section level4 hasAnchor" number="6.8.3.2">
<h4><span class="header-section-number">6.8.3.2</span> Parameters<a href="api-ref.html#parameters-35" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-35" class="section level4 hasAnchor" number="6.8.3.3">
<h4><span class="header-section-number">6.8.3.3</span> Return Value<a href="api-ref.html#return-value-35" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The value written by
<a href="api-ref.html#platform_write_persistent_reg"><code>platform_write_persistent_reg</code></a>.</p>
</div>
<div id="remarks-28" class="section level4 hasAnchor" number="6.8.3.4">
<h4><span class="header-section-number">6.8.3.4</span> Remarks<a href="api-ref.html#remarks-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="example-19" class="section level4 hasAnchor" number="6.8.3.5">
<h4><span class="header-section-number">6.8.3.5</span> Example<a href="api-ref.html#example-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb107"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb107-1"><a href="api-ref.html#cb107-1" aria-hidden="true" tabindex="-1"></a>platform_read_persistent_reg<span class="op">();</span></span></code></pre></div>
</div>
</div>
<div id="platform_reset" class="section level3 hasAnchor" number="6.8.4">
<h3><span class="header-section-number">6.8.4</span> <code>platform_reset</code><a href="api-ref.html#platform_reset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Reset platform (SoC).</p>
<div id="prototype-37" class="section level4 hasAnchor" number="6.8.4.1">
<h4><span class="header-section-number">6.8.4.1</span> Prototype<a href="api-ref.html#prototype-37" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb108"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb108-1"><a href="api-ref.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_reset<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-36" class="section level4 hasAnchor" number="6.8.4.2">
<h4><span class="header-section-number">6.8.4.2</span> Parameters<a href="api-ref.html#parameters-36" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-36" class="section level4 hasAnchor" number="6.8.4.3">
<h4><span class="header-section-number">6.8.4.3</span> Return Value<a href="api-ref.html#return-value-36" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-29" class="section level4 hasAnchor" number="6.8.4.4">
<h4><span class="header-section-number">6.8.4.4</span> Remarks<a href="api-ref.html#remarks-29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When calling this function, the code after it will not be executed.</p>
</div>
<div id="example-20" class="section level4 hasAnchor" number="6.8.4.5">
<h4><span class="header-section-number">6.8.4.5</span> Example<a href="api-ref.html#example-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb109"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb109-1"><a href="api-ref.html#cb109-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>out<span class="op">-</span>of<span class="op">-</span>memory<span class="op">)</span></span>
<span id="cb109-2"><a href="api-ref.html#cb109-2" aria-hidden="true" tabindex="-1"></a>    platform_reset<span class="op">();</span></span></code></pre></div>
</div>
</div>
<div id="platform_shutdown" class="section level3 hasAnchor" number="6.8.5">
<h3><span class="header-section-number">6.8.5</span> <code>platform_shutdown</code><a href="api-ref.html#platform_shutdown" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Bring the whole system into shutdown state, and reboot after a specified duration. Optionally,
a portion of memory can be retained during shutdown, and apps can continue to use it after
reboot.</p>
<p>Note that this function will NOT return except that shutdown procedure fails to initiate.
Possible causes for failures include:</p>
<ol style="list-style-type: decimal">
<li>External wake-up signal is issued;</li>
<li>Input parameters are not proper;</li>
<li>Internal components are busy.</li>
</ol>
<div id="prototype-38" class="section level4 hasAnchor" number="6.8.5.1">
<h4><span class="header-section-number">6.8.5.1</span> Prototype<a href="api-ref.html#prototype-38" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb110"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb110-1"><a href="api-ref.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_shutdown<span class="op">(</span><span class="dt">const</span> <span class="dt">uint32_t</span> duration_cycles<span class="op">,</span></span>
<span id="cb110-2"><a href="api-ref.html#cb110-2" aria-hidden="true" tabindex="-1"></a>                       <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>p_retention_data<span class="op">,</span></span>
<span id="cb110-3"><a href="api-ref.html#cb110-3" aria-hidden="true" tabindex="-1"></a>                       <span class="dt">const</span> <span class="dt">uint32_t</span> data_size<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-37" class="section level4 hasAnchor" number="6.8.5.2">
<h4><span class="header-section-number">6.8.5.2</span> Parameters<a href="api-ref.html#parameters-37" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const uint32_t duration_cycles</code></p>
<p>Duration (measured in cycles of real-time clock) before power on again (reboot).
The minimum duration is 825 cycles (about 25.18ms). If <code>0</code> is used, the system
will stay in shutdown state until external wake-up signal is issued.</p></li>
<li><p><code>const void *p_retention_data</code></p>
<p>Pointer to the start of data to be retained. Only data within SYSTEM memory can be retained.
This parameter can be set to <code>NULL</code> when <code>data_size</code> is <code>0</code>.</p></li>
<li><p><code>data_size</code></p>
<p>Size of the data to be retained. Set to <code>0</code> when memory retention is not needed.</p></li>
</ul>
</div>
<div id="return-value-37" class="section level4 hasAnchor" number="6.8.5.3">
<h4><span class="header-section-number">6.8.5.3</span> Return Value<a href="api-ref.html#return-value-37" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-30" class="section level4 hasAnchor" number="6.8.5.4">
<h4><span class="header-section-number">6.8.5.4</span> Remarks<a href="api-ref.html#remarks-30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="example-21" class="section level4 hasAnchor" number="6.8.5.5">
<h4><span class="header-section-number">6.8.5.5</span> Example<a href="api-ref.html#example-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb111"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb111-1"><a href="api-ref.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Shutdown the system and reboot after 1s.</span></span>
<span id="cb111-2"><a href="api-ref.html#cb111-2" aria-hidden="true" tabindex="-1"></a>platform_shutdown<span class="op">(</span><span class="dv">32768</span><span class="op">,</span> NULL<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_write_persistent_reg" class="section level3 hasAnchor" number="6.8.6">
<h3><span class="header-section-number">6.8.6</span> <code>platform_write_persistent_reg</code><a href="api-ref.html#platform_write_persistent_reg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Write a value to the persistent register.
This value is kept even in power saving, shutdown mode, or when switching to another app.</p>
<p>Only a few bits are saved as shown in Table <a href="api-ref.html#tab:ch-api-reg-bits">6.2</a>.</p>
<table>
<caption><span id="tab:ch-api-reg-bits">Table 6.2: </span> Persistent Register Bit Size</caption>
<thead>
<tr class="header">
<th align="center">Chip Family</th>
<th align="right">Register Size (bit)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ING918</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="center">ING916</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<div id="prototype-39" class="section level4 hasAnchor" number="6.8.6.1">
<h4><span class="header-section-number">6.8.6.1</span> Prototype<a href="api-ref.html#prototype-39" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb112"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb112-1"><a href="api-ref.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_write_persistent_reg<span class="op">(</span><span class="dt">const</span> <span class="dt">uint8_t</span> value<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-38" class="section level4 hasAnchor" number="6.8.6.2">
<h4><span class="header-section-number">6.8.6.2</span> Parameters<a href="api-ref.html#parameters-38" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const uint8_t value</code></p>
<p>The value.</p></li>
</ul>
</div>
<div id="return-value-38" class="section level4 hasAnchor" number="6.8.6.3">
<h4><span class="header-section-number">6.8.6.3</span> Return Value<a href="api-ref.html#return-value-38" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-31" class="section level4 hasAnchor" number="6.8.6.4">
<h4><span class="header-section-number">6.8.6.4</span> Remarks<a href="api-ref.html#remarks-31" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="example-22" class="section level4 hasAnchor" number="6.8.6.5">
<h4><span class="header-section-number">6.8.6.5</span> Example<a href="api-ref.html#example-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb113"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb113-1"><a href="api-ref.html#cb113-1" aria-hidden="true" tabindex="-1"></a>platform_write_persistent_reg<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="debugging-tracing-1" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> Debugging &amp; Tracing<a href="api-ref.html#debugging-tracing-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_printf" class="section level3 hasAnchor" number="6.9.1">
<h3><span class="header-section-number">6.9.1</span> <code>platform_printf</code><a href="api-ref.html#platform_printf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>printf</code> function stored in platform binary.</p>
<div id="prototype-40" class="section level4 hasAnchor" number="6.9.1.1">
<h4><span class="header-section-number">6.9.1.1</span> Prototype<a href="api-ref.html#prototype-40" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb114"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb114-1"><a href="api-ref.html#cb114-1" aria-hidden="true" tabindex="-1"></a> <span class="dt">void</span>  platform_printf<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>format<span class="op">,</span> <span class="op">...);</span></span></code></pre></div>
</div>
<div id="parameters-39" class="section level4 hasAnchor" number="6.9.1.2">
<h4><span class="header-section-number">6.9.1.2</span> Parameters<a href="api-ref.html#parameters-39" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const char *format</code></p>
<p>Format string.</p></li>
<li><p><code>...</code></p>
<p>Variable arguments for format string.</p></li>
</ul>
</div>
<div id="return-value-39" class="section level4 hasAnchor" number="6.9.1.3">
<h4><span class="header-section-number">6.9.1.3</span> Return Value<a href="api-ref.html#return-value-39" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-32" class="section level4 hasAnchor" number="6.9.1.4">
<h4><span class="header-section-number">6.9.1.4</span> Remarks<a href="api-ref.html#remarks-32" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are pros &amp; cons to use this function.</p>
<p>Pros:</p>
<ul>
<li>This function is located in platform binary, app binary size can be saved.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Output is directed <code>PLATFORM_CB_EVT_PUTC</code> event, so its callback function must be defined.</li>
</ul>
</div>
<div id="example-23" class="section level4 hasAnchor" number="6.9.1.5">
<h4><span class="header-section-number">6.9.1.5</span> Example<a href="api-ref.html#example-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb115"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb115-1"><a href="api-ref.html#cb115-1" aria-hidden="true" tabindex="-1"></a>platform_printf<span class="op">(</span><span class="st">&quot;Hello world&quot;</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_raise_assertion" class="section level3 hasAnchor" number="6.9.2">
<h3><span class="header-section-number">6.9.2</span> <code>platform_raise_assertion</code><a href="api-ref.html#platform_raise_assertion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Raise a software assertion.</p>
<div id="prototype-41" class="section level4 hasAnchor" number="6.9.2.1">
<h4><span class="header-section-number">6.9.2.1</span> Prototype<a href="api-ref.html#prototype-41" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb116"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb116-1"><a href="api-ref.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>  platform_raise_assertion<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>file_name<span class="op">,</span> <span class="dt">int</span> line_no<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-40" class="section level4 hasAnchor" number="6.9.2.2">
<h4><span class="header-section-number">6.9.2.2</span> Parameters<a href="api-ref.html#parameters-40" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const char *file_name</code></p>
<p>File name where the assertion occurred.</p></li>
<li><p><code>int line_no</code></p>
<p>Line number where the assertion occurred.</p></li>
</ul>
</div>
<div id="return-value-40" class="section level4 hasAnchor" number="6.9.2.3">
<h4><span class="header-section-number">6.9.2.3</span> Return Value<a href="api-ref.html#return-value-40" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-33" class="section level4 hasAnchor" number="6.9.2.4">
<h4><span class="header-section-number">6.9.2.4</span> Remarks<a href="api-ref.html#remarks-33" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="example-24" class="section level4 hasAnchor" number="6.9.2.5">
<h4><span class="header-section-number">6.9.2.5</span> Example<a href="api-ref.html#example-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb117"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb117-1"><a href="api-ref.html#cb117-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>NULL <span class="op">==</span> ptr<span class="op">)</span></span>
<span id="cb117-2"><a href="api-ref.html#cb117-2" aria-hidden="true" tabindex="-1"></a>    platform_raise_assertion<span class="op">(</span>__FILE__<span class="op">,</span> __LINE__<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_trace_raw" class="section level3 hasAnchor" number="6.9.3">
<h3><span class="header-section-number">6.9.3</span> <code>platform_trace_raw</code><a href="api-ref.html#platform_trace_raw" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Output a block of raw data to TRACE. ID is <code>PLATFORM_TRACE_ID_RAW</code>.</p>
<div id="prototype-42" class="section level4 hasAnchor" number="6.9.3.1">
<h4><span class="header-section-number">6.9.3.1</span> Prototype<a href="api-ref.html#prototype-42" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb118"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb118-1"><a href="api-ref.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_trace_raw<span class="op">(</span></span>
<span id="cb118-2"><a href="api-ref.html#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>buffer<span class="op">,</span></span>
<span id="cb118-3"><a href="api-ref.html#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> byte_len<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-41" class="section level4 hasAnchor" number="6.9.3.2">
<h4><span class="header-section-number">6.9.3.2</span> Parameters<a href="api-ref.html#parameters-41" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const void *buffer</code></p>
<p>Pointer of the buffer.</p></li>
<li><p><code>const int byte_len</code></p>
<p>Length of data buffer in bytes.</p></li>
</ul>
</div>
</div>
</div>
<div id="others" class="section level2 hasAnchor" number="6.10">
<h2><span class="header-section-number">6.10</span> Others<a href="api-ref.html#others" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_get_link_layer_interf" class="section level3 hasAnchor" number="6.10.1">
<h3><span class="header-section-number">6.10.1</span> <code>platform_get_link_layer_interf</code><a href="api-ref.html#platform_get_link_layer_interf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Get link layer driver API.</p>
<div id="prototype-43" class="section level4 hasAnchor" number="6.10.1.1">
<h4><span class="header-section-number">6.10.1.1</span> Prototype<a href="api-ref.html#prototype-43" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb119"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb119-1"><a href="api-ref.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> platform_hci_link_layer_interf_t <span class="op">*</span></span>
<span id="cb119-2"><a href="api-ref.html#cb119-2" aria-hidden="true" tabindex="-1"></a>    platform_get_link_layer_interf<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-42" class="section level4 hasAnchor" number="6.10.1.2">
<h4><span class="header-section-number">6.10.1.2</span> Parameters<a href="api-ref.html#parameters-42" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="return-value-41" class="section level4 hasAnchor" number="6.10.1.3">
<h4><span class="header-section-number">6.10.1.3</span> Return Value<a href="api-ref.html#return-value-41" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The driver interface <code>platform_hci_link_layer_interf_t *</code>.</p>
</div>
<div id="remarks-34" class="section level4 hasAnchor" number="6.10.1.4">
<h4><span class="header-section-number">6.10.1.4</span> Remarks<a href="api-ref.html#remarks-34" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This API exposes the Controller HCI interface. This driver interface is only available
when <code>PLATFORM_CB_EVT_HCI_RECV</code> is defined, in which case, the built in Host is disabled.</p>
</div>
</div>
<div id="syssetpublicdeviceaddr" class="section level3 hasAnchor" number="6.10.2">
<h3><span class="header-section-number">6.10.2</span> <code>sysSetPublicDeviceAddr</code><a href="api-ref.html#syssetpublicdeviceaddr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Set the public address of device.</p>
<p>The public address of a BLE device is a 48-bit extended unique identifier
(EUI-48) created in accordance with the
IEEE 802-2014 standard<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a>.</p>

<div class="rmdcaution">
<em>INGCHIPS</em> 91x <em>DO NOT</em> have public addresses.
This function should <em>ONLY</em> be used for debugging or testing,
and <em>NEVER</em> be used in final products.
</div>
<div id="prototype-44" class="section level4 hasAnchor" number="6.10.2.1">
<h4><span class="header-section-number">6.10.2.1</span> Prototype<a href="api-ref.html#prototype-44" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb120"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb120-1"><a href="api-ref.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sysSetPublicDeviceAddr<span class="op">(</span><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>addr<span class="op">);</span></span></code></pre></div>
</div>
<div id="parameters-43" class="section level4 hasAnchor" number="6.10.2.2">
<h4><span class="header-section-number">6.10.2.2</span> Parameters<a href="api-ref.html#parameters-43" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const unsigned char *addr</code></p>
<p>New public address.</p></li>
</ul>
</div>
<div id="return-value-42" class="section level4 hasAnchor" number="6.10.2.3">
<h4><span class="header-section-number">6.10.2.3</span> Return Value<a href="api-ref.html#return-value-42" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Void.</p>
</div>
<div id="remarks-35" class="section level4 hasAnchor" number="6.10.2.4">
<h4><span class="header-section-number">6.10.2.4</span> Remarks<a href="api-ref.html#remarks-35" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In order to avoid potential issues, this function should be called before calling
any GAP functions.
It is recommended to call this function in <code>app_main</code> or <code>PLATFORM_CB_EVT_PROFILE_INIT</code>
event callback function.</p>
</div>
<div id="example-25" class="section level4 hasAnchor" number="6.10.2.5">
<h4><span class="header-section-number">6.10.2.5</span> Example<a href="api-ref.html#example-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb121"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb121-1"><a href="api-ref.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> pub_addr<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">6</span><span class="op">};</span></span>
<span id="cb121-2"><a href="api-ref.html#cb121-2" aria-hidden="true" tabindex="-1"></a>sysSetPublicDeviceAddr<span class="op">(</span>pub_addr<span class="op">);</span></span></code></pre></div>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="24">
<li id="fn24"><p><a href="https://ingchips.github.io/application-notes/pg_ble_stack_cn/index.html" class="uri">https://ingchips.github.io/application-notes/pg_ble_stack_cn/index.html</a><a href="api-ref.html#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p><a href="https://ingchips.github.io/application-notes/pg_power_saving_en/" class="uri">https://ingchips.github.io/application-notes/pg_power_saving_en/</a><a href="api-ref.html#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p><a href="https://ingchips.github.io/application-notes/pg_power_saving_en/ch-api.html#the-real-time-clock" class="uri">https://ingchips.github.io/application-notes/pg_power_saving_en/ch-api.html#the-real-time-clock</a><a href="api-ref.html#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p><a href="https://ingchips.github.io/application-notes/pg_power_saving_en/" class="uri">https://ingchips.github.io/application-notes/pg_power_saving_en/</a><a href="api-ref.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>Starting from v8.4.6. For elder version, 32768Hz is used.<a href="api-ref.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>It’s called from the Controller task if existing.<a href="api-ref.html#fnref29" class="footnote-back">↩︎</a></p></li>
<li id="fn30"><p><a href="https://ingchips.github.io/application-notes/pg_power_saving_en/" class="uri">https://ingchips.github.io/application-notes/pg_power_saving_en/</a><a href="api-ref.html#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p><a href="http://standards.ieee.org/findstds/standard/802-2014.html" class="uri">http://standards.ieee.org/findstds/standard/802-2014.html</a><a href="api-ref.html#fnref31" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dive-into-sdk.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="revision-history.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["user_guide.pdf", "user_guide.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
