<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Dive Into SDK | INGCHIPS SDK User Guide</title>
  <meta name="description" content="This is the user guide of INGCHIPS SDK." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Dive Into SDK | INGCHIPS SDK User Guide" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="./img/sdk_overview.png" />
  <meta property="og:description" content="This is the user guide of INGCHIPS SDK." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Dive Into SDK | INGCHIPS SDK User Guide" />
  
  <meta name="twitter:description" content="This is the user guide of INGCHIPS SDK." />
  <meta name="twitter:image" content="./img/sdk_overview.png" />

<meta name="author" content="v1.1" />


<meta name="date" content="2020-10-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="core-tools.html"/>
<link rel="next" href="api-ref.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">User Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#scope"><i class="fa fa-check"></i><b>2.1</b> Scope</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#architecture"><i class="fa fa-check"></i><b>2.2</b> Architecture</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#apps-built-with-c"><i class="fa fa-check"></i><b>2.2.1</b> Apps built with <code>C</code></a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#apps-built-with-nim"><i class="fa fa-check"></i><b>2.2.2</b> Apps built with <code>Nim</code></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#abbreviations-terminology"><i class="fa fa-check"></i><b>2.3</b> Abbreviations &amp; Terminology</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#references"><i class="fa fa-check"></i><b>2.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tutorial.html"><a href="tutorial.html"><i class="fa fa-check"></i><b>3</b> Tutorials</a><ul>
<li class="chapter" data-level="3.1" data-path="tutorial.html"><a href="tutorial.html#ch1-hello-world"><i class="fa fa-check"></i><b>3.1</b> Hello World</a><ul>
<li class="chapter" data-level="3.1.1" data-path="tutorial.html"><a href="tutorial.html#development-tool-page"><i class="fa fa-check"></i><b>3.1.1</b> <code>Development Tool</code> Page</a></li>
<li class="chapter" data-level="3.1.2" data-path="tutorial.html"><a href="tutorial.html#choose-chip-series-page"><i class="fa fa-check"></i><b>3.1.2</b> <code>Choose Chip Series</code> Page</a></li>
<li class="chapter" data-level="3.1.3" data-path="tutorial.html"><a href="tutorial.html#choose-project-type-page"><i class="fa fa-check"></i><b>3.1.3</b> <code>Choose Project Type</code> Page</a></li>
<li class="chapter" data-level="3.1.4" data-path="tutorial.html"><a href="tutorial.html#role-of-your-device-page"><i class="fa fa-check"></i><b>3.1.4</b> <code>Role of Your Device</code> Page</a></li>
<li class="chapter" data-level="3.1.5" data-path="tutorial.html"><a href="tutorial.html#peripheral-setup-page"><i class="fa fa-check"></i><b>3.1.5</b> <code>Peripheral Setup</code> Page</a></li>
<li class="chapter" data-level="3.1.6" data-path="tutorial.html"><a href="tutorial.html#security-privacy-page"><i class="fa fa-check"></i><b>3.1.6</b> <code>Security &amp; Privacy</code> Page</a></li>
<li class="chapter" data-level="3.1.7" data-path="tutorial.html"><a href="tutorial.html#firmare-over-the-air-page"><i class="fa fa-check"></i><b>3.1.7</b> <code>Firmare Over-The-Air</code> Page</a></li>
<li class="chapter" data-level="3.1.8" data-path="tutorial.html"><a href="tutorial.html#common-functions-page"><i class="fa fa-check"></i><b>3.1.8</b> <code>Common Functions</code> Page</a></li>
<li class="chapter" data-level="3.1.9" data-path="tutorial.html"><a href="tutorial.html#build-your-project"><i class="fa fa-check"></i><b>3.1.9</b> Build your project</a></li>
<li class="chapter" data-level="3.1.10" data-path="tutorial.html"><a href="tutorial.html#download"><i class="fa fa-check"></i><b>3.1.10</b> Download</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tutorial.html"><a href="tutorial.html#ibeacon"><i class="fa fa-check"></i><b>3.2</b> iBeacon</a><ul>
<li class="chapter" data-level="3.2.1" data-path="tutorial.html"><a href="tutorial.html#setup-advertising-data"><i class="fa fa-check"></i><b>3.2.1</b> Setup Advertising Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="tutorial.html"><a href="tutorial.html#try-it"><i class="fa fa-check"></i><b>3.2.2</b> Try It</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tutorial.html"><a href="tutorial.html#thermometer"><i class="fa fa-check"></i><b>3.3</b> Thermometer</a><ul>
<li class="chapter" data-level="3.3.1" data-path="tutorial.html"><a href="tutorial.html#setup-advertising-data-1"><i class="fa fa-check"></i><b>3.3.1</b> Setup Advertising Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="tutorial.html"><a href="tutorial.html#setup-gatt-profile"><i class="fa fa-check"></i><b>3.3.2</b> Setup GATT Profile</a></li>
<li class="chapter" data-level="3.3.3" data-path="tutorial.html"><a href="tutorial.html#write-the-code"><i class="fa fa-check"></i><b>3.3.3</b> Write the Code</a></li>
<li class="chapter" data-level="3.3.4" data-path="tutorial.html"><a href="tutorial.html#notification"><i class="fa fa-check"></i><b>3.3.4</b> Notification</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tutorial.html"><a href="tutorial.html#thermometer-with-fota"><i class="fa fa-check"></i><b>3.4</b> Thermometer with FOTA</a><ul>
<li class="chapter" data-level="3.4.1" data-path="tutorial.html"><a href="tutorial.html#device-with-fota"><i class="fa fa-check"></i><b>3.4.1</b> Device with FOTA</a></li>
<li class="chapter" data-level="3.4.2" data-path="tutorial.html"><a href="tutorial.html#make-a-new-version"><i class="fa fa-check"></i><b>3.4.2</b> Make a New Version</a></li>
<li class="chapter" data-level="3.4.3" data-path="tutorial.html"><a href="tutorial.html#fota-server"><i class="fa fa-check"></i><b>3.4.3</b> FOTA Server</a></li>
<li class="chapter" data-level="3.4.4" data-path="tutorial.html"><a href="tutorial.html#try-it-1"><i class="fa fa-check"></i><b>3.4.4</b> Try It</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="tutorial.html"><a href="tutorial.html#ibeacon-scanner"><i class="fa fa-check"></i><b>3.5</b> iBeacon Scanner</a><ul>
<li class="chapter" data-level="3.5.1" data-path="tutorial.html"><a href="tutorial.html#distance-estimation"><i class="fa fa-check"></i><b>3.5.1</b> Distance Estimation</a></li>
<li class="chapter" data-level="3.5.2" data-path="tutorial.html"><a href="tutorial.html#concurrent-advertising-scanning"><i class="fa fa-check"></i><b>3.5.2</b> Concurrent Advertising &amp; Scanning</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="tutorial.html"><a href="tutorial.html#notification-indication"><i class="fa fa-check"></i><b>3.6</b> Notification &amp; Indication</a><ul>
<li class="chapter" data-level="3.6.1" data-path="tutorial.html"><a href="tutorial.html#inter-task-comm"><i class="fa fa-check"></i><b>3.6.1</b> Inter-task Communication</a></li>
<li class="chapter" data-level="3.6.2" data-path="tutorial.html"><a href="tutorial.html#timer"><i class="fa fa-check"></i><b>3.6.2</b> Timer</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="tutorial.html"><a href="tutorial.html#throughput"><i class="fa fa-check"></i><b>3.7</b> Throughput</a><ul>
<li class="chapter" data-level="3.7.1" data-path="tutorial.html"><a href="tutorial.html#theoretical-peak-throughput"><i class="fa fa-check"></i><b>3.7.1</b> Theoretical Peak Throughput</a></li>
<li class="chapter" data-level="3.7.2" data-path="tutorial.html"><a href="tutorial.html#test-throughput"><i class="fa fa-check"></i><b>3.7.2</b> Test Throughput</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="tutorial.html"><a href="tutorial.html#dual-role-ble-gateway"><i class="fa fa-check"></i><b>3.8</b> Dual Role &amp; BLE Gateway</a><ul>
<li class="chapter" data-level="3.8.1" data-path="tutorial.html"><a href="tutorial.html#use-ingwizard-to-create-a-peripheral-app"><i class="fa fa-check"></i><b>3.8.1</b> Use <code>ingWizard</code> to create a peripheral app</a></li>
<li class="chapter" data-level="3.8.2" data-path="tutorial.html"><a href="tutorial.html#define-thermometer-data"><i class="fa fa-check"></i><b>3.8.2</b> Define Thermometer Data</a></li>
<li class="chapter" data-level="3.8.3" data-path="tutorial.html"><a href="tutorial.html#scan-for-thermometers"><i class="fa fa-check"></i><b>3.8.3</b> Scan for Thermometers</a></li>
<li class="chapter" data-level="3.8.4" data-path="tutorial.html"><a href="tutorial.html#discover-services"><i class="fa fa-check"></i><b>3.8.4</b> Discover Services</a></li>
<li class="chapter" data-level="3.8.5" data-path="tutorial.html"><a href="tutorial.html#data-handling"><i class="fa fa-check"></i><b>3.8.5</b> Data Handling</a></li>
<li class="chapter" data-level="3.8.6" data-path="tutorial.html"><a href="tutorial.html#robustness"><i class="fa fa-check"></i><b>3.8.6</b> Robustness</a></li>
<li class="chapter" data-level="3.8.7" data-path="tutorial.html"><a href="tutorial.html#prepare-thermometers"><i class="fa fa-check"></i><b>3.8.7</b> Prepare Thermometers</a></li>
<li class="chapter" data-level="3.8.8" data-path="tutorial.html"><a href="tutorial.html#test"><i class="fa fa-check"></i><b>3.8.8</b> Test</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="tutorial.html"><a href="tutorial.html#hello-nim"><i class="fa fa-check"></i><b>3.9</b> Hello, Nim</a><ul>
<li class="chapter" data-level="3.9.1" data-path="tutorial.html"><a href="tutorial.html#create-a-nim-project"><i class="fa fa-check"></i><b>3.9.1</b> Create a <code>Nim</code> Project</a></li>
<li class="chapter" data-level="3.9.2" data-path="tutorial.html"><a href="tutorial.html#create-advertising-data"><i class="fa fa-check"></i><b>3.9.2</b> Create Advertising Data</a></li>
<li class="chapter" data-level="3.9.3" data-path="tutorial.html"><a href="tutorial.html#create-profile-data"><i class="fa fa-check"></i><b>3.9.3</b> Create Profile Data</a></li>
<li class="chapter" data-level="3.9.4" data-path="tutorial.html"><a href="tutorial.html#benefits-of-adopting-nim"><i class="fa fa-check"></i><b>3.9.4</b> Benefits of Adopting <code>Nim</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="core-tools.html"><a href="core-tools.html"><i class="fa fa-check"></i><b>4</b> Core Tools</a><ul>
<li class="chapter" data-level="4.1" data-path="core-tools.html"><a href="core-tools.html#ingwizard"><i class="fa fa-check"></i><b>4.1</b> ingWizard</a></li>
<li class="chapter" data-level="4.2" data-path="core-tools.html"><a href="core-tools.html#ch2-downloader"><i class="fa fa-check"></i><b>4.2</b> Downloader</a><ul>
<li class="chapter" data-level="4.2.1" data-path="core-tools.html"><a href="core-tools.html#introduction"><i class="fa fa-check"></i><b>4.2.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2.2" data-path="core-tools.html"><a href="core-tools.html#script-mass-prod"><i class="fa fa-check"></i><b>4.2.2</b> Scripting &amp; Mass Production</a></li>
<li class="chapter" data-level="4.2.3" data-path="core-tools.html"><a href="core-tools.html#flash-read-protection"><i class="fa fa-check"></i><b>4.2.3</b> Flash Read Protection</a></li>
<li class="chapter" data-level="4.2.4" data-path="core-tools.html"><a href="core-tools.html#python-version"><i class="fa fa-check"></i><b>4.2.4</b> Python Version</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="core-tools.html"><a href="core-tools.html#ingtracer"><i class="fa fa-check"></i><b>4.3</b> ingTracer</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html"><i class="fa fa-check"></i><b>5</b> Dive Into SDK</a><ul>
<li class="chapter" data-level="5.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#memory-management"><i class="fa fa-check"></i><b>5.1</b> Memory Management</a><ul>
<li class="chapter" data-level="5.1.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#global-variables"><i class="fa fa-check"></i><b>5.1.1</b> Global Variables</a></li>
<li class="chapter" data-level="5.1.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#using-stack"><i class="fa fa-check"></i><b>5.1.2</b> Using Stack</a></li>
<li class="chapter" data-level="5.1.3" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#using-heap"><i class="fa fa-check"></i><b>5.1.3</b> Using Heap</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#multitasking"><i class="fa fa-check"></i><b>5.2</b> Multitasking</a></li>
<li class="chapter" data-level="5.3" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#interrupt-management"><i class="fa fa-check"></i><b>5.3</b> Interrupt Management</a></li>
<li class="chapter" data-level="5.4" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#power-management"><i class="fa fa-check"></i><b>5.4</b> Power Management</a></li>
<li class="chapter" data-level="5.5" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#cmsis-api"><i class="fa fa-check"></i><b>5.5</b> CMSIS API</a></li>
<li class="chapter" data-level="5.6" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#debugging-tracing"><i class="fa fa-check"></i><b>5.6</b> Debugging &amp; Tracing</a><ul>
<li class="chapter" data-level="5.6.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#tips-on-segger-rtt"><i class="fa fa-check"></i><b>5.6.1</b> Tips on SEGGER RTT</a></li>
<li class="chapter" data-level="5.6.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#memory-dump"><i class="fa fa-check"></i><b>5.6.2</b> Memory Dump</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="api-ref.html"><a href="api-ref.html"><i class="fa fa-check"></i><b>6</b> Platform API Reference</a><ul>
<li class="chapter" data-level="6.1" data-path="api-ref.html"><a href="api-ref.html#platform_config"><i class="fa fa-check"></i><b>6.1</b> <code>platform_config</code></a><ul>
<li class="chapter" data-level="6.1.1" data-path="api-ref.html"><a href="api-ref.html#prototype"><i class="fa fa-check"></i><b>6.1.1</b> Prototype</a></li>
<li class="chapter" data-level="6.1.2" data-path="api-ref.html"><a href="api-ref.html#parameters"><i class="fa fa-check"></i><b>6.1.2</b> Parameters</a></li>
<li class="chapter" data-level="6.1.3" data-path="api-ref.html"><a href="api-ref.html#return-value"><i class="fa fa-check"></i><b>6.1.3</b> Return Value</a></li>
<li class="chapter" data-level="6.1.4" data-path="api-ref.html"><a href="api-ref.html#remarks"><i class="fa fa-check"></i><b>6.1.4</b> Remarks</a></li>
<li class="chapter" data-level="6.1.5" data-path="api-ref.html"><a href="api-ref.html#example"><i class="fa fa-check"></i><b>6.1.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="api-ref.html"><a href="api-ref.html#platform_get_heap_status"><i class="fa fa-check"></i><b>6.2</b> <code>platform_get_heap_status</code></a><ul>
<li class="chapter" data-level="6.2.1" data-path="api-ref.html"><a href="api-ref.html#prototype-1"><i class="fa fa-check"></i><b>6.2.1</b> Prototype</a></li>
<li class="chapter" data-level="6.2.2" data-path="api-ref.html"><a href="api-ref.html#parameters-1"><i class="fa fa-check"></i><b>6.2.2</b> Parameters</a></li>
<li class="chapter" data-level="6.2.3" data-path="api-ref.html"><a href="api-ref.html#return-value-1"><i class="fa fa-check"></i><b>6.2.3</b> Return Value</a></li>
<li class="chapter" data-level="6.2.4" data-path="api-ref.html"><a href="api-ref.html#remarks-1"><i class="fa fa-check"></i><b>6.2.4</b> Remarks</a></li>
<li class="chapter" data-level="6.2.5" data-path="api-ref.html"><a href="api-ref.html#example-1"><i class="fa fa-check"></i><b>6.2.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="api-ref.html"><a href="api-ref.html#platform_get_us_time"><i class="fa fa-check"></i><b>6.3</b> <code>platform_get_us_time</code></a><ul>
<li class="chapter" data-level="6.3.1" data-path="api-ref.html"><a href="api-ref.html#prototype-2"><i class="fa fa-check"></i><b>6.3.1</b> Prototype</a></li>
<li class="chapter" data-level="6.3.2" data-path="api-ref.html"><a href="api-ref.html#parameters-2"><i class="fa fa-check"></i><b>6.3.2</b> Parameters</a></li>
<li class="chapter" data-level="6.3.3" data-path="api-ref.html"><a href="api-ref.html#return-value-2"><i class="fa fa-check"></i><b>6.3.3</b> Return Value</a></li>
<li class="chapter" data-level="6.3.4" data-path="api-ref.html"><a href="api-ref.html#remarks-2"><i class="fa fa-check"></i><b>6.3.4</b> Remarks</a></li>
<li class="chapter" data-level="6.3.5" data-path="api-ref.html"><a href="api-ref.html#example-2"><i class="fa fa-check"></i><b>6.3.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="api-ref.html"><a href="api-ref.html#platform_get_version"><i class="fa fa-check"></i><b>6.4</b> <code>platform_get_version</code></a><ul>
<li class="chapter" data-level="6.4.1" data-path="api-ref.html"><a href="api-ref.html#prototype-3"><i class="fa fa-check"></i><b>6.4.1</b> Prototype</a></li>
<li class="chapter" data-level="6.4.2" data-path="api-ref.html"><a href="api-ref.html#parameters-3"><i class="fa fa-check"></i><b>6.4.2</b> Parameters</a></li>
<li class="chapter" data-level="6.4.3" data-path="api-ref.html"><a href="api-ref.html#return-value-3"><i class="fa fa-check"></i><b>6.4.3</b> Return Value</a></li>
<li class="chapter" data-level="6.4.4" data-path="api-ref.html"><a href="api-ref.html#remarks-3"><i class="fa fa-check"></i><b>6.4.4</b> Remarks</a></li>
<li class="chapter" data-level="6.4.5" data-path="api-ref.html"><a href="api-ref.html#example-3"><i class="fa fa-check"></i><b>6.4.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="api-ref.html"><a href="api-ref.html#platform_hrng"><i class="fa fa-check"></i><b>6.5</b> <code>platform_hrng</code></a><ul>
<li class="chapter" data-level="6.5.1" data-path="api-ref.html"><a href="api-ref.html#prototype-4"><i class="fa fa-check"></i><b>6.5.1</b> Prototype</a></li>
<li class="chapter" data-level="6.5.2" data-path="api-ref.html"><a href="api-ref.html#parameters-4"><i class="fa fa-check"></i><b>6.5.2</b> Parameters</a></li>
<li class="chapter" data-level="6.5.3" data-path="api-ref.html"><a href="api-ref.html#return-value-4"><i class="fa fa-check"></i><b>6.5.3</b> Return Value</a></li>
<li class="chapter" data-level="6.5.4" data-path="api-ref.html"><a href="api-ref.html#remarks-4"><i class="fa fa-check"></i><b>6.5.4</b> Remarks</a></li>
<li class="chapter" data-level="6.5.5" data-path="api-ref.html"><a href="api-ref.html#example-4"><i class="fa fa-check"></i><b>6.5.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="api-ref.html"><a href="api-ref.html#platform_printf"><i class="fa fa-check"></i><b>6.6</b> <code>platform_printf</code></a><ul>
<li class="chapter" data-level="6.6.1" data-path="api-ref.html"><a href="api-ref.html#prototype-5"><i class="fa fa-check"></i><b>6.6.1</b> Prototype</a></li>
<li class="chapter" data-level="6.6.2" data-path="api-ref.html"><a href="api-ref.html#parameters-5"><i class="fa fa-check"></i><b>6.6.2</b> Parameters</a></li>
<li class="chapter" data-level="6.6.3" data-path="api-ref.html"><a href="api-ref.html#return-value-5"><i class="fa fa-check"></i><b>6.6.3</b> Return Value</a></li>
<li class="chapter" data-level="6.6.4" data-path="api-ref.html"><a href="api-ref.html#remarks-5"><i class="fa fa-check"></i><b>6.6.4</b> Remarks</a></li>
<li class="chapter" data-level="6.6.5" data-path="api-ref.html"><a href="api-ref.html#example-5"><i class="fa fa-check"></i><b>6.6.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="api-ref.html"><a href="api-ref.html#platform_raise_assertion"><i class="fa fa-check"></i><b>6.7</b> <code>platform_raise_assertion</code></a><ul>
<li class="chapter" data-level="6.7.1" data-path="api-ref.html"><a href="api-ref.html#prototype-6"><i class="fa fa-check"></i><b>6.7.1</b> Prototype</a></li>
<li class="chapter" data-level="6.7.2" data-path="api-ref.html"><a href="api-ref.html#parameters-6"><i class="fa fa-check"></i><b>6.7.2</b> Parameters</a></li>
<li class="chapter" data-level="6.7.3" data-path="api-ref.html"><a href="api-ref.html#return-value-6"><i class="fa fa-check"></i><b>6.7.3</b> Return Value</a></li>
<li class="chapter" data-level="6.7.4" data-path="api-ref.html"><a href="api-ref.html#remarks-6"><i class="fa fa-check"></i><b>6.7.4</b> Remarks</a></li>
<li class="chapter" data-level="6.7.5" data-path="api-ref.html"><a href="api-ref.html#example-6"><i class="fa fa-check"></i><b>6.7.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="api-ref.html"><a href="api-ref.html#platform_rand"><i class="fa fa-check"></i><b>6.8</b> <code>platform_rand</code></a><ul>
<li class="chapter" data-level="6.8.1" data-path="api-ref.html"><a href="api-ref.html#prototype-7"><i class="fa fa-check"></i><b>6.8.1</b> Prototype</a></li>
<li class="chapter" data-level="6.8.2" data-path="api-ref.html"><a href="api-ref.html#parameters-7"><i class="fa fa-check"></i><b>6.8.2</b> Parameters</a></li>
<li class="chapter" data-level="6.8.3" data-path="api-ref.html"><a href="api-ref.html#return-value-7"><i class="fa fa-check"></i><b>6.8.3</b> Return Value</a></li>
<li class="chapter" data-level="6.8.4" data-path="api-ref.html"><a href="api-ref.html#remarks-7"><i class="fa fa-check"></i><b>6.8.4</b> Remarks</a></li>
<li class="chapter" data-level="6.8.5" data-path="api-ref.html"><a href="api-ref.html#example-7"><i class="fa fa-check"></i><b>6.8.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="api-ref.html"><a href="api-ref.html#platform_read_info"><i class="fa fa-check"></i><b>6.9</b> <code>platform_read_info</code></a><ul>
<li class="chapter" data-level="6.9.1" data-path="api-ref.html"><a href="api-ref.html#prototype-8"><i class="fa fa-check"></i><b>6.9.1</b> Prototype</a></li>
<li class="chapter" data-level="6.9.2" data-path="api-ref.html"><a href="api-ref.html#parameters-8"><i class="fa fa-check"></i><b>6.9.2</b> Parameters</a></li>
<li class="chapter" data-level="6.9.3" data-path="api-ref.html"><a href="api-ref.html#return-value-8"><i class="fa fa-check"></i><b>6.9.3</b> Return Value</a></li>
<li class="chapter" data-level="6.9.4" data-path="api-ref.html"><a href="api-ref.html#remarks-8"><i class="fa fa-check"></i><b>6.9.4</b> Remarks</a></li>
<li class="chapter" data-level="6.9.5" data-path="api-ref.html"><a href="api-ref.html#example-8"><i class="fa fa-check"></i><b>6.9.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="api-ref.html"><a href="api-ref.html#platform_read_persistent_reg"><i class="fa fa-check"></i><b>6.10</b> <code>platform_read_persistent_reg</code></a><ul>
<li class="chapter" data-level="6.10.1" data-path="api-ref.html"><a href="api-ref.html#prototype-9"><i class="fa fa-check"></i><b>6.10.1</b> Prototype</a></li>
<li class="chapter" data-level="6.10.2" data-path="api-ref.html"><a href="api-ref.html#parameters-9"><i class="fa fa-check"></i><b>6.10.2</b> Parameters</a></li>
<li class="chapter" data-level="6.10.3" data-path="api-ref.html"><a href="api-ref.html#return-value-9"><i class="fa fa-check"></i><b>6.10.3</b> Return Value</a></li>
<li class="chapter" data-level="6.10.4" data-path="api-ref.html"><a href="api-ref.html#remarks-9"><i class="fa fa-check"></i><b>6.10.4</b> Remarks</a></li>
<li class="chapter" data-level="6.10.5" data-path="api-ref.html"><a href="api-ref.html#example-9"><i class="fa fa-check"></i><b>6.10.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.11" data-path="api-ref.html"><a href="api-ref.html#platform_reset"><i class="fa fa-check"></i><b>6.11</b> <code>platform_reset</code></a><ul>
<li class="chapter" data-level="6.11.1" data-path="api-ref.html"><a href="api-ref.html#prototype-10"><i class="fa fa-check"></i><b>6.11.1</b> Prototype</a></li>
<li class="chapter" data-level="6.11.2" data-path="api-ref.html"><a href="api-ref.html#parameters-10"><i class="fa fa-check"></i><b>6.11.2</b> Parameters</a></li>
<li class="chapter" data-level="6.11.3" data-path="api-ref.html"><a href="api-ref.html#return-value-10"><i class="fa fa-check"></i><b>6.11.3</b> Return Value</a></li>
<li class="chapter" data-level="6.11.4" data-path="api-ref.html"><a href="api-ref.html#remarks-10"><i class="fa fa-check"></i><b>6.11.4</b> Remarks</a></li>
<li class="chapter" data-level="6.11.5" data-path="api-ref.html"><a href="api-ref.html#example-10"><i class="fa fa-check"></i><b>6.11.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.12" data-path="api-ref.html"><a href="api-ref.html#platform_set_evt_callback"><i class="fa fa-check"></i><b>6.12</b> <code>platform_set_evt_callback</code></a><ul>
<li class="chapter" data-level="6.12.1" data-path="api-ref.html"><a href="api-ref.html#prototype-11"><i class="fa fa-check"></i><b>6.12.1</b> Prototype</a></li>
<li class="chapter" data-level="6.12.2" data-path="api-ref.html"><a href="api-ref.html#parameters-11"><i class="fa fa-check"></i><b>6.12.2</b> Parameters</a></li>
<li class="chapter" data-level="6.12.3" data-path="api-ref.html"><a href="api-ref.html#return-value-11"><i class="fa fa-check"></i><b>6.12.3</b> Return Value</a></li>
<li class="chapter" data-level="6.12.4" data-path="api-ref.html"><a href="api-ref.html#remarks-11"><i class="fa fa-check"></i><b>6.12.4</b> Remarks</a></li>
<li class="chapter" data-level="6.12.5" data-path="api-ref.html"><a href="api-ref.html#example-11"><i class="fa fa-check"></i><b>6.12.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.13" data-path="api-ref.html"><a href="api-ref.html#platform_set_irq_callback"><i class="fa fa-check"></i><b>6.13</b> <code>platform_set_irq_callback</code></a><ul>
<li class="chapter" data-level="6.13.1" data-path="api-ref.html"><a href="api-ref.html#prototype-12"><i class="fa fa-check"></i><b>6.13.1</b> Prototype</a></li>
<li class="chapter" data-level="6.13.2" data-path="api-ref.html"><a href="api-ref.html#parameters-12"><i class="fa fa-check"></i><b>6.13.2</b> Parameters</a></li>
<li class="chapter" data-level="6.13.3" data-path="api-ref.html"><a href="api-ref.html#return-value-12"><i class="fa fa-check"></i><b>6.13.3</b> Return Value</a></li>
<li class="chapter" data-level="6.13.4" data-path="api-ref.html"><a href="api-ref.html#remarks-12"><i class="fa fa-check"></i><b>6.13.4</b> Remarks</a></li>
<li class="chapter" data-level="6.13.5" data-path="api-ref.html"><a href="api-ref.html#example-12"><i class="fa fa-check"></i><b>6.13.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.14" data-path="api-ref.html"><a href="api-ref.html#platform_shutdown"><i class="fa fa-check"></i><b>6.14</b> <code>platform_shutdown</code></a><ul>
<li class="chapter" data-level="6.14.1" data-path="api-ref.html"><a href="api-ref.html#prototype-13"><i class="fa fa-check"></i><b>6.14.1</b> Prototype</a></li>
<li class="chapter" data-level="6.14.2" data-path="api-ref.html"><a href="api-ref.html#parameters-13"><i class="fa fa-check"></i><b>6.14.2</b> Parameters</a></li>
<li class="chapter" data-level="6.14.3" data-path="api-ref.html"><a href="api-ref.html#return-value-13"><i class="fa fa-check"></i><b>6.14.3</b> Return Value</a></li>
<li class="chapter" data-level="6.14.4" data-path="api-ref.html"><a href="api-ref.html#remarks-13"><i class="fa fa-check"></i><b>6.14.4</b> Remarks</a></li>
<li class="chapter" data-level="6.14.5" data-path="api-ref.html"><a href="api-ref.html#example-13"><i class="fa fa-check"></i><b>6.14.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.15" data-path="api-ref.html"><a href="api-ref.html#api-switch-app"><i class="fa fa-check"></i><b>6.15</b> <code>platform_switch_app</code></a><ul>
<li class="chapter" data-level="6.15.1" data-path="api-ref.html"><a href="api-ref.html#prototype-14"><i class="fa fa-check"></i><b>6.15.1</b> Prototype</a></li>
<li class="chapter" data-level="6.15.2" data-path="api-ref.html"><a href="api-ref.html#parameters-14"><i class="fa fa-check"></i><b>6.15.2</b> Parameters</a></li>
<li class="chapter" data-level="6.15.3" data-path="api-ref.html"><a href="api-ref.html#return-value-14"><i class="fa fa-check"></i><b>6.15.3</b> Return Value</a></li>
<li class="chapter" data-level="6.15.4" data-path="api-ref.html"><a href="api-ref.html#remarks-14"><i class="fa fa-check"></i><b>6.15.4</b> Remarks</a></li>
<li class="chapter" data-level="6.15.5" data-path="api-ref.html"><a href="api-ref.html#example-14"><i class="fa fa-check"></i><b>6.15.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.16" data-path="api-ref.html"><a href="api-ref.html#platform_write_persistent_reg"><i class="fa fa-check"></i><b>6.16</b> <code>platform_write_persistent_reg</code></a><ul>
<li class="chapter" data-level="6.16.1" data-path="api-ref.html"><a href="api-ref.html#prototype-15"><i class="fa fa-check"></i><b>6.16.1</b> Prototype</a></li>
<li class="chapter" data-level="6.16.2" data-path="api-ref.html"><a href="api-ref.html#parameters-15"><i class="fa fa-check"></i><b>6.16.2</b> Parameters</a></li>
<li class="chapter" data-level="6.16.3" data-path="api-ref.html"><a href="api-ref.html#return-value-15"><i class="fa fa-check"></i><b>6.16.3</b> Return Value</a></li>
<li class="chapter" data-level="6.16.4" data-path="api-ref.html"><a href="api-ref.html#remarks-15"><i class="fa fa-check"></i><b>6.16.4</b> Remarks</a></li>
<li class="chapter" data-level="6.16.5" data-path="api-ref.html"><a href="api-ref.html#example-15"><i class="fa fa-check"></i><b>6.16.5</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.17" data-path="api-ref.html"><a href="api-ref.html#syssetpublicdeviceaddr"><i class="fa fa-check"></i><b>6.17</b> <code>sysSetPublicDeviceAddr</code></a><ul>
<li class="chapter" data-level="6.17.1" data-path="api-ref.html"><a href="api-ref.html#prototype-16"><i class="fa fa-check"></i><b>6.17.1</b> Prototype</a></li>
<li class="chapter" data-level="6.17.2" data-path="api-ref.html"><a href="api-ref.html#parameters-16"><i class="fa fa-check"></i><b>6.17.2</b> Parameters</a></li>
<li class="chapter" data-level="6.17.3" data-path="api-ref.html"><a href="api-ref.html#return-value-16"><i class="fa fa-check"></i><b>6.17.3</b> Return Value</a></li>
<li class="chapter" data-level="6.17.4" data-path="api-ref.html"><a href="api-ref.html#remarks-16"><i class="fa fa-check"></i><b>6.17.4</b> Remarks</a></li>
<li class="chapter" data-level="6.17.5" data-path="api-ref.html"><a href="api-ref.html#example-16"><i class="fa fa-check"></i><b>6.17.5</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="revision-history.html"><a href="revision-history.html"><i class="fa fa-check"></i><b>7</b> Revision History</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">INGCHIPS SDK User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dive-into-sdk" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Dive Into SDK</h1>
<p>This chapter discusses some important topics that are critical to use SDK efficiently.</p>
<div id="memory-management" class="section level2">
<h2><span class="header-section-number">5.1</span> Memory Management</h2>
<p>There are mainly three type of memory management methods:</p>
<ol style="list-style-type: decimal">
<li>Statically allocated global variables</li>
<li>Dynamically allocated and freed on stack</li>
<li>Manually allocated and freed on heap</li>
</ol>
<div class="rmdnote">
<p>
RAM is shared between platform and user applications. When a new project is created by <code>ingWizard</code>, RAM settings is configured properly. Developers are not suggested to modify these settings.
</p>
</div>
<div id="global-variables" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Global Variables</h3>
<p>This is the <em>recommended</em> way to define variables that have a full lift span in the app. They are allocated
in the fixed location and their content can be checked easily in debugger.</p>
</div>
<div id="using-stack" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Using Stack</h3>
<p>For variables that are only used within a limited scope, such as a function, we can allocated them on
stack.</p>
<p>Cares must be taken that size of stack is limited, and it might overflow if too much memory is allocated.</p>
<ol style="list-style-type: decimal">
<li><p>The <code>app_main</code> function &amp; interrupts serving routines shares the same global stack with
platform’s <code>main</code> function, whose size is defined as <code>256</code> bytes.</p></li>
<li><p>Callback functions registered into Bluetooth stack shares the same task stack with the stack task,
whose size is defined as <code>1024</code> bytes, and about half is left to be used by app.</p></li>
<li><p>Developers can create new tasks by calling <code>FreeRTOS</code> APIs. In these cases, stack size should be carefully examined.</p></li>
</ol>
<div class="rmdtip">
<p>
Use tools to check required stack maximum depth of functions.
</p>
</div>
</div>
<div id="using-heap" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Using Heap</h3>
<p>Generally, heap is not a recommended way for memory management in embedded applications. There are several
cons included but not limited to:</p>
<ul>
<li><p>Space Overhead</p>
<p>Some bytes are <em>wasted</em> to store extra information and extra program.</p></li>
<li><p>Time Overhead</p>
<p>It costs cycles to allocate and free memory blocks.</p></li>
<li><p>Fragmentation</p></li>
</ul>
<p>Based on these considerations, the heap used by <code>malloc</code> &amp; <code>free</code> has been totally disabled by setting
its size to <code>0</code>. If such heap is <em>TRULY</em> required, it can be re-enabled by changing its size to a
proper value when creating projects.
Be sure to check follow alternatives before using <code>malloc</code> &amp; <code>free</code>:</p>
<ul>
<li><p>Use global variables</p></li>
<li><p>Use memory pool<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a></p>
<p>This is probably the choice for most cases.</p></li>
<li><p>Use <code>FreeRTOS</code>’s heap and memory functions, <code>pvPortMalloc</code> &amp; <code>pvPortFree</code></p>
<p>Note that this heap is used by platform &amp; <code>FreeRTOS</code> itself, and it may not have too much
free space left for apps. The standard <code>malloc</code> &amp; <code>free</code> can be configured to be overridden
and backed by <code>pvPortMalloc</code> &amp; <code>pvPortFree</code> when setting up heap in <code>ingWizard</code>.
Once overridden, the allocator from libc is omitted, and <code>malloc</code> &amp; <code>free</code> are implemented by
<code>pvPortMalloc</code> &amp; <code>pvPortFree</code> respectively.</p></li>
</ul>
</div>
</div>
<div id="multitasking" class="section level2">
<h2><span class="header-section-number">5.2</span> Multitasking</h2>
<p>It is recommend to have a check on <em>Mastering the FreeRTOS™ Real Time Kernel</em>.
Some tips:</p>
<ol style="list-style-type: decimal">
<li><p>Do not do too much processing in interrupt handlers, but defer it to tasks as soon as possible</p></li>
<li><p>Callback functions registered into Bluetooth stack are executed in the context of the stack task,
so do not do too much processing in these functions either</p></li>
<li><p>Use message passing function <code>btstack_push_user_msg</code> to get synchronized with Bluetooth stack
(see <a href="tutorial.html#inter-task-comm">Inter-task Communication</a>)</p></li>
</ol>
</div>
<div id="interrupt-management" class="section level2">
<h2><span class="header-section-number">5.3</span> Interrupt Management</h2>
<p>To create traditional ISR for interrupts, apps only need to register callback functions through a platform
API <a href="api-ref.html#platform_set_irq_callback"><code>platform_set_irq_callback</code></a>.</p>
<p>Apps can use following APIs to modify interrupts configuration and states:</p>
<ul>
<li><p><code>NVIC_SetPriority</code></p>
<p>Note that the highest allowed priority is <code>configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY + 2</code>,
i.e. that priority parameter must be <em>larger</em> than or <em>equal</em> to
this value, indicating a <em>lower</em> or <em>equal</em> priority.</p></li>
<li><p><code>NVIC_EnableIRQ</code></p></li>
<li><p><code>NVIC_DisableIRQ</code></p></li>
<li><p><code>NVIC_ClearPendingIRQ</code></p></li>
<li><p>etc…</p></li>
</ul>
</div>
<div id="power-management" class="section level2">
<h2><span class="header-section-number">5.4</span> Power Management</h2>
<p>In most case, platform manages the power saving feature of <code>ING918xx</code> SoC automatically and tries the
minimize the power consumption in all circumstances, with only one exception, <em>deep sleep</em>.</p>
<p>In deep sleep, all components, except those required for power saving control and real-time clocks,
are powered down. Some peripherals may be used by apps, and platform does not know how to configure
them. So, apps have to get involved in the waking up process after deep sleep. Platform will also check
with app if deep sleep is allowed, and fall back to less aggressive power saving modes when
deep sleep is not allowed.</p>
<p>To use deep sleep, two callback functions are needed, see <a href="api-ref.html#platform_set_evt_callback"><code>platform_set_evt_callback</code></a>.
To ease development &amp; debug, power saving can be turned on or off by calling <a href="api-ref.html#platform_config"><code>platform_config</code></a>.</p>
<p>Besides the above automatic power management schema, apps can also shutdown the whole system
and reboot after a specified duration. In shutdown state the whole system has the least
power consumption. See <a href="api-ref.html#platform_shutdown"><code>platform_shutdown</code></a>.
In shutdown state, a portion of data can
be kept optionally at the cost of a little more power consumption.
In case of only a little piece of data needs to be kept, for example no more than
<strong>four</strong> bits, SDK
provides a pair of APIs for this,
<a href="api-ref.html#platform_write_persistent_reg"><code>platform_write_persistent_reg</code></a>
and <a href="api-ref.html#platform_read_persistent_reg"><code>platform_read_persistent_reg</code></a>.</p>
</div>
<div id="cmsis-api" class="section level2">
<h2><span class="header-section-number">5.5</span> CMSIS API</h2>
<p>SDK tries to encapsulate CMSIS APIs to ease the development. Be careful when calling these APIs
in apps as it may affect the platform program.</p>
<p>Following operations are strictly forbidden:</p>
<ol style="list-style-type: decimal">
<li>Changing the vector table offset register</li>
<li>Modify configurations of internal interrupts, i.e. those not listed in Table <a href="api-ref.html#tab:ch4-irq-summary">6.1</a>.</li>
</ol>
</div>
<div id="debugging-tracing" class="section level2">
<h2><span class="header-section-number">5.6</span> Debugging &amp; Tracing</h2>
<p>Besides online debugging, SDK provides two methods to assist debugging.</p>
<ol style="list-style-type: decimal">
<li><p><code>printf</code></p>
<p><code>printf</code> is the most convenient way to check program’s behaviour. <code>ingWizard</code> can generate necessary code
to use <code>printf</code>.</p></li>
<li><p>Trace</p>
<p>Internal state &amp; HCI messages can be recorded through this trace machenism. <code>ingWizard</code> can generate
necessary code to use trace, too. There are several types of trace data, which are predefined and
can’t be changed. Which types of trace data are going to be recorded is programmable. Use</p>
<p><a href="core-tools.html#ingtracer">ingTracer</a> to view the recorded trace data.</p></li>
</ol>
<table>
<caption><span id="tab:ch3-printf-trace-compare">Table 5.1: </span> Comparison of printf and Trace</caption>
<thead>
<tr class="header">
<th align="center">Debug Option</th>
<th align="left">Pros</th>
<th align="left">Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">printf</td>
<td align="left">Universal</td>
<td align="left"><em>slow</em></td>
</tr>
<tr class="even">
<td align="center">Trace</td>
<td align="left">Binary data, fast</td>
<td align="left">Data types are predefined</td>
</tr>
</tbody>
</table>
<p>Both <code>printf</code> and trace can be directed to UART ports or SEGGER
RTT<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>. Table
<a href="dive-into-sdk.html#tab:ch3-port-compare">5.2</a> is a comparison of these two transport options.</p>
<table>
<caption><span id="tab:ch3-port-compare">Table 5.2: </span> Comparison of UART and SEGGER RTT</caption>
<thead>
<tr class="header">
<th align="center">Transport Option</th>
<th align="left">Pros</th>
<th align="left">Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">UART</td>
<td align="left">Universal, easy to use</td>
<td align="left">Slower, consume more CPU cycles</td>
</tr>
<tr class="even">
<td align="center">SEGGER RTT</td>
<td align="left">Fast</td>
<td align="left">J-Link is required, hard to capture power up log</td>
</tr>
</tbody>
</table>
<div id="tips-on-segger-rtt" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Tips on SEGGER RTT</h3>
<ul>
<li><p>Use <code>J-LINK RTT Viewer</code> to view <code>printf</code> outputs in real-time.</p></li>
<li><p>Use <code>J-LINK RTT Logger</code> to record trace outputs to files.</p>
<p>This logger will ask for the settings of RTT. Device name is “CORTEX-M3”.
Target interface is “SWD”.
RTT Control Block address is the address of a variable
named <code>_SEGGER_RTT</code>, which can be found in <code>.map</code> file. RTT channel index is <code>0</code>.
Blow is a sample session.</p>
<pre><code>------------------------------------------------------------

Device name. Default: CORTEX-M3 &gt;
Target interface. &gt; SWD
Interface speed [kHz]. Default: 4000 kHz &gt;
RTT Control Block address. Default: auto-detection &gt; 0x2000xxxx 
RTT Channel name or index. Default: channel 1 &gt; 0
Output file. Default: RTT_&lt;ChannelName&gt;_&lt;Time&gt;.log &gt;

------------------------------------------------------------
Connected to:
  J-Link Lite for Ghostyu compiled Jan 8 2018 13:10:00
  S/N: 180100254

Searching for RTT Control Block...OK. 1 up-channels found.
RTT Channel description:
  Index: 0
  Name:  Terminal
  Size:  500 bytes.

Output file: .....log

Getting RTT data from target. Press any key to quit.</code></pre></li>
</ul>
</div>
<div id="memory-dump" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Memory Dump</h3>
<p>We are committed to delivery high quality platform binary. If an assertion had occurred in platform binary,
it is suggested to create a full memory dump and contact for further support. There are two memory regions
(Table <a href="dive-into-sdk.html#tab:ch3-mem-region">5.3</a>).</p>
<table>
<caption><span id="tab:ch3-mem-region">Table 5.3: </span> Memory Regions</caption>
<thead>
<tr class="header">
<th align="center">Region</th>
<th align="left">Start Address</th>
<th align="left">Size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">#1</td>
<td align="left">0x20000000</td>
<td align="left">0x10000 (for 128kB RAM chip series)</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left"></td>
<td align="left">0x08000 (for 64kB RAM chip series)</td>
</tr>
<tr class="odd">
<td align="center">#2</td>
<td align="left">0x400A0000</td>
<td align="left">0x10000 (for 128kB RAM chip series)</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left"></td>
<td align="left">0x08000 (for 64kB RAM chip series)</td>
</tr>
</tbody>
</table>
<p>How to create memory dump:</p>
<ul>
<li><p>Keil μVision</p>
<p>In debug session, open the Command Window, use <code>save</code> to save each memory region. For example:</p>
<pre><code>save sysm.hex  0x20000000,0x20010000
save share.hex 0x400A0000,0x400B0000</code></pre>
<p>Note: the second address is the address of last byte <strong>plus 1</strong> of the dump range, and should be aligned
with the chip series that is used in the project.</p></li>
<li><p>IAR Embedded Workbench</p>
<p>In debug session, open a Memory window, and select “Memory Save …” from popup menu.</p></li>
<li><p>Rowley Crossworks for ARM &amp; SEGGER Embedded Studio for ARM</p>
<p>In debug session, open a Memory window, for each memory region:</p>
<ol style="list-style-type: decimal">
<li>Fill in the start address and size;</li>
<li>Use “Memory Save …” from popup menu.</li>
</ol></li>
<li><p>GDB (GNU Arm Embedded Toolchain and Nim)</p>
<p>In GDB debug session, use <code>dump</code> command to save each memory region.</p></li>
</ul>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="19">
<li id="fn19"><p><a href="https://en.wikipedia.org/wiki/Memory_pool" class="uri">https://en.wikipedia.org/wiki/Memory_pool</a><a href="dive-into-sdk.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p><a href="https://www.segger.com/products/debug-probes/j-link/technology/about-real-time-transfer/" class="uri">https://www.segger.com/products/debug-probes/j-link/technology/about-real-time-transfer/</a><a href="dive-into-sdk.html#fnref20" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="core-tools.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="api-ref.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["user_guide.pdf", "user_guide.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
