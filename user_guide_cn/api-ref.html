<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Platform API 参考 | INGCHIPS SDK 开发者用户手册</title>
  <meta name="description" content="本文是 INGCHIPS SDK 的开发者用户手册。" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Platform API 参考 | INGCHIPS SDK 开发者用户手册" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/./img/sdk_overview.png" />
  <meta property="og:description" content="本文是 INGCHIPS SDK 的开发者用户手册。" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Platform API 参考 | INGCHIPS SDK 开发者用户手册" />
  
  <meta name="twitter:description" content="本文是 INGCHIPS SDK 的开发者用户手册。" />
  <meta name="twitter:image" content="/./img/sdk_overview.png" />

<meta name="author" content="Ingchips Technology Co., Ltd." />


<meta name="date" content="2025-11-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dive-into-sdk.html"/>
<link rel="next" href="revision-history.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">User Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 欢迎</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> 简介</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#范围"><i class="fa fa-check"></i><b>2.1</b> 范围</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#架构"><i class="fa fa-check"></i><b>2.2</b> 架构</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#rtos-软件包"><i class="fa fa-check"></i><b>2.2.1</b> RTOS 软件包</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#noos-软件包"><i class="fa fa-check"></i><b>2.2.2</b> “NoOS” 软件包</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#缩略语和术语"><i class="fa fa-check"></i><b>2.3</b> 缩略语和术语</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#参考资料"><i class="fa fa-check"></i><b>2.4</b> 参考资料</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tutorial.html"><a href="tutorial.html"><i class="fa fa-check"></i><b>3</b> 教程</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tutorial.html"><a href="tutorial.html#ch1-hello-world"><i class="fa fa-check"></i><b>3.1</b> 世界你好</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="tutorial.html"><a href="tutorial.html#development-tool-页面"><i class="fa fa-check"></i><b>3.1.1</b> <code>Development Tool</code> 页面</a></li>
<li class="chapter" data-level="3.1.2" data-path="tutorial.html"><a href="tutorial.html#choose-chip-series-页面"><i class="fa fa-check"></i><b>3.1.2</b> <code>Choose Chip Series</code> 页面</a></li>
<li class="chapter" data-level="3.1.3" data-path="tutorial.html"><a href="tutorial.html#choose-project-type-页面"><i class="fa fa-check"></i><b>3.1.3</b> <code>Choose Project Type</code> 页面</a></li>
<li class="chapter" data-level="3.1.4" data-path="tutorial.html"><a href="tutorial.html#role-of-your-device-页面"><i class="fa fa-check"></i><b>3.1.4</b> <code>Role of Your Device</code> 页面</a></li>
<li class="chapter" data-level="3.1.5" data-path="tutorial.html"><a href="tutorial.html#peripheral-setup-页面"><i class="fa fa-check"></i><b>3.1.5</b> <code>Peripheral Setup</code> 页面</a></li>
<li class="chapter" data-level="3.1.6" data-path="tutorial.html"><a href="tutorial.html#security-privacy-页面"><i class="fa fa-check"></i><b>3.1.6</b> <code>Security &amp; Privacy</code> 页面</a></li>
<li class="chapter" data-level="3.1.7" data-path="tutorial.html"><a href="tutorial.html#firmare-over-the-air-页面"><i class="fa fa-check"></i><b>3.1.7</b> <code>Firmare Over-The-Air</code> 页面</a></li>
<li class="chapter" data-level="3.1.8" data-path="tutorial.html"><a href="tutorial.html#common-functions-页面"><i class="fa fa-check"></i><b>3.1.8</b> <code>Common Functions</code> 页面</a></li>
<li class="chapter" data-level="3.1.9" data-path="tutorial.html"><a href="tutorial.html#编译您的项目"><i class="fa fa-check"></i><b>3.1.9</b> 编译您的项目</a></li>
<li class="chapter" data-level="3.1.10" data-path="tutorial.html"><a href="tutorial.html#下载"><i class="fa fa-check"></i><b>3.1.10</b> 下载</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tutorial.html"><a href="tutorial.html#ibeacon"><i class="fa fa-check"></i><b>3.2</b> iBeacon</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="tutorial.html"><a href="tutorial.html#建立广播数据"><i class="fa fa-check"></i><b>3.2.1</b> 建立广播数据</a></li>
<li class="chapter" data-level="3.2.2" data-path="tutorial.html"><a href="tutorial.html#尝试应用"><i class="fa fa-check"></i><b>3.2.2</b> 尝试应用</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tutorial.html"><a href="tutorial.html#温度计"><i class="fa fa-check"></i><b>3.3</b> 温度计</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="tutorial.html"><a href="tutorial.html#建立广播数据-1"><i class="fa fa-check"></i><b>3.3.1</b> 建立广播数据</a></li>
<li class="chapter" data-level="3.3.2" data-path="tutorial.html"><a href="tutorial.html#建立gatt配置文件"><i class="fa fa-check"></i><b>3.3.2</b> 建立GATT配置文件</a></li>
<li class="chapter" data-level="3.3.3" data-path="tutorial.html"><a href="tutorial.html#代码编写"><i class="fa fa-check"></i><b>3.3.3</b> 代码编写</a></li>
<li class="chapter" data-level="3.3.4" data-path="tutorial.html"><a href="tutorial.html#通知"><i class="fa fa-check"></i><b>3.3.4</b> 通知</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tutorial.html"><a href="tutorial.html#fota温度计"><i class="fa fa-check"></i><b>3.4</b> FOTA温度计</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="tutorial.html"><a href="tutorial.html#fota设备"><i class="fa fa-check"></i><b>3.4.1</b> FOTA设备</a></li>
<li class="chapter" data-level="3.4.2" data-path="tutorial.html"><a href="tutorial.html#创建一个新版本"><i class="fa fa-check"></i><b>3.4.2</b> 创建一个新版本</a></li>
<li class="chapter" data-level="3.4.3" data-path="tutorial.html"><a href="tutorial.html#fota服务器"><i class="fa fa-check"></i><b>3.4.3</b> FOTA服务器</a></li>
<li class="chapter" data-level="3.4.4" data-path="tutorial.html"><a href="tutorial.html#尝试应用-1"><i class="fa fa-check"></i><b>3.4.4</b> 尝试应用</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="tutorial.html"><a href="tutorial.html#ibeacon扫描设备"><i class="fa fa-check"></i><b>3.5</b> iBeacon扫描设备</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="tutorial.html"><a href="tutorial.html#估算距离"><i class="fa fa-check"></i><b>3.5.1</b> 估算距离</a></li>
<li class="chapter" data-level="3.5.2" data-path="tutorial.html"><a href="tutorial.html#并发广播扫描"><i class="fa fa-check"></i><b>3.5.2</b> 并发广播&amp;扫描</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="tutorial.html"><a href="tutorial.html#通知指示"><i class="fa fa-check"></i><b>3.6</b> 通知&amp;指示</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="tutorial.html"><a href="tutorial.html#inter-task-comm"><i class="fa fa-check"></i><b>3.6.1</b> 任务间通信</a></li>
<li class="chapter" data-level="3.6.2" data-path="tutorial.html"><a href="tutorial.html#定时器"><i class="fa fa-check"></i><b>3.6.2</b> 定时器</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="tutorial.html"><a href="tutorial.html#吞吐量"><i class="fa fa-check"></i><b>3.7</b> 吞吐量</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="tutorial.html"><a href="tutorial.html#理论峰值吞吐量"><i class="fa fa-check"></i><b>3.7.1</b> 理论峰值吞吐量</a></li>
<li class="chapter" data-level="3.7.2" data-path="tutorial.html"><a href="tutorial.html#测试吞吐量"><i class="fa fa-check"></i><b>3.7.2</b> 测试吞吐量</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="tutorial.html"><a href="tutorial.html#双角色-ble网关"><i class="fa fa-check"></i><b>3.8</b> 双角色 &amp; BLE网关</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="tutorial.html"><a href="tutorial.html#用-wizard-创建一个外设app"><i class="fa fa-check"></i><b>3.8.1</b> 用 <code>Wizard</code> 创建一个外设APP</a></li>
<li class="chapter" data-level="3.8.2" data-path="tutorial.html"><a href="tutorial.html#定义温度计数据"><i class="fa fa-check"></i><b>3.8.2</b> 定义温度计数据</a></li>
<li class="chapter" data-level="3.8.3" data-path="tutorial.html"><a href="tutorial.html#扫描温度计"><i class="fa fa-check"></i><b>3.8.3</b> 扫描温度计</a></li>
<li class="chapter" data-level="3.8.4" data-path="tutorial.html"><a href="tutorial.html#发现服务"><i class="fa fa-check"></i><b>3.8.4</b> 发现服务</a></li>
<li class="chapter" data-level="3.8.5" data-path="tutorial.html"><a href="tutorial.html#数据处理"><i class="fa fa-check"></i><b>3.8.5</b> 数据处理</a></li>
<li class="chapter" data-level="3.8.6" data-path="tutorial.html"><a href="tutorial.html#鲁棒性"><i class="fa fa-check"></i><b>3.8.6</b> 鲁棒性</a></li>
<li class="chapter" data-level="3.8.7" data-path="tutorial.html"><a href="tutorial.html#准备温度计"><i class="fa fa-check"></i><b>3.8.7</b> 准备温度计</a></li>
<li class="chapter" data-level="3.8.8" data-path="tutorial.html"><a href="tutorial.html#测试"><i class="fa fa-check"></i><b>3.8.8</b> 测试</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="tutorial.html"><a href="tutorial.html#从示例开始"><i class="fa fa-check"></i><b>3.9</b> 从示例开始</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="core-tools.html"><a href="core-tools.html"><i class="fa fa-check"></i><b>4</b> 核心工具</a>
<ul>
<li class="chapter" data-level="4.1" data-path="core-tools.html"><a href="core-tools.html#向导"><i class="fa fa-check"></i><b>4.1</b> 向导</a></li>
<li class="chapter" data-level="4.2" data-path="core-tools.html"><a href="core-tools.html#ch2-downloader"><i class="fa fa-check"></i><b>4.2</b> 下载器</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="core-tools.html"><a href="core-tools.html#介绍"><i class="fa fa-check"></i><b>4.2.1</b> 介绍</a></li>
<li class="chapter" data-level="4.2.2" data-path="core-tools.html"><a href="core-tools.html#script-mass-prod"><i class="fa fa-check"></i><b>4.2.2</b> 脚本与量产</a></li>
<li class="chapter" data-level="4.2.3" data-path="core-tools.html"><a href="core-tools.html#flash-读保护适用于-ing918xx"><i class="fa fa-check"></i><b>4.2.3</b> Flash 读保护（适用于 ING918xx）</a></li>
<li class="chapter" data-level="4.2.4" data-path="core-tools.html"><a href="core-tools.html#python-版本"><i class="fa fa-check"></i><b>4.2.4</b> Python 版本</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="core-tools.html"><a href="core-tools.html#ingtracer"><i class="fa fa-check"></i><b>4.3</b> Trace 工具</a></li>
<li class="chapter" data-level="4.4" data-path="core-tools.html"><a href="core-tools.html#ch2-axf-tool"><i class="fa fa-check"></i><b>4.4</b> Axf Tool</a></li>
<li class="chapter" data-level="4.5" data-path="core-tools.html"><a href="core-tools.html#ai-捷径"><i class="fa fa-check"></i><b>4.5</b> AI 捷径</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="core-tools.html"><a href="core-tools.html#安装"><i class="fa fa-check"></i><b>4.5.1</b> 安装</a></li>
<li class="chapter" data-level="4.5.2" data-path="core-tools.html"><a href="core-tools.html#使用方法"><i class="fa fa-check"></i><b>4.5.2</b> 使用方法</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html"><i class="fa fa-check"></i><b>5</b> 深入 SDK</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#内存管理"><i class="fa fa-check"></i><b>5.1</b> 内存管理</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#全局分配"><i class="fa fa-check"></i><b>5.1.1</b> 全局分配</a></li>
<li class="chapter" data-level="5.1.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#使用栈"><i class="fa fa-check"></i><b>5.1.2</b> 使用栈</a></li>
<li class="chapter" data-level="5.1.3" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#使用堆"><i class="fa fa-check"></i><b>5.1.3</b> 使用堆</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#多任务"><i class="fa fa-check"></i><b>5.2</b> 多任务</a></li>
<li class="chapter" data-level="5.3" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#中断管理"><i class="fa fa-check"></i><b>5.3</b> 中断管理</a></li>
<li class="chapter" data-level="5.4" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#功耗管理"><i class="fa fa-check"></i><b>5.4</b> 功耗管理</a></li>
<li class="chapter" data-level="5.5" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#cmsis-api"><i class="fa fa-check"></i><b>5.5</b> CMSIS API</a></li>
<li class="chapter" data-level="5.6" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#debugging-tracing"><i class="fa fa-check"></i><b>5.6</b> 调试与跟踪</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#有关-segger-rtt-的使用提示"><i class="fa fa-check"></i><b>5.6.1</b> 有关 SEGGER RTT 的使用提示</a></li>
<li class="chapter" data-level="5.6.2" data-path="dive-into-sdk.html"><a href="dive-into-sdk.html#内存转储"><i class="fa fa-check"></i><b>5.6.2</b> 内存转储</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="api-ref.html"><a href="api-ref.html"><i class="fa fa-check"></i><b>6</b> Platform API 参考</a>
<ul>
<li class="chapter" data-level="6.1" data-path="api-ref.html"><a href="api-ref.html#配置与信息"><i class="fa fa-check"></i><b>6.1</b> 配置与信息</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="api-ref.html"><a href="api-ref.html#platform_config"><i class="fa fa-check"></i><b>6.1.1</b> <code>platform_config</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="api-ref.html"><a href="api-ref.html#platform_get_version"><i class="fa fa-check"></i><b>6.1.2</b> <code>platform_get_version</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="api-ref.html"><a href="api-ref.html#platform_read_info"><i class="fa fa-check"></i><b>6.1.3</b> <code>platform_read_info</code></a></li>
<li class="chapter" data-level="6.1.4" data-path="api-ref.html"><a href="api-ref.html#api-switch-app"><i class="fa fa-check"></i><b>6.1.4</b> <code>platform_switch_app</code></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="api-ref.html"><a href="api-ref.html#事件与中断"><i class="fa fa-check"></i><b>6.2</b> 事件与中断</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="api-ref.html"><a href="api-ref.html#platform_set_evt_callback_table"><i class="fa fa-check"></i><b>6.2.1</b> <code>platform_set_evt_callback_table</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="api-ref.html"><a href="api-ref.html#platform_set_irq_callback_table"><i class="fa fa-check"></i><b>6.2.2</b> <code>platform_set_irq_callback_table</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="api-ref.html"><a href="api-ref.html#platform_set_evt_callback"><i class="fa fa-check"></i><b>6.2.3</b> <code>platform_set_evt_callback</code></a></li>
<li class="chapter" data-level="6.2.4" data-path="api-ref.html"><a href="api-ref.html#platform_set_irq_callback"><i class="fa fa-check"></i><b>6.2.4</b> <code>platform_set_irq_callback</code></a></li>
<li class="chapter" data-level="6.2.5" data-path="api-ref.html"><a href="api-ref.html#platform_enable_irq"><i class="fa fa-check"></i><b>6.2.5</b> <code>platform_enable_irq</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="api-ref.html"><a href="api-ref.html#时钟"><i class="fa fa-check"></i><b>6.3</b> 时钟</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="api-ref.html"><a href="api-ref.html#platform_calibrate_rt_clk"><i class="fa fa-check"></i><b>6.3.1</b> <code>platform_calibrate_rt_clk</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="api-ref.html"><a href="api-ref.html#platform_rt_rc_auto_tune"><i class="fa fa-check"></i><b>6.3.2</b> <code>platform_rt_rc_auto_tune</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="api-ref.html"><a href="api-ref.html#platform_rt_rc_auto_tune2"><i class="fa fa-check"></i><b>6.3.3</b> <code>platform_rt_rc_auto_tune2</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="api-ref.html"><a href="api-ref.html#platform_rt_rc_tune"><i class="fa fa-check"></i><b>6.3.4</b> <code>platform_rt_rc_tune</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="api-ref.html"><a href="api-ref.html#rf"><i class="fa fa-check"></i><b>6.4</b> RF</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="api-ref.html"><a href="api-ref.html#platform_set_rf_clk_source"><i class="fa fa-check"></i><b>6.4.1</b> <code>platform_set_rf_clk_source</code></a></li>
<li class="chapter" data-level="6.4.2" data-path="api-ref.html"><a href="api-ref.html#platform_set_rf_init_data"><i class="fa fa-check"></i><b>6.4.2</b> <code>platform_set_rf_init_data</code></a></li>
<li class="chapter" data-level="6.4.3" data-path="api-ref.html"><a href="api-ref.html#platform_set_rf_power_mapping"><i class="fa fa-check"></i><b>6.4.3</b> <code>platform_set_rf_power_mapping</code></a></li>
<li class="chapter" data-level="6.4.4" data-path="api-ref.html"><a href="api-ref.html#platform_patch_rf_init_data"><i class="fa fa-check"></i><b>6.4.4</b> <code>platform_patch_rf_init_data</code></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="api-ref.html"><a href="api-ref.html#内存与实时操作系统rtos"><i class="fa fa-check"></i><b>6.5</b> 内存与实时操作系统（RTOS）</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="api-ref.html"><a href="api-ref.html#platform_call_on_stack"><i class="fa fa-check"></i><b>6.5.1</b> <code>platform_call_on_stack</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="api-ref.html"><a href="api-ref.html#platform_get_current_task"><i class="fa fa-check"></i><b>6.5.2</b> <code>platform_get_current_task</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="api-ref.html"><a href="api-ref.html#platform_get_gen_os_driver"><i class="fa fa-check"></i><b>6.5.3</b> <code>platform_get_gen_os_driver</code></a></li>
<li class="chapter" data-level="6.5.4" data-path="api-ref.html"><a href="api-ref.html#platform_get_heap_status"><i class="fa fa-check"></i><b>6.5.4</b> <code>platform_get_heap_status</code></a></li>
<li class="chapter" data-level="6.5.5" data-path="api-ref.html"><a href="api-ref.html#platform_get_rtos_heap_mem"><i class="fa fa-check"></i><b>6.5.5</b> <code>platform_get_rtos_heap_mem</code></a></li>
<li class="chapter" data-level="6.5.6" data-path="api-ref.html"><a href="api-ref.html#platform_get_task_handle"><i class="fa fa-check"></i><b>6.5.6</b> <code>platform_get_task_handle</code></a></li>
<li class="chapter" data-level="6.5.7" data-path="api-ref.html"><a href="api-ref.html#platform_install_task_stack"><i class="fa fa-check"></i><b>6.5.7</b> <code>platform_install_task_stack</code></a></li>
<li class="chapter" data-level="6.5.8" data-path="api-ref.html"><a href="api-ref.html#platform_install_isr_stack"><i class="fa fa-check"></i><b>6.5.8</b> <code>platform_install_isr_stack</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="api-ref.html"><a href="api-ref.html#时间与定时器"><i class="fa fa-check"></i><b>6.6</b> 时间与定时器</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="api-ref.html"><a href="api-ref.html#platform_cancel_us_timer"><i class="fa fa-check"></i><b>6.6.1</b> <code>platform_cancel_us_timer</code></a></li>
<li class="chapter" data-level="6.6.2" data-path="api-ref.html"><a href="api-ref.html#platform_create_us_timer"><i class="fa fa-check"></i><b>6.6.2</b> <code>platform_create_us_timer</code></a></li>
<li class="chapter" data-level="6.6.3" data-path="api-ref.html"><a href="api-ref.html#platform_create_us_timer2"><i class="fa fa-check"></i><b>6.6.3</b> <code>platform_create_us_timer2</code></a></li>
<li class="chapter" data-level="6.6.4" data-path="api-ref.html"><a href="api-ref.html#platform_delete_timer"><i class="fa fa-check"></i><b>6.6.4</b> <code>platform_delete_timer</code></a></li>
<li class="chapter" data-level="6.6.5" data-path="api-ref.html"><a href="api-ref.html#platform_get_timer_counter"><i class="fa fa-check"></i><b>6.6.5</b> <code>platform_get_timer_counter</code></a></li>
<li class="chapter" data-level="6.6.6" data-path="api-ref.html"><a href="api-ref.html#platform_set_abs_timer"><i class="fa fa-check"></i><b>6.6.6</b> <code>platform_set_abs_timer</code></a></li>
<li class="chapter" data-level="6.6.7" data-path="api-ref.html"><a href="api-ref.html#platform_set_timer"><i class="fa fa-check"></i><b>6.6.7</b> <code>platform_set_timer</code></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="api-ref.html"><a href="api-ref.html#节能"><i class="fa fa-check"></i><b>6.7</b> 节能</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="api-ref.html"><a href="api-ref.html#platform_pre_suppress_cycles_and_sleep_processing"><i class="fa fa-check"></i><b>6.7.1</b> <code>platform_pre_suppress_cycles_and_sleep_processing</code></a></li>
<li class="chapter" data-level="6.7.2" data-path="api-ref.html"><a href="api-ref.html#platform_pre_sleep_processing"><i class="fa fa-check"></i><b>6.7.2</b> <code>platform_pre_sleep_processing</code></a></li>
<li class="chapter" data-level="6.7.3" data-path="api-ref.html"><a href="api-ref.html#platform_post_sleep_processing"><i class="fa fa-check"></i><b>6.7.3</b> <code>platform_post_sleep_processing</code></a></li>
<li class="chapter" data-level="6.7.4" data-path="api-ref.html"><a href="api-ref.html#platform_os_idle_resumed_hook"><i class="fa fa-check"></i><b>6.7.4</b> <code>platform_os_idle_resumed_hook</code></a></li>
<li class="chapter" data-level="6.7.5" data-path="api-ref.html"><a href="api-ref.html#platform_os_idle_resumed_hook-1"><i class="fa fa-check"></i><b>6.7.5</b> <code>platform_os_idle_resumed_hook</code></a></li>
<li class="chapter" data-level="6.7.6" data-path="api-ref.html"><a href="api-ref.html#platform_pre_suppress_ticks_and_sleep_processing"><i class="fa fa-check"></i><b>6.7.6</b> <code>platform_pre_suppress_ticks_and_sleep_processing</code></a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="api-ref.html"><a href="api-ref.html#实用工具"><i class="fa fa-check"></i><b>6.8</b> 实用工具</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="api-ref.html"><a href="api-ref.html#platform_hrng"><i class="fa fa-check"></i><b>6.8.1</b> <code>platform_hrng</code></a></li>
<li class="chapter" data-level="6.8.2" data-path="api-ref.html"><a href="api-ref.html#platform_rand"><i class="fa fa-check"></i><b>6.8.2</b> <code>platform_rand</code></a></li>
<li class="chapter" data-level="6.8.3" data-path="api-ref.html"><a href="api-ref.html#platform_read_persistent_reg"><i class="fa fa-check"></i><b>6.8.3</b> <code>platform_read_persistent_reg</code></a></li>
<li class="chapter" data-level="6.8.4" data-path="api-ref.html"><a href="api-ref.html#platform_reset"><i class="fa fa-check"></i><b>6.8.4</b> <code>platform_reset</code></a></li>
<li class="chapter" data-level="6.8.5" data-path="api-ref.html"><a href="api-ref.html#platform_shutdown"><i class="fa fa-check"></i><b>6.8.5</b> <code>platform_shutdown</code></a></li>
<li class="chapter" data-level="6.8.6" data-path="api-ref.html"><a href="api-ref.html#platform_write_persistent_reg"><i class="fa fa-check"></i><b>6.8.6</b> <code>platform_write_persistent_reg</code></a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="api-ref.html"><a href="api-ref.html#调试与追踪"><i class="fa fa-check"></i><b>6.9</b> 调试与追踪</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="api-ref.html"><a href="api-ref.html#platform_printf"><i class="fa fa-check"></i><b>6.9.1</b> <code>platform_printf</code></a></li>
<li class="chapter" data-level="6.9.2" data-path="api-ref.html"><a href="api-ref.html#platform_raise_assertion"><i class="fa fa-check"></i><b>6.9.2</b> <code>platform_raise_assertion</code></a></li>
<li class="chapter" data-level="6.9.3" data-path="api-ref.html"><a href="api-ref.html#platform_trace_raw"><i class="fa fa-check"></i><b>6.9.3</b> <code>platform_trace_raw</code></a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="api-ref.html"><a href="api-ref.html#其他"><i class="fa fa-check"></i><b>6.10</b> 其他</a>
<ul>
<li class="chapter" data-level="6.10.1" data-path="api-ref.html"><a href="api-ref.html#platform_get_link_layer_interf"><i class="fa fa-check"></i><b>6.10.1</b> <code>platform_get_link_layer_interf</code></a></li>
<li class="chapter" data-level="6.10.2" data-path="api-ref.html"><a href="api-ref.html#syssetpublicdeviceaddr"><i class="fa fa-check"></i><b>6.10.2</b> <code>sysSetPublicDeviceAddr</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="revision-history.html"><a href="revision-history.html"><i class="fa fa-check"></i><b>7</b> 版本历史</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">INGCHIPS SDK 开发者用户手册</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="api-ref" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Platform API 参考<a href="api-ref.html#api-ref" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章节介绍 platform API。</p>
<div id="配置与信息" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> 配置与信息<a href="api-ref.html#配置与信息" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_config" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> <code>platform_config</code><a href="api-ref.html#platform_config" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>配置一些 platform 功能。</p>
<div id="原型" class="section level4 hasAnchor" number="6.1.1.1">
<h4><span class="header-section-number">6.1.1.1</span> 原型<a href="api-ref.html#原型" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb31-1"><a href="api-ref.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_config<span class="op">(</span><span class="dt">const</span> platform_cfg_item_t item<span class="op">,</span></span>
<span id="cb31-2"><a href="api-ref.html#cb31-2" aria-hidden="true" tabindex="-1"></a>                     <span class="dt">const</span> <span class="dt">uint32_t</span> flag<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数" class="section level4 hasAnchor" number="6.1.1.2">
<h4><span class="header-section-number">6.1.1.2</span> 参数<a href="api-ref.html#参数" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const platform_cfg_item_t item</code></p>
<p>指定要配置的项目。可以是以下值之一：</p>
<ul>
<li><p><code>PLATFORM_CFG_LOG_HCI</code>：打印主机控制器接口消息。默认：禁用。</p>
<p>仅在 ING918 上可用。HCI 日志仅用于对 BLE 行为进行快速检查。请考虑使用跟踪（参见 <a href="dive-into-sdk.html#debugging-tracing">调试与跟踪</a>）。</p></li>
<li><p><code>PLATFORM_CFG_POWER_SAVING</code>：省电模式。默认：禁用。</p></li>
<li><p><code>PLATFORM_CFG_TRACE_MASK</code>：选定的跟踪项的位图。默认：<code>0</code>。</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb32-1"><a href="api-ref.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span></span>
<span id="cb32-2"><a href="api-ref.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb32-3"><a href="api-ref.html#cb32-3" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_EVENT                 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb32-4"><a href="api-ref.html#cb32-4" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_HCI_CMD               <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb32-5"><a href="api-ref.html#cb32-5" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_HCI_EVENT             <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb32-6"><a href="api-ref.html#cb32-6" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_HCI_ACL               <span class="op">=</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb32-7"><a href="api-ref.html#cb32-7" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TRACE_ID_LLCP                  <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb32-8"><a href="api-ref.html#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//..</span></span>
<span id="cb32-9"><a href="api-ref.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_trace_item_t<span class="op">;</span></span></code></pre></div></li>
<li><p><code>PLATFORM_CFG_RT_RC_EN</code>：启用/禁用实时 RC 时钟。默认：启用。</p></li>
<li><p><code>PLATFORM_CFG_RT_OSC_EN</code>：启用/禁用实时晶体振荡器。默认：启用。</p></li>
<li><p><code>PLATFORM_CFG_RT_CLK</code>：实时时钟选择。标志为<code>platform_rt_clk_src_t</code>。默认：<code>PLATFORM_RT_RC</code></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="api-ref.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span></span>
<span id="cb33-2"><a href="api-ref.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb33-3"><a href="api-ref.html#cb33-3" aria-hidden="true" tabindex="-1"></a>    PLATFORM_RT_OSC<span class="op">,</span>           <span class="co">// 外部实时晶体振荡器</span></span>
<span id="cb33-4"><a href="api-ref.html#cb33-4" aria-hidden="true" tabindex="-1"></a>    PLATFORM_RT_RC             <span class="co">// 内部实时 RC 时钟</span></span>
<span id="cb33-5"><a href="api-ref.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_rt_clk_src_t<span class="op">;</span></span></code></pre></div>
<p>对于 ING918，修改此配置时，RT_RC 和 RT_OSC 都应<strong>启用</strong>并<strong>运行</strong>：</p>
<pre><code>  * 对于 RT_OSC，等待直到 RT_OSC 的状态为 OK；
  * 对于 RT_RC，启用后等待 100μs。</code></pre>
<p>并在禁用未使用的时钟之前再等待 100μs。</p></li>
<li><p><code>PLATFORM_CFG_RT_CLK_ACC</code>：配置实时时钟精度（ppm）。</p></li>
<li><p><code>PLATFORM_CFG_RT_CALI_PERIOD</code>：实时时钟自动校准周期（秒）。默认：3600 * 2（2小时）。</p></li>
<li><p><code>PLATFORM_CFG_DEEP_SLEEP_TIME_REDUCTION</code>：睡眠时间缩减（深度睡眠模式）（微秒）。ING918默认：~550μs。</p></li>
<li><p><code>PLATFORM_CFG_SLEEP_TIME_REDUCTION</code>：睡眠时间缩减（其他睡眠模式）（微秒）。ING918默认：~450μs。</p></li>
<li><p><code>PLATFORM_CFG_LL_DBG_FLAGS</code>：链路层标志。<code>ll_cfg_flag_t</code>中的位组合。详见
《低功耗蓝牙开发者手册》<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a>。</p></li>
<li><p><code>PLATFORM_CFG_LL_LEGACY_ADV_INTERVAL</code>：链路层传统广告间隔，高占空比模式（高16位）和正常占空比模式（低16位）（微秒）。高占空比模式默认：1250；正常占空比模式默认：1500。</p></li>
<li><p><code>PLATFORM_CFG_RTOS_ENH_TICK</code>：启用 RTOS 的增强型滴答。默认：禁用。启用后，当外设频繁生成中断请求时，可以保持滴答的准确性。</p></li>
<li><p><code>PLATFORM_CFG_LL_DELAY_COMPENSATION</code>：链路层的延迟补偿。</p>
<p>当系统以较低频率运行时，链路层需要更多时间（以 μs 为单位）来调度RF任务。例如，如果 ING916 以 24MHz 运行，则需要约 2500μs 的补偿。</p></li>
<li><p><code>PLATFORM_CFG_24M_OSC_TUNE</code>：24M OSC 调谐。不适用于ING918。</p>
<p>对于 ING916，调谐值可能在 0x16~0x2d 之间。</p></li>
<li><p><code>PLATFORM_CFG_ALWAYS_CALL_WAKEUP</code>：无论深度睡眠过程是否完成或中止（失败），始终触发 <code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code> 事件。ING918默认：禁用以保持向后兼容性。ING916默认：启用。</p></li>
<li><p><code>PLATFORM_CFG_FAST_DEEP_SLEEP_TIME_REDUCTION</code>：快速深度睡眠模式的睡眠时间减少（微秒）。不适用于ING918。</p>
<p>此配置必须小于或等于 <code>PLATFORM_CFG_DEEP_SLEEP_TIME_REDUCTION</code>。当等于 <code>PLATFORM_CFG_DEEP_SLEEP_TIME_REDUCTION</code> 时，不使用快速深度睡眠模式。</p>
<p>ING916 默认：~2000μs。</p></li>
<li><p><code>PLATFORM_CFG_AUTO_REDUCE_CLOCK_FREQ</code>：在这些情况下自动降低 CPU 时钟频率：</p>
<ul>
<li>默认的 IDLE 过程，</li>
<li>进入睡眠模式时。</li>
</ul>
<p>不适用于 ING918。ING916 默认：启用。</p></li>
</ul></li>
<li><p><code>const uint32_t flag</code></p>
<p>用于禁用或启用项目。可以是以下值之一：</p>
<ul>
<li><code>PLATFORM_CFG_ENABLE</code></li>
<li><code>PLATFORM_CFG_DISABLE</code></li>
</ul></li>
</ul>
</div>
<div id="返回值" class="section level4 hasAnchor" number="6.1.1.3">
<h4><span class="header-section-number">6.1.1.3</span> 返回值<a href="api-ref.html#返回值" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注" class="section level4 hasAnchor" number="6.1.1.4">
<h4><span class="header-section-number">6.1.1.4</span> 备注<a href="api-ref.html#备注" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="示例" class="section level4 hasAnchor" number="6.1.1.5">
<h4><span class="header-section-number">6.1.1.5</span> 示例<a href="api-ref.html#示例" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb35-1"><a href="api-ref.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 在 ING918 上启用HCI日志记录</span></span>
<span id="cb35-2"><a href="api-ref.html#cb35-2" aria-hidden="true" tabindex="-1"></a>platform_config<span class="op">(</span>PLATFORM_CFG_LOG_HCI<span class="op">,</span> PLATFORM_CFG_ENABLE<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_get_version" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> <code>platform_get_version</code><a href="api-ref.html#platform_get_version" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>获取 platform 的版本号。</p>
<div id="函数原型" class="section level4 hasAnchor" number="6.1.2.1">
<h4><span class="header-section-number">6.1.2.1</span> 函数原型<a href="api-ref.html#函数原型" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="api-ref.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> platform_ver_t <span class="op">*</span>platform_get_version<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-1" class="section level4 hasAnchor" number="6.1.2.2">
<h4><span class="header-section-number">6.1.2.2</span> 参数<a href="api-ref.html#参数-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-1" class="section level4 hasAnchor" number="6.1.2.3">
<h4><span class="header-section-number">6.1.2.3</span> 返回值<a href="api-ref.html#返回值-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>指向 <code>platform_ver_t</code> 的指针。</p>
</div>
<div id="备注-1" class="section level4 hasAnchor" number="6.1.2.4">
<h4><span class="header-section-number">6.1.2.4</span> 备注<a href="api-ref.html#备注-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>platform 版本号由三部分组成：主版本号、次版本号和修订号：</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="api-ref.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> platform_ver</span>
<span id="cb37-2"><a href="api-ref.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb37-3"><a href="api-ref.html#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> major<span class="op">;</span></span>
<span id="cb37-4"><a href="api-ref.html#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>  minor<span class="op">;</span></span>
<span id="cb37-5"><a href="api-ref.html#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>  patch<span class="op">;</span></span>
<span id="cb37-6"><a href="api-ref.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_ver_t<span class="op">;</span></span></code></pre></div>
</div>
<div id="示例-1" class="section level4 hasAnchor" number="6.1.2.5">
<h4><span class="header-section-number">6.1.2.5</span> 示例<a href="api-ref.html#示例-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb38"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb38-1"><a href="api-ref.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> platform_ver_t <span class="op">*</span>ver <span class="op">=</span> platform_get_version<span class="op">();</span></span>
<span id="cb38-2"><a href="api-ref.html#cb38-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;platform version: %d.%d.%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> ver<span class="op">-&gt;</span>major<span class="op">,</span> ver<span class="op">-&gt;</span>minor<span class="op">,</span> ver<span class="op">-&gt;</span>patch<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_read_info" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> <code>platform_read_info</code><a href="api-ref.html#platform_read_info" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>读取 platform 信息。</p>
<div id="函数原型-1" class="section level4 hasAnchor" number="6.1.3.1">
<h4><span class="header-section-number">6.1.3.1</span> 函数原型<a href="api-ref.html#函数原型-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb39"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb39-1"><a href="api-ref.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_read_info<span class="op">(</span><span class="dt">const</span> platform_info_item_t item<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-2" class="section level4 hasAnchor" number="6.1.3.2">
<h4><span class="header-section-number">6.1.3.2</span> 参数<a href="api-ref.html#参数-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const platform_info_item_t item</code></p>
<p>信息项。</p>
<ul>
<li><code>PLATFORM_INFO_RT_OSC_STATUS</code>: 读取实时晶体振荡器的状态。值为 0：不正常；非 0：正常。</li>
</ul>
<p>对于 ING916：此时钟在被选为实时时钟源<strong>之后</strong>才会开始运行。</p>
<ul>
<li><p><code>PLATFORM_INFO_RT_CLK_CALI_VALUE</code>: 读取当前实时时钟校准结果。</p></li>
<li><p><code>PLATFOFM_INFO_IRQ_NUMBER</code>: 获取 platform IRQ 的底层 IRQ 编号。</p>
<p>例如，获取 UART0 的底层 IRQ 编号：</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb40-1"><a href="api-ref.html#cb40-1" aria-hidden="true" tabindex="-1"></a>platform_read_info<span class="op">(</span></span>
<span id="cb40-2"><a href="api-ref.html#cb40-2" aria-hidden="true" tabindex="-1"></a>    PLATFOFM_INFO_IRQ_NUMBER <span class="op">+</span> PLATFORM_CB_IRQ_UART0<span class="op">)</span></span></code></pre></div></li>
</ul></li>
</ul>
</div>
<div id="返回值-2" class="section level4 hasAnchor" number="6.1.3.3">
<h4><span class="header-section-number">6.1.3.3</span> 返回值<a href="api-ref.html#返回值-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>信息项的值。</p>
</div>
<div id="备注-2" class="section level4 hasAnchor" number="6.1.3.4">
<h4><span class="header-section-number">6.1.3.4</span> 备注<a href="api-ref.html#备注-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="示例-2" class="section level4 hasAnchor" number="6.1.3.5">
<h4><span class="header-section-number">6.1.3.5</span> 示例<a href="api-ref.html#示例-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb41"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb41-1"><a href="api-ref.html#cb41-1" aria-hidden="true" tabindex="-1"></a>platform_read_info<span class="op">(</span>PLATFORM_INFO_RT_OSC_STATUS<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="api-switch-app" class="section level3 hasAnchor" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> <code>platform_switch_app</code><a href="api-ref.html#api-switch-app" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>切换到次级应用程序。</p>
<div id="函数原型-2" class="section level4 hasAnchor" number="6.1.4.1">
<h4><span class="header-section-number">6.1.4.1</span> 函数原型<a href="api-ref.html#函数原型-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb42"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb42-1"><a href="api-ref.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_switch_app<span class="op">(</span><span class="dt">const</span> <span class="dt">uint32_t</span> app_addr<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-3" class="section level4 hasAnchor" number="6.1.4.2">
<h4><span class="header-section-number">6.1.4.2</span> 参数<a href="api-ref.html#参数-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const uint32_t app_addr</code></p>
<p>次级应用程序的入口地址。</p></li>
</ul>
</div>
<div id="返回值-3" class="section level4 hasAnchor" number="6.1.4.3">
<h4><span class="header-section-number">6.1.4.3</span> 返回值<a href="api-ref.html#返回值-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-3" class="section level4 hasAnchor" number="6.1.4.4">
<h4><span class="header-section-number">6.1.4.4</span> 备注<a href="api-ref.html#备注-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>调用此函数后，其后的代码将不会被执行。</p>
</div>
<div id="示例-3" class="section level4 hasAnchor" number="6.1.4.5">
<h4><span class="header-section-number">6.1.4.5</span> 示例<a href="api-ref.html#示例-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb43"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb43-1"><a href="api-ref.html#cb43-1" aria-hidden="true" tabindex="-1"></a>platform_switch_app<span class="op">(</span><span class="bn">0x80000</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="事件与中断" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> 事件与中断<a href="api-ref.html#事件与中断" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_set_evt_callback_table" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> <code>platform_set_evt_callback_table</code><a href="api-ref.html#platform_set_evt_callback_table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>为所有 platform 事件注册一个回调函数表。</p>
<div id="函数原型-3" class="section level4 hasAnchor" number="6.2.1.1">
<h4><span class="header-section-number">6.2.1.1</span> 函数原型<a href="api-ref.html#函数原型-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb44"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb44-1"><a href="api-ref.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_evt_callback_table<span class="op">(</span></span>
<span id="cb44-2"><a href="api-ref.html#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> platform_evt_cb_table_t <span class="op">*</span>table<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-4" class="section level4 hasAnchor" number="6.2.1.2">
<h4><span class="header-section-number">6.2.1.2</span> 参数<a href="api-ref.html#参数-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const platform_evt_cb_table_t *table</code></p>
<p>回调函数表的地址。</p></li>
</ul>
</div>
<div id="返回值-4" class="section level4 hasAnchor" number="6.2.1.3">
<h4><span class="header-section-number">6.2.1.3</span> 返回值<a href="api-ref.html#返回值-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-4" class="section level4 hasAnchor" number="6.2.1.4">
<h4><span class="header-section-number">6.2.1.4</span> 备注<a href="api-ref.html#备注-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>此函数应仅在 <code>app_main</code> 中调用。如果使用了 <code>platform_set_evt_callback</code>，则不应使用此函数。</p>
<p>与 <code>platform_set_evt_callback</code> 相比，使用此函数可以节省 <code>sizeof(platform_evt_cb_table_t)</code> 字节的 RAM 空间。</p>
</div>
<div id="示例-4" class="section level4 hasAnchor" number="6.2.1.5">
<h4><span class="header-section-number">6.2.1.5</span> 示例<a href="api-ref.html#示例-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb45"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb45-1"><a href="api-ref.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">const</span> platform_evt_cb_table_t evt_cb_table <span class="op">=</span></span>
<span id="cb45-2"><a href="api-ref.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb45-3"><a href="api-ref.html#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>callbacks <span class="op">=</span> <span class="op">{</span></span>
<span id="cb45-4"><a href="api-ref.html#cb45-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>PLATFORM_CB_EVT_HARD_FAULT<span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb45-5"><a href="api-ref.html#cb45-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>f <span class="op">=</span> <span class="op">(</span>f_platform_evt_cb<span class="op">)</span>cb_hard_fault<span class="op">,</span></span>
<span id="cb45-6"><a href="api-ref.html#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb45-7"><a href="api-ref.html#cb45-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>PLATFORM_CB_EVT_PROFILE_INIT<span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb45-8"><a href="api-ref.html#cb45-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>f <span class="op">=</span> setup_profile<span class="op">,</span></span>
<span id="cb45-9"><a href="api-ref.html#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb45-10"><a href="api-ref.html#cb45-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...</span></span>
<span id="cb45-11"><a href="api-ref.html#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-12"><a href="api-ref.html#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb45-13"><a href="api-ref.html#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="api-ref.html#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> app_main<span class="op">()</span></span>
<span id="cb45-15"><a href="api-ref.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb45-16"><a href="api-ref.html#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb45-17"><a href="api-ref.html#cb45-17" aria-hidden="true" tabindex="-1"></a>    platform_set_evt_callback_table<span class="op">(&amp;</span>evt_cb_table<span class="op">);</span></span>
<span id="cb45-18"><a href="api-ref.html#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb45-19"><a href="api-ref.html#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_irq_callback_table" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> <code>platform_set_irq_callback_table</code><a href="api-ref.html#platform_set_irq_callback_table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>为所有 platform 中断请求注册一个回调函数表。</p>
<div id="函数原型-4" class="section level4 hasAnchor" number="6.2.2.1">
<h4><span class="header-section-number">6.2.2.1</span> 函数原型<a href="api-ref.html#函数原型-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb46"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb46-1"><a href="api-ref.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_irq_callback_table<span class="op">(</span></span>
<span id="cb46-2"><a href="api-ref.html#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> platform_irq_cb_table_t <span class="op">*</span>table<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-5" class="section level4 hasAnchor" number="6.2.2.2">
<h4><span class="header-section-number">6.2.2.2</span> 参数<a href="api-ref.html#参数-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const platform_irq_cb_table_t *table</code></p>
<p>回调函数表的地址。</p></li>
</ul>
</div>
<div id="返回值-5" class="section level4 hasAnchor" number="6.2.2.3">
<h4><span class="header-section-number">6.2.2.3</span> 返回值<a href="api-ref.html#返回值-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-5" class="section level4 hasAnchor" number="6.2.2.4">
<h4><span class="header-section-number">6.2.2.4</span> 备注<a href="api-ref.html#备注-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>此函数只能在 <code>app_main</code> 中调用。如果使用了 <code>platform_set_irq_callback</code>，则不应使用此函数。</p>
<p>与 <code>platform_set_irq_callback</code> 相比，使用此函数可以节省 <code>sizeof(platform_irq_cb_table_t)</code> 字节的 RAM。</p>
</div>
<div id="示例-5" class="section level4 hasAnchor" number="6.2.2.5">
<h4><span class="header-section-number">6.2.2.5</span> 示例<a href="api-ref.html#示例-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb47"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb47-1"><a href="api-ref.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">const</span> platform_irq_cb_table_t irq_cb_table <span class="op">=</span></span>
<span id="cb47-2"><a href="api-ref.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb47-3"><a href="api-ref.html#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>callbacks <span class="op">=</span> <span class="op">{</span></span>
<span id="cb47-4"><a href="api-ref.html#cb47-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>PLATFORM_CB_IRQ_UART0<span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb47-5"><a href="api-ref.html#cb47-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>f <span class="op">=</span> <span class="op">(</span>f_platform_irq_cb<span class="op">)</span>cb_irq_uart<span class="op">,</span></span>
<span id="cb47-6"><a href="api-ref.html#cb47-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>user_data <span class="op">=</span> APB_UART0</span>
<span id="cb47-7"><a href="api-ref.html#cb47-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb47-8"><a href="api-ref.html#cb47-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...</span></span>
<span id="cb47-9"><a href="api-ref.html#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb47-10"><a href="api-ref.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb47-11"><a href="api-ref.html#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="api-ref.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> app_main<span class="op">()</span></span>
<span id="cb47-13"><a href="api-ref.html#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb47-14"><a href="api-ref.html#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb47-15"><a href="api-ref.html#cb47-15" aria-hidden="true" tabindex="-1"></a>    platform_set_irq_callback_table<span class="op">(&amp;</span>irq_cb_table<span class="op">);</span></span>
<span id="cb47-16"><a href="api-ref.html#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb47-17"><a href="api-ref.html#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_evt_callback" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> <code>platform_set_evt_callback</code><a href="api-ref.html#platform_set_evt_callback" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>注册回调函数以处理 platform 事件。</p>
<div id="函数原型-5" class="section level4 hasAnchor" number="6.2.3.1">
<h4><span class="header-section-number">6.2.3.1</span> 函数原型<a href="api-ref.html#函数原型-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb48"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb48-1"><a href="api-ref.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_evt_callback<span class="op">(</span>platform_evt_callback_type_t type<span class="op">,</span></span>
<span id="cb48-2"><a href="api-ref.html#cb48-2" aria-hidden="true" tabindex="-1"></a>                               f_platform_evt_cb f<span class="op">,</span></span>
<span id="cb48-3"><a href="api-ref.html#cb48-3" aria-hidden="true" tabindex="-1"></a>                               <span class="dt">void</span> <span class="op">*</span>user_data<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-6" class="section level4 hasAnchor" number="6.2.3.2">
<h4><span class="header-section-number">6.2.3.2</span> 参数<a href="api-ref.html#参数-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_evt_callback_type_t type</code></p>
<p>指定要注册回调函数的事件类型。可以是以下值之一：</p>
<ul>
<li><p><code>PLATFORM_CB_EVT_PUTC</code>：输出 ASCII 字符事件</p>
<p>当 platform 想要输出 ASCII 字符用于日志记录时，会触发此事件。传递给回调函数的参数 <code>void *data</code> 是从 <code>char *</code> 类型转换而来。</p>
<p>如果在创建新项目时在 <code>Common Function</code> 中勾选了 <code>Print to UART</code>，<code>Wizard</code> 可以自动生成将 platform 日志重定向到 UART 的代码。</p></li>
<li><p><code>PLATFORM_CB_EVT_PROFILE_INIT</code>：配置文件初始化事件</p>
<p>当主机初始化时，会触发此事件以请求应用程序初始化GATT配置文件。</p>
<p>在创建新项目时，<code>Wizard</code> 可以自动为此事件生成代码。</p></li>
<li><p><code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code>：从深度睡眠唤醒事件</p>
<p>当从深度睡眠唤醒时，会触发此事件。在深度睡眠期间，外设接口（如UART、I2C等）都已关闭。因此，唤醒时可能需要重新初始化这些接口。</p>
<p>如果在创建新项目时在 <code>Common Function</code> 中勾选了 <code>Deep Sleep</code>，<code>Wizard</code> 可以自动为此事件生成代码。</p>
<p>传递给回调函数的参数 <code>void *data</code> 是从 <code>platform_wakeup_call_info_t *</code> 类型转换而来。</p>
<p>此时 RTOS 尚未恢复，某些 RTOS API 不可用；某些 platform API（如<code>platform_get_us_time</code>）也可能不可用。</p></li>
<li><p><code>PLATFORM_CB_EVT_ON_IDLE_TASK_RESUMED</code>：操作系统从节能模式完全恢复。</p>
<p>如果唤醒原因是 <code>PLATFORM_WAKEUP_REASON_NORMAL</code>，则在 <code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code> 之后调用此回调。
对于 NoOS 变体，回调由 <code>platform_os_idle_resumed_hook()</code>调用。
此事件与 <code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code> 不同：</p>
<ul>
<li>所有操作系统功能都已恢复（对于NoOS变体，这取决于 <code>platform_os_idle_resumed_hook()</code> 的正确使用）</li>
<li>所有 platform API都可用</li>
<li>回调在空闲任务中调用。</li>
</ul>
<p>参数 <code>void *data</code> 始终为 <code>NULL</code>。</p></li>
<li><p><code>PLATFORM_CB_EVT_QUERY_DEEP_SLEEP_ALLOWED</code>：查询是否允许深度睡眠事件</p>
<p>当platform准备进入深度睡眠模式时，会触发此事件以查询应用程序当前是否允许深度睡眠。回调函数可以通过返回 <code>0</code> 拒绝深度睡眠，或通过返回非 <code>0</code> 值允许深度睡眠。</p>
<p>如果在创建新项目时在 <code>Common Function</code> 中勾选了 <code>Deep Sleep</code>，<code>Wizard</code> 可以自动为此事件生成代码。</p></li>
<li><p><code>PLATFORM_CB_EVT_HARD_FAULT</code>：硬件故障发生</p>
<p>当硬件故障发生时，会触发此事件。传递给回调函数的参数 <code>void *data</code> 是从 <code>hard_fault_info_t *</code> 类型转换而来。
如果未定义此回调，当硬件故障发生时，CPU将进入死循环。</p></li>
<li><p><code>PLATFORM_CB_EVT_ASSERTION</code>：软件断言失败</p>
<p>当软件断言失败时，会触发此事件。传递给回调函数的参数 <code>void *data</code> 是从 <code>assertion_info_t *</code> 类型转换而来。
如果未定义此回调，当断言发生时，CPU将进入死循环。</p></li>
<li><p><code>PLATFORM_CB_EVT_LLE_INIT</code>：链路层引擎初始化。</p>
<p>当链路层引擎初始化时，会触发此事件。</p></li>
<li><p><code>PLATFORM_CB_EVT_HEAP_OOM</code>：内存不足。</p>
<p>当堆分配失败（堆内存不足）时，会触发此事件。
如果触发此事件且未定义回调，CPU将进入死循环。
参数 <code>void *data</code> 是从整数转换而来。这个整数代表内存不足的堆的编号：</p>
<ul>
<li><code>0</code>: FreeRTOS 的堆；</li>
<li><code>1</code>: 链路层的堆；</li>
<li><code>2</code>: 链路层任务池。</li>
</ul></li>
<li><p><code>PLATFORM_CB_EVT_TRACE</code>：跟踪输出。</p>
<p>当发出跟踪项时，会触发此事件。应用程序可以为此事件定义回调函数以保存或记录跟踪输出。回调的 <code>param</code> 是从 <code>platform_trace_evt_t *</code> 类型转换而来（参见<a href="dive-into-sdk.html#debugging-tracing">调试与跟踪</a>）。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb49-1"><a href="api-ref.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span></span>
<span id="cb49-2"><a href="api-ref.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb49-3"><a href="api-ref.html#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>data1<span class="op">;</span></span>
<span id="cb49-4"><a href="api-ref.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>data2<span class="op">;</span></span>
<span id="cb49-5"><a href="api-ref.html#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint16_t</span> len1<span class="op">;</span></span>
<span id="cb49-6"><a href="api-ref.html#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint16_t</span> len2<span class="op">;</span></span>
<span id="cb49-7"><a href="api-ref.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_evt_trace_t<span class="op">;</span></span></code></pre></div>
<p>跟踪项是 <code>data1</code> 和 <code>data2</code> 的组合。注意：</p>
<ol style="list-style-type: decimal">
<li><p><code>len1</code> 或 <code>len2</code> 可能为0，但不能同时为0；</p></li>
<li><p>如果回调函数发现无法输出大小为 <code>len1</code> + <code>len2</code> 的数据，则应丢弃 <code>data1</code> 和 <code>data2</code> 以避免跟踪项损坏。</p></li>
</ol></li>
<li><p><code>PLATFORM_CB_EVT_EXCEPTION</code>：硬件异常。</p>
<p>参数 <code>void *data</code> 是从 <code>platform_exception_id_t *</code> 类型转换而来。</p></li>
<li><p><code>PLATFORM_CB_EVT_IDLE_PROC</code>：自定义IDLE过程。</p>
<p>参见“Programmer’s Guide - Power Saving”<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a>。</p></li>
<li><p><code>PLATFORM_CB_EVT_HCI_RECV</code>：接管 HCI 并完全隔离内置主机。</p>
<p>当定义时：</p>
<ul>
<li>HCI事件和ACL数据传递给此回调；</li>
<li><code>PLATFORM_CB_EVT_PROFILE_INIT</code>被忽略。</li>
</ul>
<p>参数 <code>void *data</code> 是从 <code>const platform_hci_recv_t *</code> 类型转换而来。另请参见 <a href="api-ref.html#platform_get_link_layer_interf"><code>platform_get_link_layer_interf</code></a>。</p></li>
<li><p><code>PLATFORM_CB_EVT_BEFORE_DEEP_SLEEP</code>: Platform 即将进入深度睡眠</p>
<p>当 platform 决定进入深度睡眠模式时，会触发此事件。应用程序可以借此机会配置外设。回调函数应保持简单并尽快返回。</p>
<p>参数 <code>void *data</code> 是从 <code>platform_sleep_category_b_t</code> 转换而来，代表所要进入的深度睡眠的类型。</p></li>
</ul></li>
<li><p><code>f_platform_evt_cb f</code></p>
<p>注册到事件<code>type</code>的回调函数。<code>f_platform_evt_cb</code>定义为：</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb50-1"><a href="api-ref.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">uint32_t</span> <span class="op">(*</span>f_platform_evt_cb<span class="op">)(</span><span class="dt">void</span> <span class="op">*</span>data<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>user_data<span class="op">);</span></span></code></pre></div>
<p>若非专门说明，Platform 忽略这个回调函数的返回值。</p></li>
<li><p><code>void *user_data</code></p>
<p>此参数原封不动地传递给回调函数的<code>user_data</code>。</p></li>
</ul>
</div>
<div id="返回值-6" class="section level4 hasAnchor" number="6.2.3.3">
<h4><span class="header-section-number">6.2.3.3</span> 返回值<a href="api-ref.html#返回值-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-6" class="section level4 hasAnchor" number="6.2.3.4">
<h4><span class="header-section-number">6.2.3.4</span> 备注<a href="api-ref.html#备注-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>不需要为每个事件注册回调函数。</p>
<p>如果未为 <code>PLATFORM_CB_EVT_PUTC</code> 事件注册回调函数，所有platform日志（包括<code>platform_printf</code>）将被丢弃。</p>
<p>如果未为 <code>PLATFORM_CB_EVT_PROFILE_INIT</code> 事件注册回调函数，BLE设备的配置文件将为空。</p>
<p>如果未为 <code>PLATFORM_CB_EVT_ON_DEEP_SLEEP_WAKEUP</code> 事件注册回调函数，应用程序在从深度睡眠唤醒时将不会收到通知。</p>
<p>如果未为 <code>PLATFORM_CB_EVT_QUERY_DEEP_SLEEP_ALLOWED</code> 事件注册回调函数，深度睡眠将被<em>禁用</em>。</p>
</div>
<div id="示例-6" class="section level4 hasAnchor" number="6.2.3.5">
<h4><span class="header-section-number">6.2.3.5</span> 示例<a href="api-ref.html#示例-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb51"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb51-1"><a href="api-ref.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> cb_putc<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>c<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>dummy<span class="op">)</span></span>
<span id="cb51-2"><a href="api-ref.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb51-3"><a href="api-ref.html#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: 将字符c输出到UART</span></span>
<span id="cb51-4"><a href="api-ref.html#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb51-5"><a href="api-ref.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-6"><a href="api-ref.html#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="api-ref.html#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="op">......</span></span>
<span id="cb51-8"><a href="api-ref.html#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="api-ref.html#cb51-9" aria-hidden="true" tabindex="-1"></a>platform_set_evt_callback<span class="op">(</span>PLATFORM_CB_EVT_PUTC<span class="op">,</span> <span class="op">(</span>f_platform_evt_cb<span class="op">)</span>cb_putc<span class="op">,</span></span>
<span id="cb51-10"><a href="api-ref.html#cb51-10" aria-hidden="true" tabindex="-1"></a>                          NULL<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_irq_callback" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> <code>platform_set_irq_callback</code><a href="api-ref.html#platform_set_irq_callback" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>注册中断请求的回调函数。</p>
<p>开发者无需在应用中定义IRQ处理程序，而是使用回调函数代替。</p>
<div id="函数原型-6" class="section level4 hasAnchor" number="6.2.4.1">
<h4><span class="header-section-number">6.2.4.1</span> 函数原型<a href="api-ref.html#函数原型-6" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb52"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb52-1"><a href="api-ref.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_irq_callback<span class="op">(</span>platform_irq_callback_type_t type<span class="op">,</span></span>
<span id="cb52-2"><a href="api-ref.html#cb52-2" aria-hidden="true" tabindex="-1"></a>                               f_platform_irq_cb f<span class="op">,</span></span>
<span id="cb52-3"><a href="api-ref.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                               <span class="dt">void</span> <span class="op">*</span>user_data<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-7" class="section level4 hasAnchor" number="6.2.4.2">
<h4><span class="header-section-number">6.2.4.2</span> 参数<a href="api-ref.html#参数-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_irq_callback_type_t type</code></p>
<p>指定要注册回调函数的 IRQ 类型。不同芯片系列的值有所不同。以 ING918 为例：</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb53-1"><a href="api-ref.html#cb53-1" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_RTC<span class="op">,</span></span>
<span id="cb53-2"><a href="api-ref.html#cb53-2" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_TIMER0<span class="op">,</span></span>
<span id="cb53-3"><a href="api-ref.html#cb53-3" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_TIMER1<span class="op">,</span></span>
<span id="cb53-4"><a href="api-ref.html#cb53-4" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_TIMER2<span class="op">,</span></span>
<span id="cb53-5"><a href="api-ref.html#cb53-5" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_GPIO<span class="op">,</span></span>
<span id="cb53-6"><a href="api-ref.html#cb53-6" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_SPI0<span class="op">,</span></span>
<span id="cb53-7"><a href="api-ref.html#cb53-7" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_SPI1<span class="op">,</span></span>
<span id="cb53-8"><a href="api-ref.html#cb53-8" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_UART0<span class="op">,</span></span>
<span id="cb53-9"><a href="api-ref.html#cb53-9" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_UART1<span class="op">,</span></span>
<span id="cb53-10"><a href="api-ref.html#cb53-10" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_I2C0<span class="op">,</span></span>
<span id="cb53-11"><a href="api-ref.html#cb53-11" aria-hidden="true" tabindex="-1"></a>PLATFORM_CB_IRQ_I2C1</span></code></pre></div></li>
<li><p><code>f_platform_irq_cb f</code></p>
<p>注册到 IRQ <code>type</code>的回调函数。<code>f_platform_irq_cb</code> 定义为：</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb54-1"><a href="api-ref.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">uint32_t</span> <span class="op">(*</span>f_platform_irq_cb<span class="op">)(</span><span class="dt">void</span> <span class="op">*</span>user_data<span class="op">);</span></span></code></pre></div></li>
<li><p><code>void *user_data</code></p>
<p>该参数将原封不动地传递给回调函数的 <code>user_data</code>。</p></li>
</ul>
</div>
<div id="返回值-7" class="section level4 hasAnchor" number="6.2.4.3">
<h4><span class="header-section-number">6.2.4.3</span> 返回值<a href="api-ref.html#返回值-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-7" class="section level4 hasAnchor" number="6.2.4.4">
<h4><span class="header-section-number">6.2.4.4</span> 备注<a href="api-ref.html#备注-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>当回调函数注册到 IRQ 时，IRQ 会自动启用。另请参见 <a href="api-ref.html#platform_enable_irq"><code>platform_enable_irq</code></a>。</p>
</div>
<div id="示例-7" class="section level4 hasAnchor" number="6.2.4.5">
<h4><span class="header-section-number">6.2.4.5</span> 示例<a href="api-ref.html#示例-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb55"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb55-1"><a href="api-ref.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> cb_irq_uart0<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>dummy<span class="op">)</span></span>
<span id="cb55-2"><a href="api-ref.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb55-3"><a href="api-ref.html#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: 添加UART0 IRQ处理代码</span></span>
<span id="cb55-4"><a href="api-ref.html#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb55-5"><a href="api-ref.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb55-6"><a href="api-ref.html#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="api-ref.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="op">......</span></span>
<span id="cb55-8"><a href="api-ref.html#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="api-ref.html#cb55-9" aria-hidden="true" tabindex="-1"></a>platform_set_irq_callback<span class="op">(</span></span>
<span id="cb55-10"><a href="api-ref.html#cb55-10" aria-hidden="true" tabindex="-1"></a>    PLATFORM_CB_IRQ_UART0<span class="op">,</span></span>
<span id="cb55-11"><a href="api-ref.html#cb55-11" aria-hidden="true" tabindex="-1"></a>    cb_irq_uart0<span class="op">,</span></span>
<span id="cb55-12"><a href="api-ref.html#cb55-12" aria-hidden="true" tabindex="-1"></a>    NULL<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_enable_irq" class="section level3 hasAnchor" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> <code>platform_enable_irq</code><a href="api-ref.html#platform_enable_irq" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>启用或禁用指定的 IRQ（中断请求）。</p>
<div id="函数原型-7" class="section level4 hasAnchor" number="6.2.5.1">
<h4><span class="header-section-number">6.2.5.1</span> 函数原型<a href="api-ref.html#函数原型-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb56"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb56-1"><a href="api-ref.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_enable_irq<span class="op">(</span></span>
<span id="cb56-2"><a href="api-ref.html#cb56-2" aria-hidden="true" tabindex="-1"></a>    platform_irq_callback_type_t type<span class="op">,</span></span>
<span id="cb56-3"><a href="api-ref.html#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> flag<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-8" class="section level4 hasAnchor" number="6.2.5.2">
<h4><span class="header-section-number">6.2.5.2</span> 参数<a href="api-ref.html#参数-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_irq_callback_type_t type</code>:</p>
<p>需要配置的 IRQ。</p></li>
<li><p><code>uint8_t flag</code>:</p>
<p>启用（1）或禁用（0）。</p></li>
</ul>
</div>
<div id="返回值-8" class="section level4 hasAnchor" number="6.2.5.3">
<h4><span class="header-section-number">6.2.5.3</span> 返回值<a href="api-ref.html#返回值-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-8" class="section level4 hasAnchor" number="6.2.5.4">
<h4><span class="header-section-number">6.2.5.4</span> 备注<a href="api-ref.html#备注-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>这里的“启用”或“禁用”中断是从CPU的角度来看的。以 UART 为例，UART 本身需要配置为在接收、发送或超时时生成中断，这不在本函数的范围内。</p>
</div>
<div id="示例-8" class="section level4 hasAnchor" number="6.2.5.5">
<h4><span class="header-section-number">6.2.5.5</span> 示例<a href="api-ref.html#示例-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>启用来自 UART0 的中断请求：</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb57-1"><a href="api-ref.html#cb57-1" aria-hidden="true" tabindex="-1"></a>platform_enable_irq<span class="op">(</span></span>
<span id="cb57-2"><a href="api-ref.html#cb57-2" aria-hidden="true" tabindex="-1"></a>    PLATFORM_CB_IRQ_UART0<span class="op">,</span></span>
<span id="cb57-3"><a href="api-ref.html#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="时钟" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> 时钟<a href="api-ref.html#时钟" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>另请参阅“Programmer’s Guide - Power Saving”<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a>中的“The Real-time Clock”<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a>。</p>
<div id="platform_calibrate_rt_clk" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> <code>platform_calibrate_rt_clk</code><a href="api-ref.html#platform_calibrate_rt_clk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>校准实时时钟并获取校准值。</p>
<div id="函数原型-8" class="section level4 hasAnchor" number="6.3.1.1">
<h4><span class="header-section-number">6.3.1.1</span> 函数原型<a href="api-ref.html#函数原型-8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb58"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb58-1"><a href="api-ref.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_calibrate_rt_clk<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_rt_rc_auto_tune" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> <code>platform_rt_rc_auto_tune</code><a href="api-ref.html#platform_rt_rc_auto_tune" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>自动调整内部实时RC时钟，并获取调整值。</p>
<p>对于ING918，此函数将内部实时RC时钟调整至50kHz<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>。
对于其他设备，它将内部实时RC时钟调整至32768Hz。</p>
<div id="函数原型-9" class="section level4 hasAnchor" number="6.3.2.1">
<h4><span class="header-section-number">6.3.2.1</span> 函数原型<a href="api-ref.html#函数原型-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb59"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb59-1"><a href="api-ref.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint16_t</span> platform_rt_rc_auto_tune<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-9" class="section level4 hasAnchor" number="6.3.2.2">
<h4><span class="header-section-number">6.3.2.2</span> 参数<a href="api-ref.html#参数-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-9" class="section level4 hasAnchor" number="6.3.2.3">
<h4><span class="header-section-number">6.3.2.3</span> 返回值<a href="api-ref.html#返回值-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>16位的调整值。</p>
</div>
<div id="备注-9" class="section level4 hasAnchor" number="6.3.2.4">
<h4><span class="header-section-number">6.3.2.4</span> 备注<a href="api-ref.html#备注-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果应用程序启用了省电模式，并且使用实时RC时钟作为时钟源，则必须调用此函数。</p>
<p>此操作耗时约250ms。建议调用一次并存储返回值以供后续使用。</p>
</div>
<div id="示例-9" class="section level4 hasAnchor" number="6.3.2.5">
<h4><span class="header-section-number">6.3.2.5</span> 示例<a href="api-ref.html#示例-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb60"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb60-1"><a href="api-ref.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 最简单的示例：在`PLATFORM_CB_EVT_PROFILE_INIT`的回调函数中调用此函数，</span></span>
<span id="cb60-2"><a href="api-ref.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 不保存返回值。</span></span>
<span id="cb60-3"><a href="api-ref.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> setup_profile<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>user_data<span class="op">)</span></span>
<span id="cb60-4"><a href="api-ref.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb60-5"><a href="api-ref.html#cb60-5" aria-hidden="true" tabindex="-1"></a>    platform_rt_rc_auto_tune<span class="op">();</span></span>
<span id="cb60-6"><a href="api-ref.html#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb60-7"><a href="api-ref.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="platform_rt_rc_auto_tune2" class="section level3 hasAnchor" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> <code>platform_rt_rc_auto_tune2</code><a href="api-ref.html#platform_rt_rc_auto_tune2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>自动调整内部实时RC时钟至特定频率，并获取调整值。</p>
<div id="函数原型-10" class="section level4 hasAnchor" number="6.3.3.1">
<h4><span class="header-section-number">6.3.3.1</span> 函数原型<a href="api-ref.html#函数原型-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb61"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb61-1"><a href="api-ref.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint16_t</span> platform_rt_rc_auto_tune2<span class="op">(</span></span>
<span id="cb61-2"><a href="api-ref.html#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> target_frequency<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-10" class="section level4 hasAnchor" number="6.3.3.2">
<h4><span class="header-section-number">6.3.3.2</span> 参数<a href="api-ref.html#参数-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint32_t target_frequency</code></p>
<p>目标频率，单位为赫兹（Hz）。</p></li>
</ul>
</div>
<div id="返回值-10" class="section level4 hasAnchor" number="6.3.3.3">
<h4><span class="header-section-number">6.3.3.3</span> 返回值<a href="api-ref.html#返回值-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>返回16位的调整值。</p>
</div>
</div>
<div id="platform_rt_rc_tune" class="section level3 hasAnchor" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> <code>platform_rt_rc_tune</code><a href="api-ref.html#platform_rt_rc_tune" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>使用调谐值调整内部实时RC时钟。</p>
<div id="函数原型-11" class="section level4 hasAnchor" number="6.3.4.1">
<h4><span class="header-section-number">6.3.4.1</span> 函数原型<a href="api-ref.html#函数原型-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb62"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb62-1"><a href="api-ref.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_rt_rc_tune<span class="op">(</span><span class="dt">uint16_t</span> value<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-11" class="section level4 hasAnchor" number="6.3.4.2">
<h4><span class="header-section-number">6.3.4.2</span> 参数<a href="api-ref.html#参数-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint16_t value</code></p>
<p>用于调谐时钟的值（由 <a href="api-ref.html#platform_rt_rc_auto_tune"><code>platform_rt_rc_auto_tune</code></a> 或 <a href="api-ref.html#platform_rt_rc_auto_tune2"><code>platform_rt_rc_auto_tune2</code></a> 返回）</p></li>
</ul>
</div>
<div id="返回值-11" class="section level4 hasAnchor" number="6.3.4.3">
<h4><span class="header-section-number">6.3.4.3</span> 返回值<a href="api-ref.html#返回值-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-10" class="section level4 hasAnchor" number="6.3.4.4">
<h4><span class="header-section-number">6.3.4.4</span> 备注<a href="api-ref.html#备注-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="示例-10" class="section level4 hasAnchor" number="6.3.4.5">
<h4><span class="header-section-number">6.3.4.5</span> 示例<a href="api-ref.html#示例-10" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb63"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb63-1"><a href="api-ref.html#cb63-1" aria-hidden="true" tabindex="-1"></a>platform_rt_rc_tune<span class="op">(</span>value<span class="op">);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="rf" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> RF<a href="api-ref.html#rf" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_set_rf_clk_source" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> <code>platform_set_rf_clk_source</code><a href="api-ref.html#platform_set_rf_clk_source" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>选择射频时钟源。此函数供内部使用。</p>
</div>
<div id="platform_set_rf_init_data" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> <code>platform_set_rf_init_data</code><a href="api-ref.html#platform_set_rf_init_data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>自定义射频初始化数据。此函数供内部使用。</p>
</div>
<div id="platform_set_rf_power_mapping" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> <code>platform_set_rf_power_mapping</code><a href="api-ref.html#platform_set_rf_power_mapping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>功率等级在内部由一个索引表示。存在一个功率映射表，该表列出了每个索引对应的实际发射功率等级。以 ING918 为例，功率索引的范围是 [0..63]，功率映射表是一个包含 64 个条目的数组，每个条目给出了以 0.01 dBm 为单位的发射功率等级。</p>
<p>对于需要更好功率等级控制的应用，可以测量每个索引的实际功率等级。使用此函数更新映射表后，堆栈可以确定请求功率等级的适当索引。</p>
<div id="函数原型-12" class="section level4 hasAnchor" number="6.4.3.1">
<h4><span class="header-section-number">6.4.3.1</span> 函数原型<a href="api-ref.html#函数原型-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb64"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb64-1"><a href="api-ref.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_rf_power_mapping<span class="op">(</span></span>
<span id="cb64-2"><a href="api-ref.html#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int16_t</span> <span class="op">*</span>rf_power_mapping<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-12" class="section level4 hasAnchor" number="6.4.3.2">
<h4><span class="header-section-number">6.4.3.2</span> 参数<a href="api-ref.html#参数-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const int16_t *rf_power_mapping</code></p>
<p>新的功率映射表。</p></li>
</ul>
</div>
<div id="返回值-12" class="section level4 hasAnchor" number="6.4.3.3">
<h4><span class="header-section-number">6.4.3.3</span> 返回值<a href="api-ref.html#返回值-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-11" class="section level4 hasAnchor" number="6.4.3.4">
<h4><span class="header-section-number">6.4.3.4</span> 备注<a href="api-ref.html#备注-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="示例-11" class="section level4 hasAnchor" number="6.4.3.5">
<h4><span class="header-section-number">6.4.3.5</span> 示例<a href="api-ref.html#示例-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb65"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb65-1"><a href="api-ref.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">const</span> <span class="dt">int16_t</span> power_mapping<span class="op">[]</span> <span class="op">=</span></span>
<span id="cb65-2"><a href="api-ref.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb65-3"><a href="api-ref.html#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="dv">6337</span><span class="op">,</span>  <span class="co">// 索引 0: -63.37dBm</span></span>
<span id="cb65-4"><a href="api-ref.html#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb65-5"><a href="api-ref.html#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">603</span>     <span class="co">// 索引 63: 6.03dBm</span></span>
<span id="cb65-6"><a href="api-ref.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb65-7"><a href="api-ref.html#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="api-ref.html#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="api-ref.html#cb65-9" aria-hidden="true" tabindex="-1"></a>platform_set_rf_power_mapping<span class="op">(</span></span>
<span id="cb65-10"><a href="api-ref.html#cb65-10" aria-hidden="true" tabindex="-1"></a>    power_mapping<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_patch_rf_init_data" class="section level3 hasAnchor" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> <code>platform_patch_rf_init_data</code><a href="api-ref.html#platform_patch_rf_init_data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>修补部分内部射频初始化数据。此函数供内部使用。</p>
</div>
</div>
<div id="内存与实时操作系统rtos" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> 内存与实时操作系统（RTOS）<a href="api-ref.html#内存与实时操作系统rtos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_call_on_stack" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> <code>platform_call_on_stack</code><a href="api-ref.html#platform_call_on_stack" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在独立的专用堆栈上调用函数。当需要偶尔调用一个使用大量堆栈的函数时，可以使用此接口。</p>
<div id="函数原型-13" class="section level4 hasAnchor" number="6.5.1.1">
<h4><span class="header-section-number">6.5.1.1</span> 函数原型<a href="api-ref.html#函数原型-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb66"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb66-1"><a href="api-ref.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_call_on_stack<span class="op">(</span></span>
<span id="cb66-2"><a href="api-ref.html#cb66-2" aria-hidden="true" tabindex="-1"></a>    f_platform_function f<span class="op">,</span></span>
<span id="cb66-3"><a href="api-ref.html#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>user_data<span class="op">,</span></span>
<span id="cb66-4"><a href="api-ref.html#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>stack_start<span class="op">,</span></span>
<span id="cb66-5"><a href="api-ref.html#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> stack_size<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-13" class="section level4 hasAnchor" number="6.5.1.2">
<h4><span class="header-section-number">6.5.1.2</span> 参数<a href="api-ref.html#参数-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>f_platform_function f</code></p>
<p>要调用的函数。</p></li>
<li><p><code>void *user_data</code></p>
<p>传递给 <code>f</code> 的用户数据。</p></li>
<li><p><code>void *stack_start</code></p>
<p>专用堆栈的起始（最低）地址。</p></li>
<li><p><code>uint32_t stack_size</code></p>
<p>专用堆栈的大小，以字节为单位。</p></li>
</ul>
</div>
<div id="返回值-13" class="section level4 hasAnchor" number="6.5.1.3">
<h4><span class="header-section-number">6.5.1.3</span> 返回值<a href="api-ref.html#返回值-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-12" class="section level4 hasAnchor" number="6.5.1.4">
<h4><span class="header-section-number">6.5.1.4</span> 备注<a href="api-ref.html#备注-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>尽管提供了 <code>stack_size</code>，但此函数不会保护堆栈不被 <code>f</code> 覆盖。</p>
</div>
</div>
<div id="platform_get_current_task" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> <code>platform_get_current_task</code><a href="api-ref.html#platform_get_current_task" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>获取调用此API的当前任务。</p>
<div id="函数原型-14" class="section level4 hasAnchor" number="6.5.2.1">
<h4><span class="header-section-number">6.5.2.1</span> 函数原型<a href="api-ref.html#函数原型-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb67"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb67-1"><a href="api-ref.html#cb67-1" aria-hidden="true" tabindex="-1"></a>platform_task_id_t platform_get_current_task<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-14" class="section level4 hasAnchor" number="6.5.2.2">
<h4><span class="header-section-number">6.5.2.2</span> 参数<a href="api-ref.html#参数-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-14" class="section level4 hasAnchor" number="6.5.2.3">
<h4><span class="header-section-number">6.5.2.3</span> 返回值<a href="api-ref.html#返回值-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb68"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb68-1"><a href="api-ref.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span></span>
<span id="cb68-2"><a href="api-ref.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb68-3"><a href="api-ref.html#cb68-3" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TASK_CONTROLLER<span class="op">,</span>  <span class="co">// 控制器任务</span></span>
<span id="cb68-4"><a href="api-ref.html#cb68-4" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TASK_HOST<span class="op">,</span>        <span class="co">// 主机任务</span></span>
<span id="cb68-5"><a href="api-ref.html#cb68-5" aria-hidden="true" tabindex="-1"></a>    PLATFORM_TASK_RTOS_TIMER<span class="op">,</span>  <span class="co">// RTOS定时器任务</span></span>
<span id="cb68-6"><a href="api-ref.html#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_task_id_t<span class="op">;</span></span></code></pre></div>
</div>
<div id="备注-13" class="section level4 hasAnchor" number="6.5.2.4">
<h4><span class="header-section-number">6.5.2.4</span> 备注<a href="api-ref.html#备注-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>此API仅在带有内置 RTOS 的软件包中可用。</p>
</div>
</div>
<div id="platform_get_gen_os_driver" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> <code>platform_get_gen_os_driver</code><a href="api-ref.html#platform_get_gen_os_driver" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>获取通用操作系统驱动。对于“NoOS”变体，返回由应用程序提供的驱动；对于内置 RTOS 的软件包，返回一个模拟出来的驱动接口。</p>
<div id="函数原型-15" class="section level4 hasAnchor" number="6.5.3.1">
<h4><span class="header-section-number">6.5.3.1</span> 函数原型<a href="api-ref.html#函数原型-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb69"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb69-1"><a href="api-ref.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>platform_get_gen_os_driver<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-15" class="section level4 hasAnchor" number="6.5.3.2">
<h4><span class="header-section-number">6.5.3.2</span> 参数<a href="api-ref.html#参数-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-15" class="section level4 hasAnchor" number="6.5.3.3">
<h4><span class="header-section-number">6.5.3.3</span> 返回值<a href="api-ref.html#返回值-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>返回值被强制转换为 <code>const gen_os_driver_t *</code>。开发者可以将返回值强制转换回 <code>const gen_os_driver_t *</code> 并使用其中的API。</p>
</div>
<div id="备注-14" class="section level4 hasAnchor" number="6.5.3.4">
<h4><span class="header-section-number">6.5.3.4</span> 备注<a href="api-ref.html#备注-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>gen_os_driver_t</code> 是RTOS上的一个抽象层。使用其中的API而不是直接使用RTOS API可以使应用程序跨RTOS（独立于底层RTOS）。</p>
<p>在 SDK v8.5 及更新的版本里，由于内置 RTOS 可替换，在 <code>app_main</code> 调用这个函数就变得“奇怪”。为了向后兼容，
<code>platform_get_gen_os_driver</code> 像旧版本一样返回模拟出来的驱动接口。如果开发者要替换内置的 RTOS，
那么就不应该在 <code>app_main</code> 里使用这个接口。</p>
</div>
</div>
<div id="platform_get_heap_status" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> <code>platform_get_heap_status</code><a href="api-ref.html#platform_get_heap_status" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>获取当前内置 RTOS 的堆的状态，例如可用大小等。</p>
<div id="函数原型-16" class="section level4 hasAnchor" number="6.5.4.1">
<h4><span class="header-section-number">6.5.4.1</span> 函数原型<a href="api-ref.html#函数原型-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb70"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb70-1"><a href="api-ref.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_get_heap_status<span class="op">(</span>platform_heap_status_t <span class="op">*</span>status<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-16" class="section level4 hasAnchor" number="6.5.4.2">
<h4><span class="header-section-number">6.5.4.2</span> 参数<a href="api-ref.html#参数-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_heap_status_t *status</code></p>
<p>堆状态。</p></li>
</ul>
</div>
<div id="返回值-16" class="section level4 hasAnchor" number="6.5.4.3">
<h4><span class="header-section-number">6.5.4.3</span> 返回值<a href="api-ref.html#返回值-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-15" class="section level4 hasAnchor" number="6.5.4.4">
<h4><span class="header-section-number">6.5.4.4</span> 备注<a href="api-ref.html#备注-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>堆状态定义为：</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb71-1"><a href="api-ref.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span></span>
<span id="cb71-2"><a href="api-ref.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb71-3"><a href="api-ref.html#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> bytes_free<span class="op">;</span>                <span class="co">// 总空闲字节数</span></span>
<span id="cb71-4"><a href="api-ref.html#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> bytes_minimum_ever_free<span class="op">;</span>   <span class="co">// 自启动以来bytes_free的最小值</span></span>
<span id="cb71-5"><a href="api-ref.html#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> platform_heap_status_t<span class="op">;</span></span></code></pre></div>
</div>
<div id="示例-12" class="section level4 hasAnchor" number="6.5.4.5">
<h4><span class="header-section-number">6.5.4.5</span> 示例<a href="api-ref.html#示例-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb72"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb72-1"><a href="api-ref.html#cb72-1" aria-hidden="true" tabindex="-1"></a>platform_heap_status_t status<span class="op">;</span></span>
<span id="cb72-2"><a href="api-ref.html#cb72-2" aria-hidden="true" tabindex="-1"></a>platform_get_heap_status<span class="op">(&amp;</span>status<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_get_rtos_heap_mem" class="section level3 hasAnchor" number="6.5.5">
<h3><span class="header-section-number">6.5.5</span> <code>platform_get_rtos_heap_mem</code><a href="api-ref.html#platform_get_rtos_heap_mem" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>获取内置 RTOS 用作堆的内存块。</p>
<div id="函数原型-17" class="section level4 hasAnchor" number="6.5.5.1">
<h4><span class="header-section-number">6.5.5.1</span> 函数原型<a href="api-ref.html#函数原型-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb73"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb73-1"><a href="api-ref.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>platform_get_rtos_heap_mem<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>size<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-17" class="section level4 hasAnchor" number="6.5.5.2">
<h4><span class="header-section-number">6.5.5.2</span> 参数<a href="api-ref.html#参数-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>int *size</code></p>
<p>内存块的大小，以字节为单位。</p></li>
</ul>
</div>
<div id="返回值-17" class="section level4 hasAnchor" number="6.5.5.3">
<h4><span class="header-section-number">6.5.5.3</span> 返回值<a href="api-ref.html#返回值-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>内存块的地址。</p>
</div>
<div id="备注-16" class="section level4 hasAnchor" number="6.5.5.4">
<h4><span class="header-section-number">6.5.5.4</span> 备注<a href="api-ref.html#备注-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>当使用自定义 RTOS 替换内置 RTOS 时，这块内存完全不会被使用。
开发者可以通过此 API 获取其地址和大小，并利用它。</p>
</div>
<div id="示例-13" class="section level4 hasAnchor" number="6.5.5.5">
<h4><span class="header-section-number">6.5.5.5</span> 示例<a href="api-ref.html#示例-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb74"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb74-1"><a href="api-ref.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 将此内存块初始化为 RT-Thread 的堆</span></span>
<span id="cb74-2"><a href="api-ref.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> size <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb74-3"><a href="api-ref.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>heap <span class="op">=</span> platform_get_rtos_heap_mem<span class="op">(&amp;</span>size<span class="op">);</span></span>
<span id="cb74-4"><a href="api-ref.html#cb74-4" aria-hidden="true" tabindex="-1"></a>rt_system_heap_init<span class="op">(</span>heap<span class="op">,</span> heap <span class="op">+</span> size<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_get_task_handle" class="section level3 hasAnchor" number="6.5.6">
<h3><span class="header-section-number">6.5.6</span> <code>platform_get_task_handle</code><a href="api-ref.html#platform_get_task_handle" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>获取特定 platform 任务的 RTOS 句柄。</p>
<div id="函数原型-18" class="section level4 hasAnchor" number="6.5.6.1">
<h4><span class="header-section-number">6.5.6.1</span> 函数原型<a href="api-ref.html#函数原型-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb75"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb75-1"><a href="api-ref.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uintptr_t</span> platform_get_task_handle<span class="op">(</span></span>
<span id="cb75-2"><a href="api-ref.html#cb75-2" aria-hidden="true" tabindex="-1"></a>    platform_task_id_t id<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-18" class="section level4 hasAnchor" number="6.5.6.2">
<h4><span class="header-section-number">6.5.6.2</span> 参数<a href="api-ref.html#参数-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_task_id_t id</code></p>
<p>platform 任务 ID。</p></li>
</ul>
</div>
<div id="返回值-18" class="section level4 hasAnchor" number="6.5.6.3">
<h4><span class="header-section-number">6.5.6.3</span> 返回值<a href="api-ref.html#返回值-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果 platform 知道该任务的句柄，则返回任务句柄；否则返回0。例如，在“NoOS”变体中，platform 不知道<code>PLATFORM_TASK_RTOS_TIMER</code>的句柄，因此返回0。</p>
</div>
</div>
<div id="platform_install_task_stack" class="section level3 hasAnchor" number="6.5.7">
<h3><span class="header-section-number">6.5.7</span> <code>platform_install_task_stack</code><a href="api-ref.html#platform_install_task_stack" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>为特定 platform 任务安装一个新的RTOS堆栈。</p>
<p>当默认堆栈大小不足以满足内部任务需求时，使用此函数来扩大堆栈。例如，用户开发的 RTOS 定时器回调可能需要更大的堆栈空间。</p>
<p>开发者可以查阅 RTOS 文档以了解如何检查堆栈使用情况。例如，在FreeRTOS中，<code>uxTaskGetStackHighWaterMark</code> 用于查询任务接近溢出分配给它的堆栈空间的程度。</p>
<div id="函数原型-19" class="section level4 hasAnchor" number="6.5.7.1">
<h4><span class="header-section-number">6.5.7.1</span> 函数原型<a href="api-ref.html#函数原型-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb76"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb76-1"><a href="api-ref.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_install_task_stack<span class="op">(</span></span>
<span id="cb76-2"><a href="api-ref.html#cb76-2" aria-hidden="true" tabindex="-1"></a>    platform_task_id_t id<span class="op">,</span></span>
<span id="cb76-3"><a href="api-ref.html#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>start<span class="op">,</span></span>
<span id="cb76-4"><a href="api-ref.html#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> size<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-19" class="section level4 hasAnchor" number="6.5.7.2">
<h4><span class="header-section-number">6.5.7.2</span> 参数<a href="api-ref.html#参数-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_task_id_t id</code></p>
<p>任务标识符。</p></li>
<li><p><code>void *start</code></p>
<p>堆栈的起始（最低）地址。地址应针对底层 CPU 进行适当对齐。</p></li>
<li><p><code>uint32_t size</code></p>
<p>新堆栈的大小，以字节为单位。</p></li>
</ul>
</div>
<div id="返回值-19" class="section level4 hasAnchor" number="6.5.7.3">
<h4><span class="header-section-number">6.5.7.3</span> 返回值<a href="api-ref.html#返回值-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-17" class="section level4 hasAnchor" number="6.5.7.4">
<h4><span class="header-section-number">6.5.7.4</span> 备注<a href="api-ref.html#备注-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>此函数应仅在 <code>app_main</code> 中调用。</p>
<p>对于NoOS变体，在实现通用操作系统接口时，可以替换 RTOS 堆栈（修改其大小等）。</p>
</div>
</div>
<div id="platform_install_isr_stack" class="section level3 hasAnchor" number="6.5.8">
<h3><span class="header-section-number">6.5.8</span> <code>platform_install_isr_stack</code><a href="api-ref.html#platform_install_isr_stack" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>为中断服务例程（ISR）安装一个新的堆栈。</p>
<div id="函数原型-20" class="section level4 hasAnchor" number="6.5.8.1">
<h4><span class="header-section-number">6.5.8.1</span> 函数原型<a href="api-ref.html#函数原型-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb77"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb77-1"><a href="api-ref.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_install_isr_stack<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>top<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-20" class="section level4 hasAnchor" number="6.5.8.2">
<h4><span class="header-section-number">6.5.8.2</span> 参数<a href="api-ref.html#参数-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>void *top</code></p>
<p>新堆栈的顶部，必须针对底层CPU进行适当对齐。</p></li>
</ul>
</div>
<div id="返回值-20" class="section level4 hasAnchor" number="6.5.8.3">
<h4><span class="header-section-number">6.5.8.3</span> 返回值<a href="api-ref.html#返回值-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-18" class="section level4 hasAnchor" number="6.5.8.4">
<h4><span class="header-section-number">6.5.8.4</span> 备注<a href="api-ref.html#备注-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果应用程序需要比 ISR 中默认堆栈更大的堆栈，可以安装一个新堆栈来替换默认堆栈。</p>
<p>此函数仅允许在 <code>app_main</code> 中调用。新堆栈将在 <code>app_main</code> 返回后投入使用。</p>
</div>
<div id="示例-14" class="section level4 hasAnchor" number="6.5.8.5">
<h4><span class="header-section-number">6.5.8.5</span> 示例<a href="api-ref.html#示例-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb78"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb78-1"><a href="api-ref.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> new_stack<span class="op">[</span><span class="dv">2048</span><span class="op">];</span></span>
<span id="cb78-2"><a href="api-ref.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb78-3"><a href="api-ref.html#cb78-3" aria-hidden="true" tabindex="-1"></a>platform_install_isr_stack<span class="op">(</span>new_stack <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span>new_stack<span class="op">)</span> <span class="op">/</span> <span class="kw">sizeof</span><span class="op">(</span>new_stack<span class="op">[</span><span class="dv">0</span><span class="op">]));</span></span></code></pre></div>
</div>
</div>
</div>
<div id="时间与定时器" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> 时间与定时器<a href="api-ref.html#时间与定时器" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>读取当前时间（定时器计数器）的API：</p>
<ul>
<li><code>platform_get_timer_counter</code></li>
<li><code>platform_get_us_time</code></li>
</ul>
<p>使用625微秒分辨率的定时器的API：</p>
<ul>
<li><code>platform_set_abs_timer</code></li>
<li><code>platform_set_timer</code></li>
<li><code>platform_delete_timer</code></li>
</ul>
<p>使用1微秒分辨率的定时器的API：</p>
<ul>
<li><code>platform_create_us_timer</code></li>
<li><code>platform_cancel_us_timer</code></li>
<li><code>platform_create_us_timer2</code></li>
</ul>
<p>这两种类型的定时器都可以在节能模式下使用，即当节能模式启用时，它们会按预期工作。表<a href="#tab:ch-api-compare-timers">6.1</a>比较了这两种定时器。</p>
<p>表: (#tab:ch-api-compare-timers) 两种 platform 定时器的比较</p>
<table style="width:100%;">
<colgroup>
<col width="17%" />
<col width="41%" />
<col width="41%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">类型</th>
<th align="left">625微秒分辨率</th>
<th align="left">1微秒分辨率</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">回调</td>
<td align="left">从类似任务的上下文中调用</td>
<td align="left">从中断服务例程（ISR）或调用者中调用</td>
</tr>
<tr class="even">
<td align="center">标识符</td>
<td align="left">回调函数指针</td>
<td align="left">定时器句柄</td>
</tr>
<tr class="odd">
<td align="center">容量</td>
<td align="left">受限于堆空间</td>
<td align="left">少量几个</td>
</tr>
</tbody>
</table>
<p>SDK v8.5 重新设计微秒分辨率定时器。</p>
<ul>
<li><p>在旧版本中，</p>
<p>API 实际上是对一些 Controller 函数的封装，其中 <code>platform_create_us_timer</code>
其实表示在时间点 <em>T</em> 调度一个持续时间为1微秒的操作。因此，如果 Controller
<em>将要</em> 在时间点 <em>T</em> 附近执行扫描或广告等操作，<code>platform_create_us_timer</code> 将
失败。在 <code>callback</code> 中调用 <code>platform_create_us_timer</code> 也是<strong>禁止的</strong>。</p></li>
<li><p>在v8.5及之后的版本中，</p>
<p>这些 API 不再是 Controller 函数的封装，<code>platform_create_us_timer</code>
在上面这种情况下也会成功。Controller 也使用此接口来管理所有 RF 操作。
可以在 <code>callback</code> 中调用 <code>platform_create_us_timer</code>。</p></li>
</ul>
<p><code>platform_create_us_timer</code> 从专用内存池中分配数据，该内存池的大小是固定且有限的。
在 v8.5 及之后的版本中，最多可以创建 4 个定时器。注意：Controller
使用并且仅使用其中一个这样的定时器。
如果 Controller 创建定时器失败，将引发 <code>PLATFORM_CB_EVT_HEAP_OOM</code> 事件。</p>
<div id="platform_cancel_us_timer" class="section level3 hasAnchor" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> <code>platform_cancel_us_timer</code><a href="api-ref.html#platform_cancel_us_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>取消之前由 <code>platform_create_us_timer</code> 创建的 platform 定时器。</p>
<div id="函数原型-21" class="section level4 hasAnchor" number="6.6.1.1">
<h4><span class="header-section-number">6.6.1.1</span> 函数原型<a href="api-ref.html#函数原型-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb79"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb79-1"><a href="api-ref.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> platform_cancel_us_timer<span class="op">(</span></span>
<span id="cb79-2"><a href="api-ref.html#cb79-2" aria-hidden="true" tabindex="-1"></a>    platform_us_timer_handle_t timer_handle<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-21" class="section level4 hasAnchor" number="6.6.1.2">
<h4><span class="header-section-number">6.6.1.2</span> 参数<a href="api-ref.html#参数-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>platform_us_timer_handle_t timer_handle</code></p>
<p>定时器的句柄。</p></li>
</ul>
</div>
<div id="返回值-21" class="section level4 hasAnchor" number="6.6.1.3">
<h4><span class="header-section-number">6.6.1.3</span> 返回值<a href="api-ref.html#返回值-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果指定的定时器成功取消，该函数返回 0。否则，返回一个非 0 值，这也意味着定时器的回调函数正在执行中。</p>
</div>
</div>
<div id="platform_create_us_timer" class="section level3 hasAnchor" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> <code>platform_create_us_timer</code><a href="api-ref.html#platform_create_us_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>设置一个具有 1 微秒（μs）分辨率的单次触发 platform 定时器。</p>
<div id="函数原型-22" class="section level4 hasAnchor" number="6.6.2.1">
<h4><span class="header-section-number">6.6.2.1</span> 函数原型<a href="api-ref.html#函数原型-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb80"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb80-1"><a href="api-ref.html#cb80-1" aria-hidden="true" tabindex="-1"></a>platform_us_timer_handle_t platform_create_us_timer<span class="op">(</span></span>
<span id="cb80-2"><a href="api-ref.html#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> abs_time<span class="op">,</span></span>
<span id="cb80-3"><a href="api-ref.html#cb80-3" aria-hidden="true" tabindex="-1"></a>    f_platform_us_timer_callback callback<span class="op">,</span></span>
<span id="cb80-4"><a href="api-ref.html#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>param<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-22" class="section level4 hasAnchor" number="6.6.2.2">
<h4><span class="header-section-number">6.6.2.2</span> 参数<a href="api-ref.html#参数-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint64_t abs_time</code></p>
<p>当 <code>platform_get_us_timer() == abs_time</code> 时，回调函数将被调用。</p></li>
<li><p><code>f_platform_us_timer_callback callback</code></p>
<p>回调函数。其签名为：</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb81-1"><a href="api-ref.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">void</span> <span class="op">(*</span> f_platform_us_timer_callback<span class="op">)(</span></span>
<span id="cb81-2"><a href="api-ref.html#cb81-2" aria-hidden="true" tabindex="-1"></a>    platform_us_timer_handle_t timer_handle<span class="op">,</span></span>
<span id="cb81-3"><a href="api-ref.html#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> time_us<span class="op">,</span></span>
<span id="cb81-4"><a href="api-ref.html#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>param<span class="op">);</span></span></code></pre></div>
<p>其中，<code>timer_handle</code> 是 <code>platform_create_us_timer</code> 的返回值，
<code>time_us</code> 是调用回调时 <code>platform_get_us_timer</code> 的当前值，
<code>param</code> 是创建此定时器时的用户参数。</p></li>
<li><p><code>void *param</code></p>
<p>用户参数。</p></li>
</ul>
</div>
<div id="返回值-22" class="section level4 hasAnchor" number="6.6.2.3">
<h4><span class="header-section-number">6.6.2.3</span> 返回值<a href="api-ref.html#返回值-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>该函数返回创建的定时器的句柄。如果定时器成功创建，则返回非 NULL 值。否则，返回 NULL。</p>
</div>
<div id="备注-19" class="section level4 hasAnchor" number="6.6.2.4">
<h4><span class="header-section-number">6.6.2.4</span> 备注<a href="api-ref.html#备注-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>尽管 <code>abs_time</code> 以微秒（μs）为单位，但<strong>不保证</strong>回调函数会以这样的分辨率被调用。</p>
<p>伪代码：</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb82-1"><a href="api-ref.html#cb82-1" aria-hidden="true" tabindex="-1"></a>create_us_timer<span class="op">(..)</span></span>
<span id="cb82-2"><a href="api-ref.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb82-3"><a href="api-ref.html#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>内存不足<span class="op">)</span> <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb82-4"><a href="api-ref.html#cb82-4" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> 分配句柄<span class="op">;</span></span>
<span id="cb82-5"><a href="api-ref.html#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>剩余时间太短<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-6"><a href="api-ref.html#cb82-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// callback 直接在调用者的上下文中被调用</span></span>
<span id="cb82-7"><a href="api-ref.html#cb82-7" aria-hidden="true" tabindex="-1"></a>        callback<span class="op">(</span>param<span class="op">);</span></span>
<span id="cb82-8"><a href="api-ref.html#cb82-8" aria-hidden="true" tabindex="-1"></a>        释放内存<span class="op">;</span></span>
<span id="cb82-9"><a href="api-ref.html#cb82-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> r<span class="op">;</span>   <span class="co">// 返回的是非 NULL</span></span>
<span id="cb82-10"><a href="api-ref.html#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb82-11"><a href="api-ref.html#cb82-11" aria-hidden="true" tabindex="-1"></a>    将 r 存储到队列<span class="op">;</span>  <span class="co">// callback 将在后续的 ISR 上下文中调用</span></span>
<span id="cb82-12"><a href="api-ref.html#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r<span class="op">;</span></span>
<span id="cb82-13"><a href="api-ref.html#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="platform_create_us_timer2" class="section level3 hasAnchor" number="6.6.3">
<h3><span class="header-section-number">6.6.3</span> <code>platform_create_us_timer2</code><a href="api-ref.html#platform_create_us_timer2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>设置一个具有 1 微秒（μs）分辨率的单次触发 platform 定时器。</p>
<div id="函数原型-23" class="section level4 hasAnchor" number="6.6.3.1">
<h4><span class="header-section-number">6.6.3.1</span> 函数原型<a href="api-ref.html#函数原型-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb83"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb83-1"><a href="api-ref.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> platform_create_us_timer2<span class="op">(</span></span>
<span id="cb83-2"><a href="api-ref.html#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> abs_time<span class="op">,</span></span>
<span id="cb83-3"><a href="api-ref.html#cb83-3" aria-hidden="true" tabindex="-1"></a>    f_platform_us_timer_callback callback<span class="op">,</span></span>
<span id="cb83-4"><a href="api-ref.html#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>param<span class="op">,</span></span>
<span id="cb83-5"><a href="api-ref.html#cb83-5" aria-hidden="true" tabindex="-1"></a>    platform_us_timer_handle_t <span class="op">*</span>timer_handle<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-23" class="section level4 hasAnchor" number="6.6.3.2">
<h4><span class="header-section-number">6.6.3.2</span> 参数<a href="api-ref.html#参数-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint64_t abs_time</code></p>
<p>当 <code>platform_get_us_timer() == abs_time</code> 时，回调函数将被调用。</p></li>
<li><p><code>f_platform_us_timer_callback callback</code></p>
<p>回调函数。</p></li>
<li><p><code>void *param</code></p>
<p>用户参数。</p></li>
<li><p><code>platform_us_timer_handle_t *timer_handle</code></p>
<p>当创建成功时，<code>timer_handle</code> 被设置为定时器的句柄。如果定时器失败，<code>timer_handle</code> 被设置为 NULL。</p></li>
</ul>
</div>
<div id="返回值-23" class="section level4 hasAnchor" number="6.6.3.3">
<h4><span class="header-section-number">6.6.3.3</span> 返回值<a href="api-ref.html#返回值-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果创建成功，返回 <code>0</code>，否则返回 <code>-1</code>。</p>
</div>
<div id="备注-20" class="section level4 hasAnchor" number="6.6.3.4">
<h4><span class="header-section-number">6.6.3.4</span> 备注<a href="api-ref.html#备注-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>一种常见的用法是在回调函数清除句柄。当使用 <code>platform_create_us_timer</code>，这种做法可能存在问题。例如：</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb84-1"><a href="api-ref.html#cb84-1" aria-hidden="true" tabindex="-1"></a>platform_us_timer_handle_t handle<span class="op">;</span></span>
<span id="cb84-2"><a href="api-ref.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> callback<span class="op">(...)</span></span>
<span id="cb84-3"><a href="api-ref.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb84-4"><a href="api-ref.html#cb84-4" aria-hidden="true" tabindex="-1"></a>    handle <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb84-5"><a href="api-ref.html#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb84-6"><a href="api-ref.html#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="api-ref.html#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">// 回调函数可能在返回前就调用了，这时，</span></span>
<span id="cb84-8"><a href="api-ref.html#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co">// handle 未能清除</span></span>
<span id="cb84-9"><a href="api-ref.html#cb84-9" aria-hidden="true" tabindex="-1"></a>handle <span class="op">=</span> platform_create_us_timer<span class="op">(</span>T<span class="op">,</span></span>
<span id="cb84-10"><a href="api-ref.html#cb84-10" aria-hidden="true" tabindex="-1"></a>    callback<span class="op">);</span></span></code></pre></div>
<p>使用 <code>platform_create_us_timer2</code> 可以避免这种问题：</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb85-1"><a href="api-ref.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 在调用 `callback` 之前，</span></span>
<span id="cb85-2"><a href="api-ref.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co">// `handle` 已由 `platform_create_us_timer2`</span></span>
<span id="cb85-3"><a href="api-ref.html#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 填入了正确的句柄</span></span>
<span id="cb85-4"><a href="api-ref.html#cb85-4" aria-hidden="true" tabindex="-1"></a>platform_create_us_timer2<span class="op">(</span>T<span class="op">,</span></span>
<span id="cb85-5"><a href="api-ref.html#cb85-5" aria-hidden="true" tabindex="-1"></a>    callback<span class="op">,</span></span>
<span id="cb85-6"><a href="api-ref.html#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>handle<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_delete_timer" class="section level3 hasAnchor" number="6.6.4">
<h3><span class="header-section-number">6.6.4</span> <code>platform_delete_timer</code><a href="api-ref.html#platform_delete_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>删除先前由 <code>platform_set_timer</code> 或 <code>platform_set_abs_timer</code> 创建的platform定时器。</p>
<div id="函数原型-24" class="section level4 hasAnchor" number="6.6.4.1">
<h4><span class="header-section-number">6.6.4.1</span> 函数原型<a href="api-ref.html#函数原型-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb86"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb86-1"><a href="api-ref.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_delete_timer<span class="op">(</span>f_platform_timer_callback callback<span class="op">)</span></span></code></pre></div>
</div>
<div id="参数-24" class="section level4 hasAnchor" number="6.6.4.2">
<h4><span class="header-section-number">6.6.4.2</span> 参数<a href="api-ref.html#参数-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>f_platform_timer_callback callback</code></p>
<p>回调函数，同时也是定时器的标识符。</p></li>
</ul>
</div>
<div id="返回值-24" class="section level4 hasAnchor" number="6.6.4.3">
<h4><span class="header-section-number">6.6.4.3</span> 返回值<a href="api-ref.html#返回值-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-21" class="section level4 hasAnchor" number="6.6.4.4">
<h4><span class="header-section-number">6.6.4.4</span> 备注<a href="api-ref.html#备注-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>调用此函数时，回调可能已经排队等待在任务中调用。因此，在调用此函数后，回调仍可能被调用。</p>
</div>
</div>
<div id="platform_get_timer_counter" class="section level3 hasAnchor" number="6.6.5">
<h3><span class="header-section-number">6.6.5</span> <code>platform_get_timer_counter</code><a href="api-ref.html#platform_get_timer_counter" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>读取platform定时器的计数器，分辨率为625微秒。</p>
<div id="函数原型-25" class="section level4 hasAnchor" number="6.6.5.1">
<h4><span class="header-section-number">6.6.5.1</span> 函数原型<a href="api-ref.html#函数原型-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb87"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb87-1"><a href="api-ref.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_get_timer_counter<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-25" class="section level4 hasAnchor" number="6.6.5.2">
<h4><span class="header-section-number">6.6.5.2</span> 参数<a href="api-ref.html#参数-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-25" class="section level4 hasAnchor" number="6.6.5.3">
<h4><span class="header-section-number">6.6.5.3</span> 返回值<a href="api-ref.html#返回值-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>一个完整的32位值，表示当前计数器的值，大致等于 <code>platform_get_us_time() / 625</code>。
### <code>platform_get_us_time</code></p>
<p>读取自BLE初始化以来的内部时间计数。</p>
</div>
<div id="函数原型-26" class="section level4 hasAnchor" number="6.6.5.4">
<h4><span class="header-section-number">6.6.5.4</span> 函数原型<a href="api-ref.html#函数原型-26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb88"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb88-1"><a href="api-ref.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int64_t</span> platform_get_us_time<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-26" class="section level4 hasAnchor" number="6.6.5.5">
<h4><span class="header-section-number">6.6.5.5</span> 参数<a href="api-ref.html#参数-26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-26" class="section level4 hasAnchor" number="6.6.5.6">
<h4><span class="header-section-number">6.6.5.6</span> 返回值<a href="api-ref.html#返回值-26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>内部时间计数器的值，以1微秒为单位计数。该计数器大约每21.8年溢出一次。</p>
</div>
<div id="备注-22" class="section level4 hasAnchor" number="6.6.5.7">
<h4><span class="header-section-number">6.6.5.7</span> 备注<a href="api-ref.html#备注-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>该计数器在关机后重新启动。</p>
</div>
<div id="示例-15" class="section level4 hasAnchor" number="6.6.5.8">
<h4><span class="header-section-number">6.6.5.8</span> 示例<a href="api-ref.html#示例-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb89"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb89-1"><a href="api-ref.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint64_t</span> now <span class="op">=</span> platform_get_us_time<span class="op">();</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_abs_timer" class="section level3 hasAnchor" number="6.6.6">
<h3><span class="header-section-number">6.6.6</span> <code>platform_set_abs_timer</code><a href="api-ref.html#platform_set_abs_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>设置一个单次触发的 platform 定时器，在绝对时间触发，分辨率为 625 微秒。</p>
<div id="函数原型-27" class="section level4 hasAnchor" number="6.6.6.1">
<h4><span class="header-section-number">6.6.6.1</span> 函数原型<a href="api-ref.html#函数原型-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb90"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb90-1"><a href="api-ref.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_abs_timer<span class="op">(</span></span>
<span id="cb90-2"><a href="api-ref.html#cb90-2" aria-hidden="true" tabindex="-1"></a>    f_platform_timer_callback callback<span class="op">,</span></span>
<span id="cb90-3"><a href="api-ref.html#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> abs_time<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-27" class="section level4 hasAnchor" number="6.6.6.2">
<h4><span class="header-section-number">6.6.6.2</span> 参数<a href="api-ref.html#参数-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>f_platform_timer_callback callback</code></p>
<p>定时器到期时的回调函数，该函数在类似 RTOS 任务的上下文中调用，而不是在中断服务例程（ISR）中调用。</p></li>
<li><p><code>uint32_t abs_time</code></p>
<p>当 <code>platform_get_timer_counter() == abs_time</code> 时，<code>callback</code> 被调用。
如果 <code>abs_time</code> 刚刚超过 <code>platform_get_timer_counter()</code>，<code>callback</code> 会立即被调用，
例如，<code>abs_time</code> 为 <code>platform_get_timer_counter() - 1</code>。</p></li>
</ul>
</div>
<div id="返回值-27" class="section level4 hasAnchor" number="6.6.6.3">
<h4><span class="header-section-number">6.6.6.3</span> 返回值<a href="api-ref.html#返回值-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-23" class="section level4 hasAnchor" number="6.6.6.4">
<h4><span class="header-section-number">6.6.6.4</span> 备注<a href="api-ref.html#备注-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>此函数总是成功，除非内存不足。</p>
</div>
<div id="示例-16" class="section level4 hasAnchor" number="6.6.6.5">
<h4><span class="header-section-number">6.6.6.5</span> 示例<a href="api-ref.html#示例-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>使用此函数模拟一个周期性定时器。</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb91-1"><a href="api-ref.html#cb91-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-2"><a href="api-ref.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PERIOD  100</span></span>
<span id="cb91-3"><a href="api-ref.html#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">uint32_t</span> last_timer <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb91-4"><a href="api-ref.html#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="api-ref.html#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_timer_callback<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb91-6"><a href="api-ref.html#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb91-7"><a href="api-ref.html#cb91-7" aria-hidden="true" tabindex="-1"></a>    last_timer <span class="op">+=</span> PERIOD<span class="op">;</span></span>
<span id="cb91-8"><a href="api-ref.html#cb91-8" aria-hidden="true" tabindex="-1"></a>    platform_set_abs_timer<span class="op">(</span>platform_timer_callback<span class="op">,</span> last_timer<span class="op">);</span></span>
<span id="cb91-9"><a href="api-ref.html#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="api-ref.html#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 执行周期性任务</span></span>
<span id="cb91-11"><a href="api-ref.html#cb91-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb91-12"><a href="api-ref.html#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb91-13"><a href="api-ref.html#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="api-ref.html#cb91-14" aria-hidden="true" tabindex="-1"></a>last_timer <span class="op">=</span> platform_get_timer_counter<span class="op">()</span> <span class="op">+</span> PERIOD<span class="op">;</span></span>
<span id="cb91-15"><a href="api-ref.html#cb91-15" aria-hidden="true" tabindex="-1"></a>platform_set_abs_timer<span class="op">(</span>platform_timer_callback<span class="op">,</span> last_timer<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_set_timer" class="section level3 hasAnchor" number="6.6.7">
<h3><span class="header-section-number">6.6.7</span> <code>platform_set_timer</code><a href="api-ref.html#platform_set_timer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>设置一个单次触发的 platform 定时器，从“现在”开始延迟，分辨率为 625 微秒。</p>
<div id="函数原型-28" class="section level4 hasAnchor" number="6.6.7.1">
<h4><span class="header-section-number">6.6.7.1</span> 函数原型<a href="api-ref.html#函数原型-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb92"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb92-1"><a href="api-ref.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_set_timer<span class="op">(</span></span>
<span id="cb92-2"><a href="api-ref.html#cb92-2" aria-hidden="true" tabindex="-1"></a>    f_platform_timer_callback callback<span class="op">,</span></span>
<span id="cb92-3"><a href="api-ref.html#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> delay<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-28" class="section level4 hasAnchor" number="6.6.7.2">
<h4><span class="header-section-number">6.6.7.2</span> 参数<a href="api-ref.html#参数-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>f_platform_timer_callback callback</code></p>
<p>定时器到期时的回调函数，该函数在类似 RTOS 任务的上下文中调用，而非中断服务例程（ISR）。</p></li>
<li><p><code>uint32_t delay</code></p>
<p>定时器到期前的延迟时间（单位：625 微秒）。</p>
<p>有效范围：0~0x7fffffff。当 <code>delay</code> 为 0 时，定时器被清除。</p></li>
</ul>
</div>
<div id="返回值-28" class="section level4 hasAnchor" number="6.6.7.3">
<h4><span class="header-section-number">6.6.7.3</span> 返回值<a href="api-ref.html#返回值-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-24" class="section level4 hasAnchor" number="6.6.7.4">
<h4><span class="header-section-number">6.6.7.4</span> 备注<a href="api-ref.html#备注-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>此函数总是成功，除非内存耗尽。</p>
<p><code>platform_set_timer(f, 100)</code> 等同于：</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb93-1"><a href="api-ref.html#cb93-1" aria-hidden="true" tabindex="-1"></a>platform_set_abs_timer<span class="op">(</span>f<span class="op">,</span></span>
<span id="cb93-2"><a href="api-ref.html#cb93-2" aria-hidden="true" tabindex="-1"></a>    platform_get_timer_counter<span class="op">()</span> <span class="op">+</span> <span class="dv">100</span><span class="op">);</span></span></code></pre></div>
<p><code>platform_set_timer(f, 0)</code> 等同于：</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb94-1"><a href="api-ref.html#cb94-1" aria-hidden="true" tabindex="-1"></a>platform_delete_timer<span class="op">(</span>f<span class="op">);</span></span></code></pre></div>
<p>但不等同于：</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb95-1"><a href="api-ref.html#cb95-1" aria-hidden="true" tabindex="-1"></a>platform_set_abs_timer<span class="op">(</span>f<span class="op">,</span></span>
<span id="cb95-2"><a href="api-ref.html#cb95-2" aria-hidden="true" tabindex="-1"></a>    platform_get_timer_counter<span class="op">()</span> <span class="op">+</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div>
<p>由于 <code>callback</code> 也是定时器的标识符，以下两行代码仅定义了一个在 200 个单位后到期的定时器，而非两个独立的定时器：</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb96-1"><a href="api-ref.html#cb96-1" aria-hidden="true" tabindex="-1"></a>platform_set_timer<span class="op">(</span>f<span class="op">,</span> <span class="dv">100</span><span class="op">);</span></span>
<span id="cb96-2"><a href="api-ref.html#cb96-2" aria-hidden="true" tabindex="-1"></a>platform_set_timer<span class="op">(</span>f<span class="op">,</span> <span class="dv">200</span><span class="op">);</span> <span class="co">// 更新定时器，而非创建新的</span></span></code></pre></div>
<p>如果 <code>f</code> 再次用于<code>platform_set_abs_timer</code>，则定时器再次被更新：</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb97-1"><a href="api-ref.html#cb97-1" aria-hidden="true" tabindex="-1"></a>platform_set_abs_timer<span class="op">(</span>f<span class="op">,</span> <span class="op">...);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="节能" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> 节能<a href="api-ref.html#节能" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>本节提供了在 RTOS 中实现节能的 API。
参见 “Programmer’s Guide - Power Saving”<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a>。</p>
<div id="platform_pre_suppress_cycles_and_sleep_processing" class="section level3 hasAnchor" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> <code>platform_pre_suppress_cycles_and_sleep_processing</code><a href="api-ref.html#platform_pre_suppress_cycles_and_sleep_processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>准备抑制一些低功耗实时时钟周期以实现无滴答节能。</p>
<div id="函数原型-29" class="section level4 hasAnchor" number="6.7.1.1">
<h4><span class="header-section-number">6.7.1.1</span> 函数原型<a href="api-ref.html#函数原型-29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb98"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb98-1"><a href="api-ref.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_pre_suppress_cycles_and_sleep_processing<span class="op">(</span></span>
<span id="cb98-2"><a href="api-ref.html#cb98-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> expected_cycles<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-29" class="section level4 hasAnchor" number="6.7.1.2">
<h4><span class="header-section-number">6.7.1.2</span> 参数<a href="api-ref.html#参数-29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint32_t expected_cycles</code></p>
<p>预期可以被抑制的周期数（在节能模式下可以安全跳过的周期）。</p>
<p>支持完整的 <code>uint32_t</code> 范围。</p></li>
</ul>
</div>
<div id="返回值-29" class="section level4 hasAnchor" number="6.7.1.3">
<h4><span class="header-section-number">6.7.1.3</span> 返回值<a href="api-ref.html#返回值-29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>调整后的可以被抑制的周期数。</p>
</div>
</div>
<div id="platform_pre_sleep_processing" class="section level3 hasAnchor" number="6.7.2">
<h3><span class="header-section-number">6.7.2</span> <code>platform_pre_sleep_processing</code><a href="api-ref.html#platform_pre_sleep_processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>无滴答睡眠的预处理。</p>
<div id="函数原型-30" class="section level4 hasAnchor" number="6.7.2.1">
<h4><span class="header-section-number">6.7.2.1</span> 函数原型<a href="api-ref.html#函数原型-30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb99"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb99-1"><a href="api-ref.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_pre_sleep_processing<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-30" class="section level4 hasAnchor" number="6.7.2.2">
<h4><span class="header-section-number">6.7.2.2</span> 参数<a href="api-ref.html#参数-30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-30" class="section level4 hasAnchor" number="6.7.2.3">
<h4><span class="header-section-number">6.7.2.3</span> 返回值<a href="api-ref.html#返回值-30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
</div>
<div id="platform_post_sleep_processing" class="section level3 hasAnchor" number="6.7.3">
<h3><span class="header-section-number">6.7.3</span> <code>platform_post_sleep_processing</code><a href="api-ref.html#platform_post_sleep_processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>无滴答睡眠的后处理。</p>
<div id="函数原型-31" class="section level4 hasAnchor" number="6.7.3.1">
<h4><span class="header-section-number">6.7.3.1</span> 函数原型<a href="api-ref.html#函数原型-31" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb100"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb100-1"><a href="api-ref.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_post_sleep_processing<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-31" class="section level4 hasAnchor" number="6.7.3.2">
<h4><span class="header-section-number">6.7.3.2</span> 参数<a href="api-ref.html#参数-31" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-31" class="section level4 hasAnchor" number="6.7.3.3">
<h4><span class="header-section-number">6.7.3.3</span> 返回值<a href="api-ref.html#返回值-31" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-25" class="section level4 hasAnchor" number="6.7.3.4">
<h4><span class="header-section-number">6.7.3.4</span> 备注<a href="api-ref.html#备注-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果调用了 <code>platform_pre_sleep_processing</code>，则必须跟随调用 <code>platform_post_sleep_processing</code>。</p>
</div>
</div>
<div id="platform_os_idle_resumed_hook" class="section level3 hasAnchor" number="6.7.4">
<h3><span class="header-section-number">6.7.4</span> <code>platform_os_idle_resumed_hook</code><a href="api-ref.html#platform_os_idle_resumed_hook" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>空闲任务恢复时的钩子。在空闲任务恢复时调用此函数。</p>
<div id="函数原型-32" class="section level4 hasAnchor" number="6.7.4.1">
<h4><span class="header-section-number">6.7.4.1</span> 函数原型<a href="api-ref.html#函数原型-32" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb101"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb101-1"><a href="api-ref.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_os_idle_resumed_hook<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-32" class="section level4 hasAnchor" number="6.7.4.2">
<h4><span class="header-section-number">6.7.4.2</span> 参数<a href="api-ref.html#参数-32" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-32" class="section level4 hasAnchor" number="6.7.4.3">
<h4><span class="header-section-number">6.7.4.3</span> 返回值<a href="api-ref.html#返回值-32" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
</div>
<div id="platform_os_idle_resumed_hook-1" class="section level3 hasAnchor" number="6.7.5">
<h3><span class="header-section-number">6.7.5</span> <code>platform_os_idle_resumed_hook</code><a href="api-ref.html#platform_os_idle_resumed_hook-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hook for Idle task got resumed. Call this when Idle task is resumed.</p>
<div id="函数原型-33" class="section level4 hasAnchor" number="6.7.5.1">
<h4><span class="header-section-number">6.7.5.1</span> 函数原型<a href="api-ref.html#函数原型-33" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb102"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb102-1"><a href="api-ref.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_os_idle_resumed_hook<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-33" class="section level4 hasAnchor" number="6.7.5.2">
<h4><span class="header-section-number">6.7.5.2</span> 参数<a href="api-ref.html#参数-33" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-33" class="section level4 hasAnchor" number="6.7.5.3">
<h4><span class="header-section-number">6.7.5.3</span> 返回值<a href="api-ref.html#返回值-33" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
</div>
<div id="platform_pre_suppress_ticks_and_sleep_processing" class="section level3 hasAnchor" number="6.7.6">
<h3><span class="header-section-number">6.7.6</span> <code>platform_pre_suppress_ticks_and_sleep_processing</code><a href="api-ref.html#platform_pre_suppress_ticks_and_sleep_processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>预抑制滴答和睡眠处理。此 API 已过时。请使用
<code>platform_pre_suppress_cycles_and_sleep_processing</code> 代替。</p>
</div>
</div>
<div id="实用工具" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> 实用工具<a href="api-ref.html#实用工具" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_hrng" class="section level3 hasAnchor" number="6.8.1">
<h3><span class="header-section-number">6.8.1</span> <code>platform_hrng</code><a href="api-ref.html#platform_hrng" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>使用硬件随机数生成器生成随机字节。</p>
<div id="函数原型-34" class="section level4 hasAnchor" number="6.8.1.1">
<h4><span class="header-section-number">6.8.1.1</span> 函数原型<a href="api-ref.html#函数原型-34" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb103"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb103-1"><a href="api-ref.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>  platform_hrng<span class="op">(</span><span class="dt">uint8_t</span> <span class="op">*</span>bytes<span class="op">,</span> <span class="dt">const</span> <span class="dt">uint32_t</span> len<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-34" class="section level4 hasAnchor" number="6.8.1.2">
<h4><span class="header-section-number">6.8.1.2</span> 参数<a href="api-ref.html#参数-34" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>uint8_t *bytes</code></p>
<p>随机数据输出。</p></li>
<li><p><code>const uint32_t len</code></p>
<p>要生成的随机字节数。</p></li>
</ul>
</div>
<div id="返回值-34" class="section level4 hasAnchor" number="6.8.1.3">
<h4><span class="header-section-number">6.8.1.3</span> 返回值<a href="api-ref.html#返回值-34" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-26" class="section level4 hasAnchor" number="6.8.1.4">
<h4><span class="header-section-number">6.8.1.4</span> 备注<a href="api-ref.html#备注-26" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>生成固定长度数据所需的时间是不确定的。</p>
</div>
<div id="示例-17" class="section level4 hasAnchor" number="6.8.1.5">
<h4><span class="header-section-number">6.8.1.5</span> 示例<a href="api-ref.html#示例-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb104"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb104-1"><a href="api-ref.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> strong_random<span class="op">;</span></span>
<span id="cb104-2"><a href="api-ref.html#cb104-2" aria-hidden="true" tabindex="-1"></a>platform_hrng<span class="op">(&amp;</span>strong_random<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>strong_random<span class="op">));</span></span></code></pre></div>
</div>
</div>
<div id="platform_rand" class="section level3 hasAnchor" number="6.8.2">
<h3><span class="header-section-number">6.8.2</span> <code>platform_rand</code><a href="api-ref.html#platform_rand" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>通过内部伪随机数生成器（PRNG）生成一个伪随机整数。</p>
<div id="函数原型-35" class="section level4 hasAnchor" number="6.8.2.1">
<h4><span class="header-section-number">6.8.2.1</span> 函数原型<a href="api-ref.html#函数原型-35" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb105"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb105-1"><a href="api-ref.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> platform_rand<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-35" class="section level4 hasAnchor" number="6.8.2.2">
<h4><span class="header-section-number">6.8.2.2</span> 参数<a href="api-ref.html#参数-35" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-35" class="section level4 hasAnchor" number="6.8.2.3">
<h4><span class="header-section-number">6.8.2.3</span> 返回值<a href="api-ref.html#返回值-35" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>返回一个范围在 0 到 RAND_MAX 之间的伪随机整数。</p>
</div>
<div id="备注-27" class="section level4 hasAnchor" number="6.8.2.4">
<h4><span class="header-section-number">6.8.2.4</span> 备注<a href="api-ref.html#备注-27" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>内部 PRNG 的种子在启动时由硬件随机数生成器（HRNG）初始化。此函数可用作标准库中 <code>rand()</code> 函数的替代。</p>
</div>
<div id="示例-18" class="section level4 hasAnchor" number="6.8.2.5">
<h4><span class="header-section-number">6.8.2.5</span> 示例<a href="api-ref.html#示例-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb106"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb106-1"><a href="api-ref.html#cb106-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;rand: %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> platform_rand<span class="op">());</span></span></code></pre></div>
</div>
</div>
<div id="platform_read_persistent_reg" class="section level3 hasAnchor" number="6.8.3">
<h3><span class="header-section-number">6.8.3</span> <code>platform_read_persistent_reg</code><a href="api-ref.html#platform_read_persistent_reg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>从持久寄存器中读取值。另请参阅
<a href="api-ref.html#platform_write_persistent_reg"><code>platform_write_persistent_reg</code></a>。</p>
<div id="函数原型-36" class="section level4 hasAnchor" number="6.8.3.1">
<h4><span class="header-section-number">6.8.3.1</span> 函数原型<a href="api-ref.html#函数原型-36" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb107"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb107-1"><a href="api-ref.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> platform_read_persistent_reg<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-36" class="section level4 hasAnchor" number="6.8.3.2">
<h4><span class="header-section-number">6.8.3.2</span> 参数<a href="api-ref.html#参数-36" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-36" class="section level4 hasAnchor" number="6.8.3.3">
<h4><span class="header-section-number">6.8.3.3</span> 返回值<a href="api-ref.html#返回值-36" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>由
<a href="api-ref.html#platform_write_persistent_reg"><code>platform_write_persistent_reg</code></a>
写入的值。</p>
</div>
<div id="备注-28" class="section level4 hasAnchor" number="6.8.3.4">
<h4><span class="header-section-number">6.8.3.4</span> 备注<a href="api-ref.html#备注-28" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="示例-19" class="section level4 hasAnchor" number="6.8.3.5">
<h4><span class="header-section-number">6.8.3.5</span> 示例<a href="api-ref.html#示例-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb108"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb108-1"><a href="api-ref.html#cb108-1" aria-hidden="true" tabindex="-1"></a>platform_read_persistent_reg<span class="op">();</span></span></code></pre></div>
</div>
</div>
<div id="platform_reset" class="section level3 hasAnchor" number="6.8.4">
<h3><span class="header-section-number">6.8.4</span> <code>platform_reset</code><a href="api-ref.html#platform_reset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>重置 platform（SoC）。</p>
<div id="函数原型-37" class="section level4 hasAnchor" number="6.8.4.1">
<h4><span class="header-section-number">6.8.4.1</span> 函数原型<a href="api-ref.html#函数原型-37" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb109"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb109-1"><a href="api-ref.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_reset<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-37" class="section level4 hasAnchor" number="6.8.4.2">
<h4><span class="header-section-number">6.8.4.2</span> 参数<a href="api-ref.html#参数-37" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-37" class="section level4 hasAnchor" number="6.8.4.3">
<h4><span class="header-section-number">6.8.4.3</span> 返回值<a href="api-ref.html#返回值-37" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-29" class="section level4 hasAnchor" number="6.8.4.4">
<h4><span class="header-section-number">6.8.4.4</span> 备注<a href="api-ref.html#备注-29" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>调用此函数后，其后的代码将不会被执行。</p>
</div>
<div id="示例-20" class="section level4 hasAnchor" number="6.8.4.5">
<h4><span class="header-section-number">6.8.4.5</span> 示例<a href="api-ref.html#示例-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb110"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb110-1"><a href="api-ref.html#cb110-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>内存不足<span class="op">)</span></span>
<span id="cb110-2"><a href="api-ref.html#cb110-2" aria-hidden="true" tabindex="-1"></a>    platform_reset<span class="op">();</span></span></code></pre></div>
</div>
</div>
<div id="platform_shutdown" class="section level3 hasAnchor" number="6.8.5">
<h3><span class="header-section-number">6.8.5</span> <code>platform_shutdown</code><a href="api-ref.html#platform_shutdown" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>将整个系统置于关机状态，并在指定时间后重新启动。可选地，在关机期间可以保留一部分内存，重启后应用程序可以继续使用这部分内存。</p>
<p>请注意，除非关机过程无法启动，否则此函数不会返回。可能导致失败的原因包括：</p>
<ol style="list-style-type: decimal">
<li>外部唤醒信号被发出；</li>
<li>输入参数不正确；</li>
<li>内部组件繁忙。</li>
</ol>
<div id="函数原型-38" class="section level4 hasAnchor" number="6.8.5.1">
<h4><span class="header-section-number">6.8.5.1</span> 函数原型<a href="api-ref.html#函数原型-38" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb111"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb111-1"><a href="api-ref.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_shutdown<span class="op">(</span><span class="dt">const</span> <span class="dt">uint32_t</span> duration_cycles<span class="op">,</span></span>
<span id="cb111-2"><a href="api-ref.html#cb111-2" aria-hidden="true" tabindex="-1"></a>                       <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>p_retention_data<span class="op">,</span></span>
<span id="cb111-3"><a href="api-ref.html#cb111-3" aria-hidden="true" tabindex="-1"></a>                       <span class="dt">const</span> <span class="dt">uint32_t</span> data_size<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-38" class="section level4 hasAnchor" number="6.8.5.2">
<h4><span class="header-section-number">6.8.5.2</span> 参数<a href="api-ref.html#参数-38" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const uint32_t duration_cycles</code></p>
<p>重新上电（重启）前的等待时间（以实时时钟周期为单位）。最短持续时间为 825 个周期（约25.18毫秒）。如果使用 <code>0</code>，系统将保持在关机状态，直到外部唤醒信号被发出。</p></li>
<li><p><code>const void *p_retention_data</code></p>
<p>指向要保留数据的起始位置的指针。只有 SYSTEM 内存中的数据可以被保留。当 <code>data_size</code> 为 <code>0</code> 时，此参数可以设置为 <code>NULL</code>。</p></li>
<li><p><code>data_size</code></p>
<p>要保留的数据的大小。当不需要保留内存时，设置为 <code>0</code>。</p></li>
</ul>
</div>
<div id="返回值-38" class="section level4 hasAnchor" number="6.8.5.3">
<h4><span class="header-section-number">6.8.5.3</span> 返回值<a href="api-ref.html#返回值-38" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-30" class="section level4 hasAnchor" number="6.8.5.4">
<h4><span class="header-section-number">6.8.5.4</span> 备注<a href="api-ref.html#备注-30" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="示例-21" class="section level4 hasAnchor" number="6.8.5.5">
<h4><span class="header-section-number">6.8.5.5</span> 示例<a href="api-ref.html#示例-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb112"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb112-1"><a href="api-ref.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 关闭系统并在 1 秒后重启</span></span>
<span id="cb112-2"><a href="api-ref.html#cb112-2" aria-hidden="true" tabindex="-1"></a>platform_shutdown<span class="op">(</span><span class="dv">32768</span><span class="op">,</span> NULL<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_write_persistent_reg" class="section level3 hasAnchor" number="6.8.6">
<h3><span class="header-section-number">6.8.6</span> <code>platform_write_persistent_reg</code><a href="api-ref.html#platform_write_persistent_reg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>向持久寄存器写入一个值。该值在省电模式、关机模式或切换到另一个应用程序时仍会保留。</p>
<p>只有少量位被保存，如表 <a href="#tab:ch-api-reg-bits">6.2</a> 所示。</p>
<p>表: (#tab:ch-api-reg-bits) 持久寄存器位大小</p>
<table>
<thead>
<tr class="header">
<th align="center">芯片系列</th>
<th align="right">寄存器大小 (位)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">ING918</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="center">ING916</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<div id="函数原型-39" class="section level4 hasAnchor" number="6.8.6.1">
<h4><span class="header-section-number">6.8.6.1</span> 函数原型<a href="api-ref.html#函数原型-39" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb113"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb113-1"><a href="api-ref.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_write_persistent_reg<span class="op">(</span><span class="dt">const</span> <span class="dt">uint8_t</span> value<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-39" class="section level4 hasAnchor" number="6.8.6.2">
<h4><span class="header-section-number">6.8.6.2</span> 参数<a href="api-ref.html#参数-39" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const uint8_t value</code></p>
<p>要写入的值。</p></li>
</ul>
</div>
<div id="返回值-39" class="section level4 hasAnchor" number="6.8.6.3">
<h4><span class="header-section-number">6.8.6.3</span> 返回值<a href="api-ref.html#返回值-39" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-31" class="section level4 hasAnchor" number="6.8.6.4">
<h4><span class="header-section-number">6.8.6.4</span> 备注<a href="api-ref.html#备注-31" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="示例-22" class="section level4 hasAnchor" number="6.8.6.5">
<h4><span class="header-section-number">6.8.6.5</span> 示例<a href="api-ref.html#示例-22" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb114"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb114-1"><a href="api-ref.html#cb114-1" aria-hidden="true" tabindex="-1"></a>platform_write_persistent_reg<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
</div>
<div id="调试与追踪" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> 调试与追踪<a href="api-ref.html#调试与追踪" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_printf" class="section level3 hasAnchor" number="6.9.1">
<h3><span class="header-section-number">6.9.1</span> <code>platform_printf</code><a href="api-ref.html#platform_printf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>存储在 platform 二进制文件中的 <code>printf</code> 函数。</p>
<div id="原型-1" class="section level4 hasAnchor" number="6.9.1.1">
<h4><span class="header-section-number">6.9.1.1</span> 原型<a href="api-ref.html#原型-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb115"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb115-1"><a href="api-ref.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>  platform_printf<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>format<span class="op">,</span> <span class="op">...);</span></span></code></pre></div>
</div>
<div id="参数-40" class="section level4 hasAnchor" number="6.9.1.2">
<h4><span class="header-section-number">6.9.1.2</span> 参数<a href="api-ref.html#参数-40" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const char *format</code></p>
<p>格式化字符串。</p></li>
<li><p><code>...</code></p>
<p>格式化字符串的可变参数。</p></li>
</ul>
</div>
<div id="返回值-40" class="section level4 hasAnchor" number="6.9.1.3">
<h4><span class="header-section-number">6.9.1.3</span> 返回值<a href="api-ref.html#返回值-40" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-32" class="section level4 hasAnchor" number="6.9.1.4">
<h4><span class="header-section-number">6.9.1.4</span> 备注<a href="api-ref.html#备注-32" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>使用此函数有利有弊。</p>
<p>优点：</p>
<ul>
<li>此函数位于 platform 二进制文件中，可以节省应用程序二进制文件的大小。</li>
</ul>
<p>缺点：</p>
<ul>
<li>输出被定向到 <code>PLATFORM_CB_EVT_PUTC</code> 事件，因此必须定义其回调函数。</li>
</ul>
</div>
<div id="示例-23" class="section level4 hasAnchor" number="6.9.1.5">
<h4><span class="header-section-number">6.9.1.5</span> 示例<a href="api-ref.html#示例-23" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb116"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb116-1"><a href="api-ref.html#cb116-1" aria-hidden="true" tabindex="-1"></a>platform_printf<span class="op">(</span><span class="st">&quot;Hello world&quot;</span><span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_raise_assertion" class="section level3 hasAnchor" number="6.9.2">
<h3><span class="header-section-number">6.9.2</span> <code>platform_raise_assertion</code><a href="api-ref.html#platform_raise_assertion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>触发软件断言。</p>
<div id="函数原型-40" class="section level4 hasAnchor" number="6.9.2.1">
<h4><span class="header-section-number">6.9.2.1</span> 函数原型<a href="api-ref.html#函数原型-40" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb117"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb117-1"><a href="api-ref.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>  platform_raise_assertion<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>file_name<span class="op">,</span> <span class="dt">int</span> line_no<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-41" class="section level4 hasAnchor" number="6.9.2.2">
<h4><span class="header-section-number">6.9.2.2</span> 参数<a href="api-ref.html#参数-41" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const char *file_name</code></p>
<p>断言发生的文件名。</p></li>
<li><p><code>int line_no</code></p>
<p>断言发生的行号。</p></li>
</ul>
</div>
<div id="返回值-41" class="section level4 hasAnchor" number="6.9.2.3">
<h4><span class="header-section-number">6.9.2.3</span> 返回值<a href="api-ref.html#返回值-41" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-33" class="section level4 hasAnchor" number="6.9.2.4">
<h4><span class="header-section-number">6.9.2.4</span> 备注<a href="api-ref.html#备注-33" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="示例-24" class="section level4 hasAnchor" number="6.9.2.5">
<h4><span class="header-section-number">6.9.2.5</span> 示例<a href="api-ref.html#示例-24" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb118"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb118-1"><a href="api-ref.html#cb118-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>NULL <span class="op">==</span> ptr<span class="op">)</span></span>
<span id="cb118-2"><a href="api-ref.html#cb118-2" aria-hidden="true" tabindex="-1"></a>    platform_raise_assertion<span class="op">(</span>__FILE__<span class="op">,</span> __LINE__<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="platform_trace_raw" class="section level3 hasAnchor" number="6.9.3">
<h3><span class="header-section-number">6.9.3</span> <code>platform_trace_raw</code><a href="api-ref.html#platform_trace_raw" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>将一块原始数据输出到 TRACE。ID为 <code>PLATFORM_TRACE_ID_RAW</code>。</p>
<div id="函数原型-41" class="section level4 hasAnchor" number="6.9.3.1">
<h4><span class="header-section-number">6.9.3.1</span> 函数原型<a href="api-ref.html#函数原型-41" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb119"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb119-1"><a href="api-ref.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> platform_trace_raw<span class="op">(</span></span>
<span id="cb119-2"><a href="api-ref.html#cb119-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>buffer<span class="op">,</span></span>
<span id="cb119-3"><a href="api-ref.html#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> byte_len<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-42" class="section level4 hasAnchor" number="6.9.3.2">
<h4><span class="header-section-number">6.9.3.2</span> 参数<a href="api-ref.html#参数-42" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const void *buffer</code></p>
<p>缓冲区的指针。</p></li>
<li><p><code>const int byte_len</code></p>
<p>数据缓冲区的长度，以字节为单位。</p></li>
</ul>
</div>
</div>
</div>
<div id="其他" class="section level2 hasAnchor" number="6.10">
<h2><span class="header-section-number">6.10</span> 其他<a href="api-ref.html#其他" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="platform_get_link_layer_interf" class="section level3 hasAnchor" number="6.10.1">
<h3><span class="header-section-number">6.10.1</span> <code>platform_get_link_layer_interf</code><a href="api-ref.html#platform_get_link_layer_interf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>获取链路层驱动 API。</p>
<div id="函数原型-42" class="section level4 hasAnchor" number="6.10.1.1">
<h4><span class="header-section-number">6.10.1.1</span> 函数原型<a href="api-ref.html#函数原型-42" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb120"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb120-1"><a href="api-ref.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> platform_hci_link_layer_interf_t <span class="op">*</span></span>
<span id="cb120-2"><a href="api-ref.html#cb120-2" aria-hidden="true" tabindex="-1"></a>    platform_get_link_layer_interf<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-43" class="section level4 hasAnchor" number="6.10.1.2">
<h4><span class="header-section-number">6.10.1.2</span> 参数<a href="api-ref.html#参数-43" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="返回值-42" class="section level4 hasAnchor" number="6.10.1.3">
<h4><span class="header-section-number">6.10.1.3</span> 返回值<a href="api-ref.html#返回值-42" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>返回驱动接口 <code>platform_hci_link_layer_interf_t *</code>。</p>
</div>
<div id="备注-34" class="section level4 hasAnchor" number="6.10.1.4">
<h4><span class="header-section-number">6.10.1.4</span> 备注<a href="api-ref.html#备注-34" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>此API暴露了控制器HCI接口。该驱动接口仅在定义了 <code>PLATFORM_CB_EVT_HCI_RECV</code> 时可用，此时内置的主机功能将被禁用。</p>
</div>
</div>
<div id="syssetpublicdeviceaddr" class="section level3 hasAnchor" number="6.10.2">
<h3><span class="header-section-number">6.10.2</span> <code>sysSetPublicDeviceAddr</code><a href="api-ref.html#syssetpublicdeviceaddr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>设置设备的公共地址。</p>
<p>BLE设备的公共地址是一个48位的扩展唯一标识符（EUI-48），按照IEEE 802-2014标准创建<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a>。</p>

<div class="rmdcaution">
<em>INGCHIPS</em> 91x <strong>没有</strong>公共地址。此函数应<strong>仅</strong>用于调试或测试，<strong>切勿</strong>在最终产品中使用。
</div>
<div id="函数原型-43" class="section level4 hasAnchor" number="6.10.2.1">
<h4><span class="header-section-number">6.10.2.1</span> 函数原型<a href="api-ref.html#函数原型-43" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb121"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb121-1"><a href="api-ref.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sysSetPublicDeviceAddr<span class="op">(</span><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>addr<span class="op">);</span></span></code></pre></div>
</div>
<div id="参数-44" class="section level4 hasAnchor" number="6.10.2.2">
<h4><span class="header-section-number">6.10.2.2</span> 参数<a href="api-ref.html#参数-44" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>const unsigned char *addr</code></p>
<p>新的公共地址。</p></li>
</ul>
</div>
<div id="返回值-43" class="section level4 hasAnchor" number="6.10.2.3">
<h4><span class="header-section-number">6.10.2.3</span> 返回值<a href="api-ref.html#返回值-43" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>无。</p>
</div>
<div id="备注-35" class="section level4 hasAnchor" number="6.10.2.4">
<h4><span class="header-section-number">6.10.2.4</span> 备注<a href="api-ref.html#备注-35" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>为了避免潜在问题，应在调用任何 GAP 函数之前调用此函数。
建议在 <code>app_main</code> 或 <code>PLATFORM_CB_EVT_PROFILE_INIT</code> 事件回调函数中调用此函数。</p>
</div>
<div id="示例-25" class="section level4 hasAnchor" number="6.10.2.5">
<h4><span class="header-section-number">6.10.2.5</span> 示例<a href="api-ref.html#示例-25" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb122"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb122-1"><a href="api-ref.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> pub_addr<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">6</span><span class="op">};</span></span>
<span id="cb122-2"><a href="api-ref.html#cb122-2" aria-hidden="true" tabindex="-1"></a>sysSetPublicDeviceAddr<span class="op">(</span>pub_addr<span class="op">);</span></span></code></pre></div>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="23">
<li id="fn23"><p><a href="https://ingchips.github.io/application-notes/pg_ble_stack_cn/index.html" class="uri">https://ingchips.github.io/application-notes/pg_ble_stack_cn/index.html</a><a href="api-ref.html#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p><a href="https://ingchips.github.io/application-notes/pg_power_saving_en/" class="uri">https://ingchips.github.io/application-notes/pg_power_saving_en/</a><a href="api-ref.html#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p><a href="https://ingchips.github.io/application-notes/pg_power_saving_en/" class="uri">https://ingchips.github.io/application-notes/pg_power_saving_en/</a><a href="api-ref.html#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p><a href="https://ingchips.github.io/application-notes/pg_power_saving_en/ch-api.html#the-real-time-clock" class="uri">https://ingchips.github.io/application-notes/pg_power_saving_en/ch-api.html#the-real-time-clock</a><a href="api-ref.html#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p>从v8.4.6版本开始。对于更早的版本，使用的是32768Hz。<a href="api-ref.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p><a href="https://ingchips.github.io/application-notes/pg_power_saving_en/" class="uri">https://ingchips.github.io/application-notes/pg_power_saving_en/</a><a href="api-ref.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p><a href="http://standards.ieee.org/findstds/standard/802-2014.html" class="uri">http://standards.ieee.org/findstds/standard/802-2014.html</a><a href="api-ref.html#fnref29" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dive-into-sdk.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="revision-history.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["user_guide.pdf", "user_guide.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
