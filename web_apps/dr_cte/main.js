function inspect_cte(e,t,r){function n(e){var t="";try{t=window.atob(e)}catch{}for(var r=[],n=0;n<t.length;++n)r.push(t.charCodeAt(n));return r}function a(e){const t=Enumerable.from([-2*Math.PI,0,2*Math.PI]);e[0][1]=e[0][1].arg(),e[0][2]=e[0][1];for(var r=0,n=1;n<e.length;n++){var a=e[n][1].arg(),l=t.select(e=>a+r+e).minBy(t=>Math.abs(t-e[n-1][1]));e[n][1]=l,e[n][2]=a,r=l-a}}function l(e){return function(t){return t<=7?e[0]:e[math.mod(t-7,e.length)]}}function s(e){const t=Enumerable.from(e).select(e=>e[0]),r=Enumerable.from(e).select(e=>e[1]),n=t.average(),a=r.average(),l=t.select(e=>e-n).zip(r.select(e=>e-a),(e,t)=>e*t).sum()/t.select(e=>(e-n)*(e-n)).sum(),s=a-l*n;return e=>s+l*e}function o(e,t){let r=1==e.slot_durations?function(e){return e<=7?e:7+2*(e-7)}:function(e){return e<=7?e:7+4*(e-7)};var n=[];!function(e,t){const r=Enumerable.from(e.samples.slice(0,8));let n=r.aggregate(math.complex(0),(e,t)=>e.add(t)).div(r.count());for(var a=0;a<e.samples.length;a++)e.samples[a]=e.samples[a].sub(n)}(e),function(e,t){let r=l(t);for(var n=[],a=0;a<t.length;a++){let l=t[a];const s=Enumerable.from(e.samples).where((e,t)=>r(t)==l).select(e=>Math.pow(e.abs(),2)).average();n[l]=Math.sqrt(8e3/s)}for(a=0;a<e.samples.length;a++)e.samples[a]=e.samples[a].mul(n[r(a)])}(e,t);for(var o=0;o<8;o++)n.push([o,e.samples[o]]);a(n);var u=s(n);for(o=0;o<e.samples.length;o++)e.samples[o]=e.samples[o].mul(math.complex({r:1,phi:-u(r(o))}));console.log(e.samples),n=[];for(o=0;o<e.samples.length;o++){t[o>=8?(o-8+1)%t.length:0]==t[0]&&n.push([r(o),e.samples[o]])}console.log(n),a(n),u=s(n);for(o=0;o<e.samples.length;o++)e.samples[o]=e.samples[o].mul(math.complex({r:1,phi:-u(r(o))}))}var u=[];function c(e,t,r){return{x:e.select(e=>e.re).toArray(),y:e.select(e=>e.im).toArray(),mode:"markers",type:"scatter",name:r,marker:{color:t},text:e.select((e,t)=>"#"+t).toArray()}}var m={};function i(e,t){let a=0==r?function(e){let t=[{t:"u16",n:"sync_handle"},{t:"u8",n:"rx_phy"},{t:"u8",n:"channel_index"},{t:"s16",n:"rssi"},{t:"u8",n:"rssi_ant_id"},{t:"u8",n:"cte_type"},{t:"u8",n:"slot_durations"},{t:"u8",n:"packet_status"},{t:"u16",n:"event_counter"},{t:"u8",n:"sample_count"},{t:"struct",n:"samples",len:"sample_count",fields:[{t:"s8",n:"re"},{t:"s8",n:"im"}]}];var r=null;try{var a=n(e);if(a.length<1)return null;r=parseSchema(t,a);var l=[];for(var s of r.samples)l.push(math.complex(s));r.samples=l}catch{}return r}(t):function(e){let t=[{t:"u16",n:"sync_handle"},{t:"u8",n:"channel_index"},{t:"s16",n:"rssi"},{t:"u8",n:"rssi_ant_id"},{t:"u8",n:"cte_type"},{t:"u8",n:"slot_durations"},{t:"u8",n:"packet_status"},{t:"u16",n:"event_counter"},{t:"u8",n:"sample_count"},{t:"struct",n:"samples",len:"sample_count",fields:[{t:"s8",n:"re"},{t:"s8",n:"im"}]}];var r=null;try{var a=n(e);if(a.length<1)return null;r=parseSchema(t,a);var l=[];for(var s of r.samples)l.push(math.complex(s));r.samples=l}catch{}return r}(t);if(null!=a){const e=u[0];!function(e,t,r,n){const a=["#D50000","#AA00FF","#304FFE","#00B8D4","#00C853","#AEEA00","#FFD600","#DD2C00"];let s=l(n),o=new Set(n);var u=[];{const e=Enumerable.from(r).where((e,t)=>t<=7),t=e.select(e=>e.re).toArray(),n=e.select(e=>e.im).toArray(),a=e.select((e,t)=>"#"+t).toArray();u.push({x:t,y:n,mode:"markers",type:"scatter",name:"ref",marker:{color:"gray"},text:a})}for(var c of o){const e=Enumerable.from(r).where((e,t)=>t>=8&&s(t)==c),t=Enumerable.from(r).select((e,t)=>"#"+t).where((e,t)=>t>=8&&s(t)==c).toArray(),n=e.select(e=>e.re).toArray(),l=e.select(e=>e.im).toArray();u.push({x:n,y:l,mode:"markers",type:"scatter",name:""+c,marker:{color:a[c]},text:t})}var m={xaxis:{range:[-127,127]},yaxis:{range:[-127,127]},title:t};Plotly.newPlot(e,u,m)}("plot_raw","Raw",a.samples,u);let t=[];o(a,u);const r=function(e,t){let r=l(t);const n=function(e){var t=[];for(var r of e)t.indexOf(r)>=0||t.push(r);return t}(t);var a={};for(var s of n)a[s]=Enumerable.from(e).where((e,t)=>r(t)==s).toArray();return a}(a.samples,u);let n=function(e){var t={};for(var r in e){var n=Enumerable.from(e[r]),a=n.aggregate(math.complex(0),(e,t)=>e.add(t)).div(n.count());const l=n.select(e=>Math.pow(e.sub(a).abs(),2)).average();t[r]=10*Math.log10(Math.pow(a.abs(),2)/l)}return t}(r);if(console.log(n),u.length>3)for(var s of t)delete r[s];!function(e,t,r,n){const a=["#D50000","#AA00FF","#304FFE","#00B8D4","#00C853","#AEEA00","#FFD600","#DD2C00"];var l=[];{const e=r[n];l.push(c(Enumerable.from(e).where((e,t)=>t<=7),"gray","ref")),l.push(c(Enumerable.from(e).where((e,t)=>t>7),a[n],n))}for(var s in r)s!=n&&l.push(c(Enumerable.from(r[s]),a[s],s));var o={xaxis:{range:[-127,127]},yaxis:{range:[-127,127]},title:t};Plotly.newPlot(e,l,o)}("plot_dem","Preprocess",r,e),function(e,t){$("#output_c").val(""),$("#output_matlab").val(""),$("#output_mma").val(""),$("#output_py").val(""),function(e,t,r){function n(e){return Enumerable.from(e).select(e=>e.re.toFixed(5)+p(e.im)+"j").toArray().join(", ")}h(e,"samples[ref] =");let a=n(t[r].slice(0,8));h(e,"["+f(a," ...")+"]\n");for(let a in t){h(e,"samples[{0}] =".format(a));let l=n(a!=r?t[a]:t[a].slice(8));h(e,"["+f(l," ...")+"]\n")}}("#output_matlab",e,t),function(e,t,r){function n(e){return Enumerable.from(e).select(e=>e.re.toFixed(5)+p(e.im)+"I").toArray().join(", ")}h(e,"samples[ref] =");let a=n(t[r].slice(0,8));h(e,"{"+f(a,"")+"}\n");for(let a in t){h(e,"samples[{0}] =".format(a));let l=n(a!=r?t[a]:t[a].slice(8));h(e,"{"+f(l,"")+"}\n")}}("#output_mma",e,t),function(e,t,r){function n(e){return Enumerable.from(e).select(e=>e.re.toFixed(5)+p(e.im)+"j").toArray().join(", ")}h(e,"samples[ref] =");let a=n(t[r].slice(0,8));h(e,"["+f(a," \\")+"]\n");for(let a in t){h(e,"samples[{0}] =".format(a));let l=n(a!=r?t[a]:t[a].slice(8));h(e,"["+f(l," \\")+"]\n")}}("#output_py",e,t),function(e,t,r){function n(e){return Enumerable.from(e).select(e=>"{"+e.re.toFixed(5)+","+p(e.im)+"}").toArray().join(", ")}h(e,"samples[ref] =");let a=n(t[r].slice(0,8));h(e,"{"+f(a,"","},")+"}\n");for(let a in t){h(e,"samples[{0}] =".format(a));let l=n(a!=r?t[a]:t[a].slice(8));h(e,"{"+f(l,"","},")+"}\n")}}("#output_c",e,t)}(r,e)}}function f(e,t,r){var n="",a=e;let l=void 0===r?",":r;for(;a.length>0;){let e=a.indexOf(l,80);e<0&&(e=a.length),n=n+t+"\n"+a.slice(0,e+l.length),a=a.slice(e+l.length)}return n.slice(t.length+1)}function p(e){return e>0?" + "+e.toFixed(5):" - "+(-e).toFixed(5)}function h(e,t){let r=$(e);r.val(r.val()+"\n"+t)}String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(t,r){return e[r]})},u=function(e){var t=[];for(var r of e.split(",")){let e=parseInt(r);isNaN(e)||t.push(e)}return t}(e),function(e,t){for(var r=(t=m[e]+t).split(/\r|\n/),n=0;n<r.length-1;n++)i(0,r[n]);m[e]=r[r.length-1]}(0,"\n"+t+"\n")}