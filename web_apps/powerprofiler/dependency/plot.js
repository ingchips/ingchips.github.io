var CONN_SLAVE_INDEX_WINWID=5,CONN_SLAVE_INDEX_RXRXRX=6,CONN_SLAVE_INDEX_TXTXTX=8,CONN_SLAVE_INDEX_FLOORR=13;const CURRENT_ADV_CONNECTABLE_TYPE=[{x:0,y:2.213,z:96.16,name:"Pre-processing"},{x:96.16,y:6.623,z:68.79,name:"RF preparation"},{x:164.95,y:2.57,z:402.8,name:"System processing"},{x:567.75,y:5.74,z:469.8,name:"RF preparation"},{x:1137.55,y:10.26,z:128,name:"TX"},{x:1292.55,y:5.832,z:150,name:"Radio Switch"},{x:1402.55,y:9.59,z:95.7,name:"RX"},{x:1511.25,y:6.015,z:163,name:"Standby"},{x:1674.25,y:10.26,z:128,name:"TX"},{x:1829.25,y:5.969,z:150.1,name:"Radio Switch"},{x:1942.35,y:9.544,z:97.2,name:"RX"},{x:2049.55,y:6.015,z:168.9,name:"Standby"},{x:2218.45,y:10.26,z:128,name:"TX"},{x:2373.45,y:5.832,z:150.6,name:"Radio Switch"},{x:2485.05,y:9.59,z:98.1,name:"RX"},{x:2595.15,y:3.769,z:690.6,name:"Post-processing"},{x:7181.25,y:.006237,z:0,name:"Floor"},{x:100,y:0,z:0,name:"End"}],CURRENT_ADV_CONNECTABLE_TYPE_INDEX_TX_0=4,CURRENT_ADV_CONNECTABLE_TYPE_INDEX_TX_1=8,CURRENT_ADV_CONNECTABLE_TYPE_INDEX_TX_2=12,CURRENT_ADV_CONNECTABLE_TYPE_INDEX_RX_0=6,CURRENT_ADV_CONNECTABLE_TYPE_INDEX_RX_1=10,CURRENT_ADV_CONNECTABLE_TYPE_INDEX_RX_2=14,CURRENT_ADV_CONNECTABLE_TYPE_INDEX_FLOO=16,CURRENT_ADV_NON_CONNECTABLE_TYPE=[{x:100,y:2.213,z:96.16,name:"Pre-processing"},{x:96.16,y:6.623,z:68.79,name:"RF preparation"},{x:164.95,y:2.57,z:402.8,name:"System processing"},{x:567.75,y:5.74,z:461.5,name:"RF preparation"},{x:1029.25,y:9.925,z:128,name:"TX"},{x:1184.25,y:5.196,z:402.2,name:"Standby"},{x:1559.45,y:9.925,z:128,name:"TX"},{x:1714.45,y:5.196,z:402.2,name:"Standby"},{x:2089.65,y:9.993,z:128,name:"TX"},{x:2244.65,y:3.894,z:688.8,name:"Post-processing"},{x:3e3,y:.006237,z:0,name:"Floor"},{x:100,y:0,z:0,name:"End"}],CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_TX_0=4,CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_TX_1=6,CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_TX_2=8,CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_FLOO=10,CURRENT_CONNECTION_PERIPHERAL_TYPE=[{x:0,y:2.213,z:96.16,name:"Pre-processing"},{x:96.16,y:6.623,z:68.79,name:"RF preparation"},{x:164.95,y:2.57,z:402.8,name:"System processing"},{x:567.75,y:5.74,z:461.5,name:"RF preparation"},{x:2485.05,y:9.59,z:0,name:"Window widening"},{x:2485.05,y:9.59,z:86,name:"RX"},{x:1829.25,y:5.524,z:150,name:"Radio Switch"},{x:1029.25,y:9.925,z:80,name:"TX"},{x:2244.65,y:3.894,z:658.8,name:"Post-processing"},{x:6801.95,y:.006237,z:0,name:"Floor"},{x:100,y:0,z:0,name:"End"}],CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_WINW=4,CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_RX_0=5,CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_TX_0=7,CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_FLOO=9,CURRENT_CONNECTION_CENTRAL_TYPE=[{x:0,y:2.213,z:96.16,name:"Pre-processing"},{x:96.16,y:6.623,z:68.79,name:"RF preparation"},{x:164.95,y:2.57,z:402.8,name:"System processing"},{x:567.75,y:5.74,z:461.5,name:"RF preparation"},{x:1029.25,y:9.925,z:80,name:"TX"},{x:1829.25,y:5.524,z:150,name:"Radio Switch"},{x:2485.05,y:9.59,z:86,name:"RX"},{x:2244.65,y:3.894,z:655.8,name:"Post-processing"},{x:6801.95,y:.006237,z:0,name:"Floor"},{x:100,y:0,z:0,name:"End"}],CURRENT_CONNECTION_CENTRAL_TYPE_INDEX_TX_0=4,CURRENT_CONNECTION_CENTRAL_TYPE_INDEX_RX_0=6,CURRENT_CONNECTION_CENTRAL_TYPE_INDEX_FLOO=8,PLOT_VER_1_MAXIMUM_OFFSET=1500,PLOT_VER_1_STEP=100,empty_data=[],empty_cate=[];function myFunction(){document.write("can not call document.write in onclick event")}function rearrange_x_time(e){var t;for(e[0].x=0,t=1;t<e.length;t++)e[t].x=e[t-1].x+e[t-1].z;return e[e.length-1].x+e[e.length-1].z}function cal_aver_curr(e){var t,n=0,a=0;for(t=0;t<e.length;t++){var _=e[t].y,l=e[t].z;n+=l*_,a+=l}return n/a}function cal_active_length(e){var t,n=0;for(t=0;t<e.length&&"Floor"!=e[t].name;t++){n+=e[t].z}return n}function plot(e){Highcharts.chart("container",{chart:{type:"variwide",zoomType:"xy",panning:!0,panKey:"shift",inverted:!1},title:{text:""},subtitle:{text:""},xAxis:{type:"linear",title:{text:"Time"},labels:{formatter:function(){return this.value+"µs"}},lineWidth:1},yAxis:{title:{text:"Current"},labels:{formatter:function(){return this.value+"mA"}},lineWidth:1},legend:{enabled:!1},credits:{enabled:!1},series:[{name:"current consumption",data:e,dataLabels:{enabled:!0,format:"{point.y:.2f}mA"},tooltip:{pointFormat:"current： <b>{point.x}/mA</b><br>time: <b>{point.y}/us</b><br>"},colorByPoint:!0}]})}function roundFix(e,t){var n=Math.pow(10,t);return Math.round((e*n).toFixed(t+1))/n}var global_idle_current_ua=0,global_aver_current_ua=0,global_rc_calibrati_ua=0;function doSubmitForm(){var e=document.getElementById("form-stacked-select_state").value,t=document.getElementById("interval").value,n=document.getElementById("RXlength").value,a=document.getElementById("TXlength").value,_=document.getElementById("Latency").value,l=document.getElementById("SSCA").value,r=document.getElementById("MSCA").value,o=NaN,c=NaN,i=NaN,d=NaN,m=0;{let y=empty_data,E=8*(parseInt(a)-0),u=8*(parseInt(n)-0),s=0,N=0;switch(parseInt(e)){case 1:(y=JSON.parse(JSON.stringify(CURRENT_ADV_NON_CONNECTABLE_TYPE)))[CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_TX_0].z+=E,y[CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_TX_1].z+=E,y[CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_TX_2].z+=E,y[CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_FLOO].z+=1e3*parseInt(t),s=rearrange_x_time(y),N=cal_active_length(y),d=1e3*cal_aver_curr(y),i=1e3*y[CURRENT_ADV_NON_CONNECTABLE_TYPE_INDEX_FLOO].y,c=cal_active_length(y),o=1e3*parseInt(t),m=0,global_idle_current_ua=i,global_aver_current_ua=d;break;case 2:(y=JSON.parse(JSON.stringify(CURRENT_ADV_CONNECTABLE_TYPE)))[CURRENT_ADV_CONNECTABLE_TYPE_INDEX_TX_0].z+=E,y[CURRENT_ADV_CONNECTABLE_TYPE_INDEX_RX_0].z+=u,y[CURRENT_ADV_CONNECTABLE_TYPE_INDEX_TX_1].z+=E,y[CURRENT_ADV_CONNECTABLE_TYPE_INDEX_RX_1].z+=u,y[CURRENT_ADV_CONNECTABLE_TYPE_INDEX_TX_2].z+=E,y[CURRENT_ADV_CONNECTABLE_TYPE_INDEX_RX_2].z+=u,y[CURRENT_ADV_CONNECTABLE_TYPE_INDEX_FLOO].z=1e3*parseInt(t),s=rearrange_x_time(y),N=cal_active_length(y),d=1e3*cal_aver_curr(y),i=1e3*y[CURRENT_ADV_CONNECTABLE_TYPE_INDEX_FLOO].y,c=cal_active_length(y),o=1e3*parseInt(t),m=0,global_idle_current_ua=i,global_aver_current_ua=d;break;case 3:y=JSON.parse(JSON.stringify(CURRENT_CONNECTION_CENTRAL_TYPE));let n=1e3*parseInt(t);y[CURRENT_CONNECTION_CENTRAL_TYPE_INDEX_RX_0].z+=u,y[CURRENT_CONNECTION_CENTRAL_TYPE_INDEX_TX_0].z+=E,y[CURRENT_CONNECTION_CENTRAL_TYPE_INDEX_FLOO].z=n,s=rearrange_x_time(y),N=cal_active_length(y),d=1e3*cal_aver_curr(y),i=1e3*y[CURRENT_CONNECTION_CENTRAL_TYPE_INDEX_FLOO].y,c=cal_active_length(y),o=n,m=0,global_idle_current_ua=i,global_aver_current_ua=d;break;case 4:y=JSON.parse(JSON.stringify(CURRENT_CONNECTION_PERIPHERAL_TYPE));let a=1e3*parseInt(t);0!=parseInt(_)&&(a=1e3*(parseInt(t)+parseInt(t)*parseInt(_))),y[CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_WINW].z+=(parseInt(l)+parseInt(r))/1e6*a+32,y[CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_RX_0].z+=u,y[CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_TX_0].z+=E,y[CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_FLOO].z=parseInt(a),s=rearrange_x_time(y),N=cal_active_length(y),d=1e3*cal_aver_curr(y),i=1e3*y[CURRENT_CONNECTION_PERIPHERAL_TYPE_INDEX_FLOO].y,c=cal_active_length(y),o=parseInt(a),m=0,global_idle_current_ua=i,global_aver_current_ua=d;break;default:m=10}switch(plot_ver_1(y,s,N),m){case 0:document.getElementById("out_chip_id").innerHTML=document.getElementById("form-stacked-select_chip_id").innerHTML,document.getElementById("out_voltage").innerHTML=document.getElementById("form-stacked-select_voltage").innerHTML,document.getElementById("out_phy").innerHTML=document.getElementById("form-stacked-select_phy").innerHTML,document.getElementById("out_interval").innerHTML=roundFix(o,3)+" µs",document.getElementById("out_Length").innerHTML=roundFix(c,3)+" µs",document.getElementById("average_current").innerHTML=roundFix(d,4)+" µA",document.getElementById("idle_current").innerHTML=roundFix(i,4)+" µA",document.getElementById("out_num_packet").innerHTML=1,document.getElementById("out_msca").innerHTML=roundFix(r,3)+" ppm",document.getElementById("out_ssca").innerHTML=roundFix(l,3)+" ppm",document.getElementById("out_pdu_min").innerHTML="27 Bytes",document.getElementById("out_rx_payl_len").innerHTML=roundFix(n,3)+" Bytes",document.getElementById("out_tx_payl_len").innerHTML=roundFix(a,3)+" Bytes",document.getElementById("warning").style.display="none";break;case 10:document.getElementById("out_chip_id").innerHTML=NaN,document.getElementById("out_voltage").innerHTML=NaN,document.getElementById("out_phy").innerHTML=NaN,document.getElementById("out_interval").innerHTML=NaN,document.getElementById("out_Length").innerHTML=NaN,document.getElementById("average_current").innerHTML=NaN,document.getElementById("idle_current").innerHTML=NaN,document.getElementById("out_num_packet").innerHTML=NaN,document.getElementById("out_msca").innerHTML=NaN,document.getElementById("out_ssca").innerHTML=NaN,document.getElementById("out_pdu_min").innerHTML=NaN,document.getElementById("out_rx_payl_len").innerHTML=NaN,document.getElementById("out_tx_payl_len").innerHTML=NaN,document.getElementById("warning").style.display="",document.getElementById("warning").innerHTML="Selected role does not have power data yet !"}battery_run_time_cal_part3(),internal_rc_current_control(y),delete y,delete cate}return!1}function label_visibility_part1(e){document.getElementById("TXlength").style.display=e,document.getElementById("TXlength_label").style.display=e,document.getElementById("RXlength").style.display=e,document.getElementById("RXlength_label").style.display=e,document.getElementById("Latency").style.display=e,document.getElementById("Latency_label").style.display=e,document.getElementById("MSCA").style.display=e,document.getElementById("MSCA_label").style.display=e,document.getElementById("SSCA").style.display=e,document.getElementById("SSCA_label").style.display=e,document.getElementById("out_num_packet").style.display=e,document.getElementById("out_num_packet_label").style.display=e,document.getElementById("out_msca").style.display=e,document.getElementById("out_msca_label").style.display=e,document.getElementById("out_ssca").style.display=e,document.getElementById("out_ssca_label").style.display=e,document.getElementById("out_pdu_min").style.display=e,document.getElementById("out_pdu_min_label").style.display=e,document.getElementById("out_rx_payl_len").style.display=e,document.getElementById("out_rx_payl_len_label").style.display=e,document.getElementById("out_tx_payl_len").style.display=e,document.getElementById("out_tx_payl_len_label").style.display=e}function label_visibility_non_conn(){label_visibility_part1("none"),document.getElementById("TXlength").style.display="",document.getElementById("TXlength_label").style.display=""}function label_visibility_conn(){label_visibility_part1("none"),document.getElementById("TXlength").style.display="",document.getElementById("TXlength_label").style.display="",document.getElementById("RXlength").style.display="",document.getElementById("RXlength_label").style.display=""}function label_visibility_cent(){label_visibility_part1(""),document.getElementById("MSCA").style.display="none",document.getElementById("MSCA_label").style.display="none",document.getElementById("SSCA").style.display="none",document.getElementById("SSCA_label").style.display="none",document.getElementById("MSCA").value=500,document.getElementById("SSCA").value=20}function label_visibility_peri(){label_visibility_part1(""),document.getElementById("SSCA").value=500,document.getElementById("MSCA").value=20}function label_control_visibility(){var e=document.getElementById("form-stacked-select_state").value;switch(parseInt(e)){case 1:label_visibility_non_conn();break;case 2:label_visibility_conn();break;case 3:label_visibility_cent();break;case 4:label_visibility_peri();break;default:document.getElementById("warning").innerHTML="pls check the input 'State' !"}}function battery_run_time_cal_part1(){var e=document.getElementById("form-stacked-select_battery").value,t=NaN,n=NaN,a=NaN;switch(parseInt(e)){case 1:document.getElementById("capacity_value").readOnly=!1,document.getElementById("capacity_value").value=0,document.getElementById("out_battery_time").innerHTML="";break;case 2:document.getElementById("capacity_value").readOnly=!0,document.getElementById("capacity_value").value=210,t=document.getElementById("capacity_value").value,n=document.getElementById("average_current").value,a=parseInt(t)/(parseFloat(n)/1e3),document.getElementById("out_battery_time").innerHTML=roundFix(a,3)+" Hours";break;case 3:document.getElementById("capacity_value").readOnly=!0,document.getElementById("capacity_value").value=1830,t=document.getElementById("capacity_value").value,n=document.getElementById("average_current").value,a=parseInt(t)/(parseFloat(n)/1e3),document.getElementById("out_battery_time").innerHTML=roundFix(a,3)+" Hours";break;case 4:document.getElementById("capacity_value").readOnly=!0,document.getElementById("capacity_value").value=2020,t=document.getElementById("capacity_value").value,n=document.getElementById("average_current").value,a=parseInt(t)/(parseFloat(n)/1e3),document.getElementById("out_battery_time").innerHTML=roundFix(a,3)+" Hours";break;case 5:document.getElementById("capacity_value").readOnly=!0,document.getElementById("capacity_value").value=900,t=document.getElementById("capacity_value").value,n=document.getElementById("average_current").value,a=parseInt(t)/(parseFloat(n)/1e3),document.getElementById("out_battery_time").innerHTML=roundFix(a,3)+" Hours"}console.log("part1")}function battery_run_time_cal_part2(){var e=document.getElementById("form-stacked-select_battery").value,t=NaN,n=NaN,a=NaN;switch(parseInt(e)){case 1:t=document.getElementById("capacity_value").value,n=document.getElementById("average_current").value,a=parseInt(t)/(parseFloat(n)/1e3),document.getElementById("out_battery_time").innerHTML=roundFix(a,3)+" Hours"}console.log("part2")}function battery_run_time_cal_part3(){var e=document.getElementById("form-stacked-select_battery").value,t=NaN,n=NaN,a=NaN;switch(parseInt(e)){case 1:t=document.getElementById("capacity_value").value,0!=parseInt(t)&&(n=document.getElementById("average_current").value,a=parseInt(t)/(parseFloat(n)/1e3),document.getElementById("out_battery_time").innerHTML=roundFix(a,3)+" Hours");break;default:t=document.getElementById("capacity_value").value,n=document.getElementById("average_current").value,a=parseInt(t)/(parseFloat(n)/1e3),document.getElementById("out_battery_time").innerHTML=roundFix(a,3)+" Hours"}}function get_current_per_name(e,t){var n,a=NaN;for(n=0;n<e.length;n++)t==e[n].name&&(a=e[n].y);return a}function internal_rc_current_control(e){var t=document.getElementById("form-stacked-select_clock_source").value,n=document.getElementById("internal_rc_cal_interval").value,a=NaN,_=NaN,l=NaN;switch(parseInt(t)){case 1:document.getElementById("internal_rc_cal_interval").style.display="",document.getElementById("internal_rc_cal_interval_label").style.display="",document.getElementById("clock_cal_current").style.display="",document.getElementById("clock_cal_current_label").style.display="",document.getElementById("out_clk_source").style.display="",document.getElementById("out_clk_source_label").style.display="",a=get_current_per_name(e,"System processing"),_=31.25*parseInt(a)/(60*parseInt(n)*60*1e3),global_rc_calibrati_ua=l=1e3*_,document.getElementById("clock_cal_current").innerHTML=roundFix(l,4)+" µA",document.getElementById("out_clk_source").innerHTML=document.getElementById("form-stacked-select_clock_source").innerHTML,document.getElementById("average_current").innerHTML=roundFix(global_aver_current_ua+global_rc_calibrati_ua,4)+" µA";break;default:document.getElementById("internal_rc_cal_interval").style.display="none",document.getElementById("internal_rc_cal_interval_label").style.display="none",document.getElementById("clock_cal_current").style.display="none",document.getElementById("clock_cal_current_label").style.display="none"}}label_control_visibility(),doSubmitForm();const test_non_conn_data=[{x:0,y:2.81,z:2400,name:"stage1"},{x:2400,y:3.3,z:2300,name:"stage2"},{x:4700,y:5.5,z:300,name:"stage3"},{x:5e3,y:7.37,z:100,name:"stage4"},{x:5100,y:10.2,z:200,name:"TX"},{x:5300,y:4.74,z:1300,name:"standby"},{x:6600,y:7.37,z:100,name:"stage4"},{x:6700,y:10.2,z:200,name:"TX"},{x:6900,y:4.74,z:1300,name:"standby"},{x:8200,y:7.37,z:100,name:"stage4"},{x:8300,y:10.2,z:200,name:"TX"},{x:8500,y:4.74,z:1300,name:"standby"},{x:9800,y:.2,z:10,name:"floor"}];var test_data=[{x:Date.UTC(2018,8,21,8,50),y:207e3,z:3e5},{x:Date.UTC(2018,8,21,8,55),y:195e3,z:6e5,color:"rgba(0, 255, 0, 0.2)"},{x:Date.UTC(2018,8,21,9,5),y:183e3,z:24e4}];function plot_ver_1(e,t,n){Highcharts.chart("container",{chart:{type:"variwide",zoomType:"x",panning:!0,panKey:"shift",inverted:!1},title:{text:""},subtitle:{text:""},xAxis:{min:0,max:parseInt(n)+parseInt(.5*n),tickInterval:PLOT_VER_1_STEP,gridLineWidth:0,title:{text:"Time(µs)"},labels:{formatter:function(){return this.value<=n?this.value:1==this.isLast?(console.log(this.value),console.log(PLOT_VER_1_STEP*parseInt((n+parseInt(.5*n))/PLOT_VER_1_STEP)),t):(console.log("3 -- "+this.value),console.log("3 -- "+this.isLast),console.log("3 l-- "+PLOT_VER_1_STEP*parseInt((n+parseInt(.5*n))/PLOT_VER_1_STEP)),"..")}},lineWidth:1,plotBands:[{color:"#ffffff",from:n,to:n+parseInt(.5*n),label:{text:"<p>Idle Current: "+global_idle_current_ua+"µA<br>with memory retention(128KB)</p>",textAlign:"center",verticalAlign:"bottom",y:-50,style:{fontSize:"12px",fontWeight:500}}}]},yAxis:[{gridLineWidth:1,title:{text:"Current(mA)"},labels:{formatter:function(){return this.value}},lineWidth:1}],legend:{enabled:!1},credits:{enabled:!1},series:[{name:"Current Consumption",data:e,dataLabels:{enabled:!0,format:"{point.y:.3f}mA",filter:{property:"y",operator:">",value:0}},tooltip:{shadow:!0,animation:!0,pointFormat:"Current： <b>{point.y}/mA</b><br>Time: <b>{point.z}/us</b><br>"},colorByPoint:!0}]})}